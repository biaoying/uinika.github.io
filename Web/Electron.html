<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#8C634F">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#8C634F">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Monda:300,300italic,400,400italic,700,700italic|Source+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"uinika.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#A38272","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="早期桌面应用的开发主要借助原生 C&#x2F;C++ API 进行，由于需要反复经历编译过程，且无法分离界面 UI 与业务代码，开发调试极为不便。后期出现的 QT 和 WPF 在一定程度上解决了界面代码分离和跨平台的问题，却依然无法避免较长时间的编译过程。近几年伴随互联网行业的迅猛发展，尤其是 NodeJS、Chromium 这类基于 W3C 标准开源应用的不断涌现，原生代码与 Web 浏览器开发逐步走向融">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Electron 打造跨平台桌面应用">
<meta property="og:url" content="https://uinika.github.io/Web/Electron.html">
<meta property="og:site_name" content="Bit by bit">
<meta property="og:description" content="早期桌面应用的开发主要借助原生 C&#x2F;C++ API 进行，由于需要反复经历编译过程，且无法分离界面 UI 与业务代码，开发调试极为不便。后期出现的 QT 和 WPF 在一定程度上解决了界面代码分离和跨平台的问题，却依然无法避免较长时间的编译过程。近几年伴随互联网行业的迅猛发展，尤其是 NodeJS、Chromium 这类基于 W3C 标准开源应用的不断涌现，原生代码与 Web 浏览器开发逐步走向融">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://uinika.github.io/Web/Electron/logo.png">
<meta property="og:image" content="https://uinika.github.io/Web/Electron/construction.png">
<meta property="og:image" content="https://uinika.github.io/Web/Electron/hello-electron.png">
<meta property="og:image" content="https://uinika.github.io/Web/Electron/structure.png">
<meta property="og:image" content="https://uinika.github.io/Web/Electron/menu.png">
<meta property="article:published_time" content="2020-05-21T13:39:03.829Z">
<meta property="article:modified_time" content="2020-05-21T13:39:03.829Z">
<meta property="article:author" content="Hank">
<meta property="article:tag" content="Server">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://uinika.github.io/Web/Electron/logo.png">

<link rel="canonical" href="https://uinika.github.io/Web/Electron.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>使用 Electron 打造跨平台桌面应用 | Bit by bit</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Bit by bit" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bit by bit</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Electronics, Embedded & Web</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-th-large"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">53</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">22</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-briefcase"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-it圈">

    <a href="/industry/" rel="section"><i class="fa fa-fw fa-microchip"></i>IT圈</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/uinika" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://uinika.github.io/Web/Electron.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Hank">
      <meta itemprop="description" content="My world of IT, learn it & play it.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bit by bit">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用 Electron 打造跨平台桌面应用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 21:39:03" itemprop="dateCreated datePublished" datetime="2020-05-21T21:39:03+08:00">2020-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>25 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>早期桌面应用的开发主要借助原生 C/C++ API 进行，由于需要反复经历编译过程，且无法分离界面 UI 与业务代码，开发调试极为不便。后期出现的 QT 和 WPF 在一定程度上解决了界面代码分离和跨平台的问题，却依然无法避免较长时间的编译过程。近几年伴随互联网行业的迅猛发展，尤其是 NodeJS、Chromium 这类基于 W3C 标准开源应用的不断涌现，原生代码与 Web 浏览器开发逐步走向融合，Electron 正是在这种背景下诞生的。</p>
<p><img src="/Web/Electron/logo.png"></p>
<p>Electron 是由 Github 开发，通过将<a href="www.chromium.org">Chromium</a>和<a href="https://nodejs.org" target="_blank" rel="noopener">NodeJS</a>整合为一个运行时环境，实现使用 HTML、CSS、JavaScript 构建跨平台的桌面应用程序的目的。Electron 源于 2013 年 Github 社区提供的开源编辑器 Atom，后于 2014 年在社区开源，并在 2016 年的 5 月和 8 月，通过了 <a href="https://www.apple.com/mac/app-store/" target="_blank" rel="noopener">Mac App Store</a> 和 <a href="https://apps.microsoft.com/" target="_blank" rel="noopener">Windows Store</a> 的上架许可，VSCode、Skype 等著名开源或商业应用程序，都是基于 Electron 打造。为了方便编写测试用例，笔者在 Github 搭建了一个简单的 Electron 种子项目<a href="https://github.com/uinika/octopus" target="_blank" rel="noopener">Octopus</a>，读者可以基于此来运行本文涉及的示例代码。</p>
<a id="more"></a>
<figure>
<img src="/Web/Electron/construction.png" alt="construction"><figcaption aria-hidden="true">construction</figcaption>
</figure>
<h1 id="getting-start">Getting Start</h1>
<p>首先，让我们通过<code>npm init</code>和<code>git init</code>新建一个项目，然后通过如下<code>npm</code>语句安装最新的 Electron 稳定版。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ npm i -D electron@latest</span><br></pre></td></tr></table></figure>
<p>然后向项目目录下的<code>package.json</code>文件添加一条<code>scripts</code>语句，便于后面通过<code>npm start</code>命令启动 Electron 应用。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ... ...</span></span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"Hank"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"resource/main.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"electron ."</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"electron"</span>: <span class="string">"^3.0.7"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在项目根目录下新建<code>resource</code>文件夹，里面分别再建立<code>index.html</code>和<code>main.js</code>两个文件，最终形成如下的项目结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">electron-demo</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── README.md</span><br><span class="line">└── resource</span><br><span class="line">    ├── index.html</span><br><span class="line">    └── main.js</span><br></pre></td></tr></table></figure>
<p><code>main.js</code>是 Electron 应用程序的主入口点，当在命令行运行这段程序的时候，就会启动一个 Electron 的<strong>主进程</strong>，主进程当中可以通过代码打开指定的 Web 页面去展示 UI。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** main.js */</span></span><br><span class="line"><span class="keyword">const</span> &#123; app, BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  mainWindow = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">500</span> &#125;);</span><br><span class="line"></span><br><span class="line">  mainWindow.setMenu(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// mainWindow.loadFile("index.html"); // 隐藏Chromium菜单</span></span><br><span class="line">  <span class="comment">// mainWindow.webContents.openDevTools() // 开启调试模式</span></span><br><span class="line"></span><br><span class="line">  mainWindow.on(<span class="string">"closed"</span>, () =&gt; &#123;</span><br><span class="line">    mainWindow = <span class="literal">null</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"window-all-closed"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">/* 在Mac系统用户通过Cmd+Q显式退出之前，保持应用程序和菜单栏处于激活状态。*/</span></span><br><span class="line">  <span class="keyword">if</span> (process.platform !== <span class="string">"darwin"</span>) &#123;</span><br><span class="line">    app.quit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"activate"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">/* 当dock图标被点击并且不会有其它窗口被打开的时候，在Mac系统上重新建立一个应用内的window。*/</span></span><br><span class="line">  <span class="keyword">if</span> (mainWindow === <span class="literal">null</span>) &#123;</span><br><span class="line">    createWindow();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Web 页面<code>index.html</code>运行在自己的<strong>渲染进程</strong>当中，但是能够通过 NodeJS 提供的 API 去访问操作系统的原生资源（<em>例如下面代码中的<code>process.versions</code>语句</em>），这正是 Electron 能够跨平台执行的原因所在。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello Electron<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好，Electron！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 所有NodeJS可用的API都可以通过renderer.js的process属性访问 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      当前Electron版本：</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.write(process.versions.electron);</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      当前NodeJS版本：</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.write(process.versions.node);</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      当前Chromium版本：</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.write(process.versions.chrome);</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// 这里也可以包含运行在当前进程里的其它文件</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">require</span>(<span class="string">"./renderer.js"</span>);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用命令行工具执行<code>npm start</code>命令之后，上述 HTML 代码在笔者 Linux 操作系统内被渲染为如下界面。应用当中，可以通过<code>CTRL+R</code>重新加载页面，或者使用<code>CTRL+SHIFT+I</code>打开浏览器控制台。</p>
<figure>
<img src="/Web/Electron/hello-electron.png" alt="hello-electron"><figcaption aria-hidden="true">hello-electron</figcaption>
</figure>
<blockquote>
<p>一个 Electron 应用的<strong>主进程</strong>只会有一个，<strong>渲染进程</strong>则会有多个。</p>
</blockquote>
<h1 id="主进程与渲染进程">主进程与渲染进程</h1>
<ul>
<li><strong>主进程</strong>（<em>main process</em>）管理所有的 web 页面以及相应的渲染进程，它通过<code>BrowserWindow</code>来创建视图页面。</li>
<li><strong>渲染进程</strong>（<em>renderer processes</em>）用来运行页面，每个渲染进程都对应自己的<code>BrowserWindow</code>实例，如果实例被销毁那么渲染进程就会被终止。</li>
</ul>
<figure>
<img src="/Web/Electron/structure.png" alt="structure"><figcaption aria-hidden="true">structure</figcaption>
</figure>
<p>Electron 分别在<strong>主进程</strong>和<strong>渲染进程</strong>提供了大量 API，可以通过<code>require</code>语句方便的将这些 API 包含在当前模块使用。但是 Electron 提供的 API 只能用于指定进程类型，即某些 API 只能用于渲染进程，而某些只能用于主进程，例如上面提到的<code>BrowserWindow</code>就只能用于主进程。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">ccc = <span class="keyword">new</span> BrowserWindow();</span><br></pre></td></tr></table></figure>
<p>Electron 通过<code>remote</code>模块暴露一些主进程的 API，如果需要在渲染进程中创建一个<code>BrowserWindow</code>实例，那么就可以借助这个 <code>remote</code> 模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; remote &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>); <span class="comment">// 获取remote模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = remote; <span class="comment">// 从remote当中获取BrowserWindow</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> browserWindow = <span class="keyword">new</span> BrowserWindow(); <span class="comment">// 实例化获取的BrowserWindow</span></span><br></pre></td></tr></table></figure>
<p>Electron 可以使用所有 NodeJS 上提供的 API，同样只需要简单的<code>require</code>一下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = fs.readdirSync(<span class="string">"/"</span>);</span><br></pre></td></tr></table></figure>
<p>当然，NodeJS 上数以万计的 npm 包也同样在 Electron 可用，当然，如果是涉及到底层 C/C++的模块还需要单独进行编译，虽然这样的模块在 npm 仓库里并不多。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> S3 = <span class="built_in">require</span>(<span class="string">"aws-sdk/clients/s3"</span>);</span><br></pre></td></tr></table></figure>
<p>既然 Electron 本质是一个<code>浏览器 + 跨平台中间件</code>的组合，因此常用的前端调试技术也适用于 Electron，这里可以通过<code>CTRL+SHIFT+I</code>手动开启 Chromium 的调试控制台，或者通过下面代码在开发模式下自动打开：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.webContents.openDevTools(); <span class="comment">// 开启调试模式</span></span><br></pre></td></tr></table></figure>
<h1 id="核心模块">核心模块</h1>
<p>本节将对<code>require("electron")</code>所获取的模块进行概述，便于后期进行分类查找。</p>
<h2 id="app-模块">app 模块</h2>
<p>Electron 提供的<strong>app</strong>模块即提供了可用于区分开发和生产环境的<code>app.isPackaged</code>属性，也提供了关闭窗口的<code>app.quit()</code>和用于退出程序的<code>app.exit()</code>方法，以及<code>window-all-closed</code>和<code>ready</code>等 Electron 程序事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line">app.on(<span class="string">"window-all-closed"</span>, () =&gt; &#123;</span><br><span class="line">  app.quit(); <span class="comment">// 当所有窗口关闭时退出应用程序</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以使用<code>app.getLocale()</code>获取当前操作系统的国际化信息。</p>
</blockquote>
<h2 id="browserwindow-模块">BrowserWindow 模块</h2>
<p>工作在主进程，用于创建和控制浏览器窗口。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程中使用如下方式获取。</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染进程中可以使用remote属性获取。</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>).remote;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span> &#125;);</span><br><span class="line"><span class="built_in">window</span>.on(<span class="string">"closed"</span>, () =&gt; &#123;</span><br><span class="line">  win = <span class="literal">null</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载远程URL</span></span><br><span class="line"><span class="built_in">window</span>.loadURL(<span class="string">"https://uinika.github.io/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载本地HTML</span></span><br><span class="line"><span class="built_in">window</span>.loadURL(<span class="string">`file://<span class="subst">$&#123;__dirname&#125;</span>/app/index.html`</span>);</span><br></pre></td></tr></table></figure>
<p>例如需要创建一个无边框窗口的 Electron 应用程序，只需将<code>BrowserWindow</code>配置对象中的<code>frame</code>属性设置为<code>false</code>即可：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>, <span class="attr">frame</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="built_in">window</span>.show();</span><br></pre></td></tr></table></figure>
<p>例如加载页面时，渲染进程第一次完成绘制时<code>BrowserWindow</code>会发出<code>ready-to-show</code>事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="keyword">let</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">show</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">win.once(<span class="string">"ready-to-show"</span>, () =&gt; &#123;</span><br><span class="line">  win.show();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>对于较为复杂的应用程序，<code>ready-to-show</code>事件的发出可能较晚，会让应用程序的打开显得缓慢。 这种情况下，建议通过<code>backgroundColor</code>属性设置接近应用程序背景色的方式显示窗口，从而获取更佳的用户体验。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">backgroundColor</span>: <span class="string">"#272822"</span> &#125;);</span><br><span class="line"><span class="built_in">window</span>.loadURL(<span class="string">"https://uinika.github.io/"</span>);</span><br></pre></td></tr></table></figure>
<p>如果想要创建子窗口，那么可以使用<code>parent</code>选项，此时子窗口将总是显示在父窗口的顶部。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> top = <span class="keyword">new</span> BrowserWindow();</span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">parent</span>: top &#125;);</span><br><span class="line"></span><br><span class="line">child.show();</span><br><span class="line">top.show();</span><br></pre></td></tr></table></figure>
<p>创建子窗口时，如果需要禁用父窗口，那么可以同时设置<code>modal</code>选项。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">parent</span>: top, <span class="attr">modal</span>: <span class="literal">true</span>, <span class="attr">show</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">child.loadURL(<span class="string">"https://uinika.github.io/"</span>);</span><br><span class="line">child.once(<span class="string">"ready-to-show"</span>, () =&gt; &#123;</span><br><span class="line">  child.show();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="globalshortcut-模块">globalShortcut 模块</h2>
<p>使用<code>globalShortcut</code>模块中的<code>register()</code>方法注册快捷键。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, globalShortcut &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 注册一个快捷键监听器。</span></span><br><span class="line">  globalShortcut.register(<span class="string">"CommandOrControl+Y"</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 当按下Control +Y键时触发该回调函数。</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Linux 和 Windows 上【Command】键会失效, 所以要使用 CommandOrControl（既 MacOS 上是【Command】键 ，Linux 和 Windows 上是【Control】键）。</p>
</blockquote>
<h2 id="clipboard-模块">clipboard 模块</h2>
<p>用于在系统剪贴板上执行复制和粘贴操作，包含有<code>readText()</code>、<code>writeText()</code>、<code>readHTML()</code>、<code>writeHTML()</code>、<code>readImage()</code>、<code>writeImage()</code>等方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; clipboard &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line">clipboard.writeText(<span class="string">"一些字符串内容"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="globalshortcut-模块-1">globalShortcut 模块</h2>
<p>用于在 Electron 应用程序失去键盘焦点时监听全局键盘事件，即在操作系统中注册或注销全局快捷键。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, globalShortcut &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 注册全局快捷键</span></span><br><span class="line">  <span class="keyword">const</span> regist = globalShortcut.register(<span class="string">"CommandOrControl+A"</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"快捷键被摁下！"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!regist) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"注册失败！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 检查快捷键是否注册成功</span></span><br><span class="line">  <span class="built_in">console</span>.log(globalShortcut.isRegistered(<span class="string">"CommandOrControl+A"</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"will-quit"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 注销快捷键</span></span><br><span class="line">  globalShortcut.unregister(<span class="string">"CommandOrControl+A"</span>);</span><br><span class="line">  <span class="comment">// 清空所有快捷键</span></span><br><span class="line">  globalShortcut.unregisterAll();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="ipcmain-与-ipcrenderer-模块">ipcMain 与 ipcRenderer 模块</h2>
<p>用于主进程到渲染进程的异步通信，下面是一个主进程与渲染进程之间发送和处理消息的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程</span></span><br><span class="line"><span class="keyword">const</span> &#123; ipcMain &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line">ipcMain.on(<span class="string">"asynchronous-message"</span>, (event, arg) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arg); <span class="comment">// 打印 "ping"</span></span><br><span class="line">  event.sender.send(<span class="string">"asynchronous-reply"</span>, <span class="string">"pong"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ipcMain.on(<span class="string">"synchronous-message"</span>, (event, arg) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arg); <span class="comment">// 打印 "ping"</span></span><br><span class="line">  event.returnValue = <span class="string">"pong"</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//渲染器进程，即网页</span></span><br><span class="line"><span class="keyword">const</span> &#123; ipcRenderer &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ipcRenderer.sendSync(<span class="string">"synchronous-message"</span>, <span class="string">"ping"</span>)); <span class="comment">// 打印 "pong"</span></span><br><span class="line"></span><br><span class="line">ipcRenderer.on(<span class="string">"asynchronous-reply"</span>, (event, arg) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arg); <span class="comment">// 打印 "pong"</span></span><br><span class="line">&#125;);</span><br><span class="line">ipcRenderer.send(<span class="string">"asynchronous-message"</span>, <span class="string">"ping"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果需要完成渲染器进程到主进程的异步通信，可以选择使用<code>ipcRenderer</code>对象。</p>
</blockquote>
<h2 id="menu-与-menuitem-模块">Menu 与 MenuItem 模块</h2>
<p>用于主进程，用于创建原生应用菜单和上下文菜单。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, BrowserWindow, Menu &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = [</span><br><span class="line">  &#123;</span><br><span class="line">    label: <span class="string">"自定义菜单"</span>,</span><br><span class="line">    submenu: [&#123; <span class="attr">label</span>: <span class="string">"菜单项-1"</span> &#125;, &#123; <span class="attr">label</span>: <span class="string">"菜单项-2"</span> &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  mainWindow = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">500</span> &#125;);</span><br><span class="line">  mainWindow.setMenu(Menu.buildFromTemplate(template));</span><br><span class="line">  mainWindow.loadFile(<span class="string">"resource/index.html"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用<code>MenuItem</code>类可以添加菜单项至 Electron 应用程序菜单和上下文菜单当中。</p>
</blockquote>
<figure>
<img src="/Web/Electron/menu.png" alt="menu"><figcaption aria-hidden="true">menu</figcaption>
</figure>
<h2 id="netlog-模块">netLog 模块</h2>
<p>用于记录网络日志。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; netLog &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">netLog.startLogging(<span class="string">"/user/log.info"</span>);</span><br><span class="line"><span class="comment">/** 一些网络事件发生之后 */</span></span><br><span class="line">netLog.stopLogging(<span class="function">(<span class="params">path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"网络日志log.info保存在"</span>, path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="powermonitor-模块">powerMonitor 模块</h2>
<p>通过 Electron 提供的<code>powerMonitor</code>模块监视当前电脑电源状态的改变，值得注意的是，在<code>app</code>模块的<code>ready</code>事件被触发之前, 不能引用或使用该模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; app &#125; = electron;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  electron.powerMonitor.on(<span class="string">"suspend"</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"系统将要休眠了！"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="powersaveblocker-模块">powerSaveBlocker 模块</h2>
<p>阻止操作系统进入低功耗 (休眠) 模式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; powerSaveBlocker &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ID = powerSaveBlocker.start(<span class="string">"prevent-display-sleep"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(powerSaveBlocker.isStarted(ID));</span><br><span class="line"></span><br><span class="line">powerSaveBlocker.stop(ID);</span><br></pre></td></tr></table></figure>
<h2 id="protocol-模块">protocol 模块</h2>
<p>注册自定义协议并拦截基于现有协议的请求，例如下面代码实现了一个与<code>[file://]</code>协议等效的示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, protocol &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  protocol.registerFileProtocol(</span><br><span class="line">    <span class="string">"uinika"</span>,</span><br><span class="line">    (request, callback) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> url = request.url.substr(<span class="number">7</span>);</span><br><span class="line">      callback(&#123; <span class="attr">path</span>: path.normalize(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/<span class="subst">$&#123;url&#125;</span>`</span>) &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    (error) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) <span class="built_in">console</span>.error(<span class="string">"协议注册失败！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="net-模块">net 模块</h2>
<p><code>net</code>模块是一个发送 HTTP(S) 请求的客户端 API，类似于 NodeJS 的 HTTP 和 HTTPS 模块 ，但底层使用的是 Chromium 原生网络库。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; net &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line">  <span class="keyword">const</span> request = net.request(<span class="string">"https://zhihu.com/people/uinika/activities"</span>);</span><br><span class="line"></span><br><span class="line">  request.on(<span class="string">"response"</span>, (response) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`STATUS: <span class="subst">$&#123;response.statusCode&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`HEADERS: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(response.headers)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    response.on(<span class="string">"data"</span>, (chunk) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`BODY: <span class="subst">$&#123;chunk&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    response.on(<span class="string">"end"</span>, () =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"没有更多数据！"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  request.end();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Electron 中提供的<code>ClientRequest</code>类用来发起 HTTP/HTTPS 请求，<code>IncomingMessage</code>类则用于响应 HTTP/HTTPS 请求。</p>
</blockquote>
<h2 id="remote-模块">remote 模块</h2>
<p><code>remote</code>模块返回的每个对象都表示主进程中的一个对象，调用这个对象实质是在发送同步进程消息。因为 Electron 当中 GUI 相关的模块 (如 <code>dialog</code>、<code>menu</code> 等) 仅在主进程中可用, 在渲染进程中不可用，所以<code>remote</code>模块提供了一种渲染进程（<em>Web 页面</em>）与主进程（<em>IPC</em>）通信的简单方法。remote 模块包含了一个<code>remote.require(module)</code></p>
<ul>
<li><code>remote.process</code>：主进程中的<code>process</code>对象，与<code>remote.getGlobal("process")</code>作用相同, 但结果已经被缓存。</li>
<li><code>remote.getCurrentWindow()</code>：返回<code>BrowserWindow</code>，即该网页所属的窗口。</li>
<li><code>remote.getCurrentWebContents()</code>：返回<code>WebContents</code>，即该网页的 Web 内容</li>
<li><code>remote.getGlobal(name)</code>：该方法返回主进程中名为<code>name</code>的全局变量。</li>
<li><code>remote.require(module)</code>：返回主进程内执行<code>require(module)</code>时返回的对象，参数<code>module</code>指定的模块相对路径将会相对于主进程入口点进行解析。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">├── main</span><br><span class="line">│   ├── helper.js</span><br><span class="line">│   └── index.js</span><br><span class="line">├── package.json</span><br><span class="line">└── renderer</span><br><span class="line">    └── index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程: main/index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; app &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主进程关联的模块: main/test.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">"This is a test!"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染进程: renderer/index.js</span></span><br><span class="line"><span class="keyword">const</span> helper = <span class="built_in">require</span>(<span class="string">"electron"</span>).remote.require(<span class="string">"./helper"</span>); <span class="comment">// This is a test!</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>remote</code>模块提供的主进程与渲染进程通信方法比<code>ipcMain</code>/<code>ipcRenderer</code>更加易于使用。</p>
</blockquote>
<h2 id="screen-模块">screen 模块</h2>
<p>检索有关屏幕大小、显示器、光标位置等信息，应用的<code>ready</code>事件触发之前，不能使用该模块。下面的示例代码，创建了一个可以自动全屏窗口的应用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; app, BrowserWindow &#125; = electron;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; width, height &#125; = electron.screen.getPrimaryDisplay().workAreaSize;</span><br><span class="line">  <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123; width, height &#125;);</span><br><span class="line">  <span class="built_in">window</span>.loadURL(<span class="string">"https://github.com"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="shell-模块">shell 模块</h2>
<p>提供与桌面集成相关的功能，例如可以通过调用操作系统默认的应用程序管理文件或<code>Url</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; shell &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">shell.openExternal(<span class="string">"https://github.com"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="systempreferences-模块">systemPreferences 模块</h2>
<p>获取操作系统特定的偏好信息，例如在 Mac 下可以通过下面代码获取当前是否开启系统 Dark 模式的信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; systemPreferences &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(systemPreferences.isDarkMode()); <span class="comment">// 返回一个布尔值。</span></span><br></pre></td></tr></table></figure>
<h2 id="tray-模块">Tray 模块</h2>
<p>用于主进程，添加图标和上下文菜单至操作系统通知区域。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, Menu, Tray &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tray = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  tray = <span class="keyword">new</span> Tray(<span class="string">"/images/icon"</span>);</span><br><span class="line">  <span class="keyword">const</span> contextMenu = Menu.buildFromTemplate([</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">"Item1"</span>, <span class="attr">type</span>: <span class="string">"radio"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">"Item2"</span>, <span class="attr">type</span>: <span class="string">"radio"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">"Item3"</span>, <span class="attr">type</span>: <span class="string">"radio"</span>, <span class="attr">checked</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">"Item4"</span>, <span class="attr">type</span>: <span class="string">"radio"</span> &#125;,</span><br><span class="line">  ]);</span><br><span class="line">  tray.setToolTip(<span class="string">"This is my application."</span>);</span><br><span class="line">  tray.setContextMenu(contextMenu);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="webframe-模块">webFrame 模块</h2>
<p>定义当前网页渲染的一些属性，比如缩放比例、缩放等级、设置拼写检查、执行 JavaScript 脚本等等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; webFrame &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line">webFrame.setZoomFactor(<span class="number">5</span>); <span class="comment">// 将页面缩放至500%。</span></span><br></pre></td></tr></table></figure>
<h2 id="session-模块">session 模块</h2>
<p>Electron 的<code>session</code>模块可以创建新的<code>session</code>对象，主要用来管理浏览器会话、cookie、缓存、代理设置等等。</p>
<p>如果需要访问现有页面的<code>session</code>，那么可以通过<code>BrowserWindow</code>对象的<code>webContents</code>的<code>session</code>属性来获取。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">600</span>, <span class="attr">height</span>: <span class="number">900</span> &#125;);</span><br><span class="line"><span class="built_in">window</span>.loadURL(<span class="string">"https://uinika.github.io/web/server/electron.html"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mySession = <span class="built_in">window</span>.webContents.session;</span><br><span class="line"><span class="built_in">console</span>.log(mySession.getUserAgent());</span><br></pre></td></tr></table></figure>
<p>Electron 里也可以通过<code>session</code>模块的<code>cookies</code>属性来访问浏览器的 Cookie 实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有cookies。</span></span><br><span class="line">session.defaultSession.cookies.get(&#123;&#125;, (error, cookies) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error, cookies);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询当前URL下的所有cookies。</span></span><br><span class="line">session.defaultSession.cookies.get(</span><br><span class="line">  &#123; <span class="attr">url</span>: <span class="string">"http://www.github.com"</span> &#125;,</span><br><span class="line">  (error, cookies) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error, cookies);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置cookie</span></span><br><span class="line"><span class="keyword">const</span> cookie = &#123;</span><br><span class="line">  url: <span class="string">"https://www.zhihu.com/people/uinika/posts"</span>,</span><br><span class="line">  name: <span class="string">"hank"</span>,</span><br><span class="line">  value: <span class="string">"zhihu"</span>,</span><br><span class="line">&#125;;</span><br><span class="line">session.defaultSession.cookies.set(cookie, (error) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="built_in">console</span>.error(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用<code>Session</code>的<code>WebRequest</code>属性可以访问<code>WebRequest</code>类的实例，<code>WebRequest</code>类可以在 HTTP 请求生命周期的不同阶段修改相关内容，例如下面代码为 HTTP 请求添加了一个<code>User-Agent</code>协议头：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送至下面URL地址的请求将会被添加User-Agent协议头</span></span><br><span class="line"><span class="keyword">const</span> filter = &#123;</span><br><span class="line">  urls: [<span class="string">"https://*.github.com/*"</span>, <span class="string">"*://electron.github.io"</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">session.defaultSession.webRequest.onBeforeSendHeaders(</span><br><span class="line">  filter,</span><br><span class="line">  (details, callback) =&gt; &#123;</span><br><span class="line">    details.requestHeaders[<span class="string">"User-Agent"</span>] = <span class="string">"MyAgent"</span>;</span><br><span class="line">    callback(&#123; <span class="attr">cancel</span>: <span class="literal">false</span>, <span class="attr">requestHeaders</span>: details.requestHeaders &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="desktopcapturer-模块">desktopCapturer 模块</h2>
<p>用于捕获桌面窗口里的内容，该模块只拥有一个方法：<code>desktopCapturer.getSources(options, callback)</code>。</p>
<ol type="1">
<li><code>options</code> 对象
<ul>
<li><code>types</code>：字符串数组，列出需要捕获的桌面类型是<code>screen</code>还是<code>window</code>。</li>
<li><code>thumbnailSize</code>：媒体源缩略图的大小，默认为<code>150x150</code>。</li>
</ul></li>
<li><code>callback</code> 回调函数，拥有如下 2 个参数：
<ul>
<li><code>error</code>：错误信息。</li>
<li><code>sources</code>：捕获的资源数组。</li>
</ul></li>
</ol>
<p>如下代码工作在渲染进程当中，作用是将桌面窗口捕获为视频：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; desktopCapturer &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">desktopCapturer.getSources(</span><br><span class="line">  &#123; <span class="attr">types</span>: [<span class="string">"window"</span>, <span class="string">"screen"</span>] &#125;,</span><br><span class="line">  (error, sources) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sources.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (sources[i].name === <span class="string">"Electron"</span>) &#123;</span><br><span class="line">        navigator.mediaDevices</span><br><span class="line">          .getUserMedia(&#123;</span><br><span class="line">            audio: <span class="literal">false</span>,</span><br><span class="line">            video: &#123;</span><br><span class="line">              mandatory: &#123;</span><br><span class="line">                chromeMediaSource: <span class="string">"desktop"</span>,</span><br><span class="line">                chromeMediaSourceId: sources[i].id,</span><br><span class="line">                minWidth: <span class="number">1280</span>,</span><br><span class="line">                maxWidth: <span class="number">1280</span>,</span><br><span class="line">                minHeight: <span class="number">800</span>,</span><br><span class="line">                maxHeight: <span class="number">800</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">          .then(<span class="function">(<span class="params">stream</span>) =&gt;</span> handleStream(stream))</span><br><span class="line">          .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> handleError(error));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleStream</span>(<span class="params">stream</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> video = <span class="built_in">document</span>.querySelector(<span class="string">"video"</span>);</span><br><span class="line">  video.srcObject = stream;</span><br><span class="line">  video.onloadedmetadata = <span class="function">(<span class="params">error</span>) =&gt;</span> video.play();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dialog-模块">dialog 模块</h2>
<p>调用操作系统原生的对话框，工作在主线程，下面示例展示了一个用于选择多个文件和目录的对话框：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; dialog &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  dialog.showOpenDialog(&#123;</span><br><span class="line">    properties: [<span class="string">"openFile"</span>, <span class="string">"openDirectory"</span>, <span class="string">"multiSelections"</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>由于对话框工作在 Electron 的主线程上，如果需要在渲染器进程中使用, 那么可以通过<code>remote</code>来获得：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; dialog &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>).remote;</span><br><span class="line"><span class="built_in">console</span>.log(dialog);</span><br></pre></td></tr></table></figure>
<h2 id="contenttracing-模块">contentTracing 模块</h2>
<p>从 Chromium 收集跟踪数据，从而查找性能瓶颈。使用后需要在浏览器打开<code>chrome://tracing/</code>页面，然后加载生成的文件查看结果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, contentTracing &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    categoryFilter: <span class="string">"*"</span>,</span><br><span class="line">    traceOptions: <span class="string">"record-until-full,enable-sampling"</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  contentTracing.startRecording(options, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"开始跟踪!"</span>);</span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      contentTracing.stopRecording(<span class="string">""</span>, (path) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"跟踪数据已经记录至"</span> + path);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">8000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="webview-标签">webview 标签</h1>
<p>Electron 的<code>&lt;webview&gt;</code>标签基于 Chromium，由于开发变动较大官方并不建议使用，而应考虑<code>&lt;iframe&gt;</code>或者 Electron 的<code>BrowserView</code>等选择，或者完全避免在页面进行内容嵌入。</p>
<p><code>&lt;webview&gt;</code>与<code>&lt;iframe&gt;</code>最大不同是运行于不同的进程当中，Electron 应用程序与嵌入内容之间的所有交互都是异步进行的，这样可以保证应用程序与嵌入内容双方的安全。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">webview</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"uinika"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">"http://localhost:5000/web/server/electron.html"</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="webcontents-属性">webContents 属性</h1>
<p><code>webContents</code>是<code>BrowserWindow</code>对象的一个属性，负责渲染和控制 Web 页面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">600</span>, <span class="attr">height</span>: <span class="number">500</span> &#125;);</span><br><span class="line"><span class="built_in">window</span>.loadURL(<span class="string">"https://uinika.github.io/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> contents = <span class="built_in">window</span>.webContents;</span><br><span class="line"><span class="built_in">console</span>.log(contents);</span><br></pre></td></tr></table></figure>
<h1 id="window.open-函数">window.open() 函数</h1>
<p>该函数用于打开一个新窗口并加载指定<code>url</code>，调用后将会为该<code>url</code>创建一个<code>BrowserWindow</code>实例，并返回一个<code>BrowserWindowProxy</code>对象，但是该对象只能对打开的<code>url</code>页面进行有限的控制。正常情况下，如果希望完全控制新窗口，可以直接创建一个新的<code>BrowserWindow</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// window.open(url[, frameName][, features])</span></span><br><span class="line"><span class="built_in">window</span>.open(<span class="string">"https://github.com"</span>, <span class="string">"_blank"</span>, <span class="string">"nodeIntegration=no"</span>);</span><br></pre></td></tr></table></figure>
<p><code>BrowserWindowProxy</code>对象拥有如下属性和方法：</p>
<ul>
<li><code>win.closed</code>：子窗口关闭后设置为<code>true</code>的布尔属性。</li>
<li><code>win.blur()</code>：将焦点从子窗口中移除。</li>
<li><code>win.close()</code>：强制关闭子窗口, 而不调用其卸载事件。</li>
<li><code>win.eval(code)</code>：<code>code</code>字符串，需要在子窗口 Eval 的代码。</li>
<li><code>win.focus()</code>：聚焦子窗口（<em>即将子窗口置顶</em>）。</li>
<li><code>win.print()</code>：调用子窗口的打印对话框。</li>
<li><code>win.postMessage(message, targetOrigin)</code>：向子窗口发送信息。</li>
</ul>
<h1 id="electron-进程">Electron 进程</h1>
<p>Electron 的<code>process</code>对象继承自 NodeJS 的<code>process</code>对象，但是新增了一些有用的事件、属性、方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  mainWindow = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">500</span>, <span class="attr">frame</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  mainWindow.loadFile(<span class="string">"resource/index.html"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(process.type); <span class="comment">// 当前进程类型是browser主进程还是renderer渲染进程，browser</span></span><br><span class="line">  <span class="built_in">console</span>.log(process.versions.node); <span class="comment">// NodeJS版本，10.2.0</span></span><br><span class="line">  <span class="built_in">console</span>.log(process.versions.chrome); <span class="comment">// Chrome版本，66.0.3359.181</span></span><br><span class="line">  <span class="built_in">console</span>.log(process.versions.electron); <span class="comment">//Electron版本，3.0.13</span></span><br><span class="line">  <span class="built_in">console</span>.log(process.resourcesPath); <span class="comment">// 资源目录路径，D:\Workspace\octopus\node_modules\electron\dist\resources</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="沙箱机制">沙箱机制</h1>
<p>Chromium 通过将 Web 前端代码放置在一个与操作系统隔离的沙箱中运行，从而保证恶意代码不会侵犯到操作系统本身。但是 Electron 中渲染进程可以调用 NodeJS，而 NodeJS 又需要涉及大量操作系统调用，因而沙箱机制默认是禁用的。</p>
<p>某些应用场景下，需要运行一些不确定安全性的外部前端代码，为了保证操作系统安全，可能需要开启沙箱机制。此时首先在创建<code>BrowserWindow</code>时传入<code>sandbox</code>属性，然后在命令行添加<code>--enable-sandbox</code>参数传递给 Electron 即可完成开启。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> win;</span><br><span class="line">app.on(<span class="string">"ready"</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">    webPreferences: &#123;</span><br><span class="line">      sandbox: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">window</span>.loadURL(<span class="string">"http://google.com"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用<code>sandbox</code>选项之后，将会阻止 Electron 在渲染器中创建一个 NodeJS 运行时环境，此时新窗口中的<code>window.open()</code> 将按照浏览器原生的方式工作。</p>
</blockquote>
<h1 id="macbook-touchbar-支持">MacBook TouchBar 支持</h1>
<p>针对 Mac 笔记本电脑上配置的 TouchBar 硬件，Electron 提供了一系列相关的类与操作接口：<code>TouchBar</code>、<code>TouchBarButton</code>、<code>TouchBarColorPicker</code>、<code>TouchBarGroup</code>、<code>TouchBarLabel</code>、<code>TouchBarPopover</code>、<code>TouchBarScrubber</code>、<code>TouchBarSegmentedControl</code>、<code>TouchBarSlider</code>、<code>TouchBarSpacer</code>。</p>
<h1 id="创建应用图标">创建应用图标</h1>
<p>用于将 PNG 或 JPG 图片设置为托盘、Dock 和应用程序的图标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow, Tray &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Icon = <span class="keyword">new</span> Tray(<span class="string">"/images/icon.png"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">icon</span>: <span class="string">"/images/window.png"</span> &#125;);</span><br></pre></td></tr></table></figure>
<h1 id="安全原则">安全原则</h1>
<p>由于 Electron 的发布通常落后最新版本 Chromium 几周甚至几个月，因此特别需要注意如下这些安全性问题：</p>
<h2 id="使用安全的协议加载外部内容">使用安全的协议加载外部内容</h2>
<p>外部资源尽量使用更安全的协议加载，比如<code>HTTP</code>换成<code>HTTPS</code>、<code>WS</code>换成<code>WSS</code>、<code>FTP</code>换成<code>FTPS</code>等。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">"http://cdn.com/react.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://cdn.com/scss.css"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">"https://cdn.com/react.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdn.com/scss.css"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  browserWindow.loadURL("http://uinika.github.io/); // 错误</span><br><span class="line"><span class="actionscript">  browserWindow.loadURL(<span class="string">"https://uinika.github.io/"</span>); <span class="comment">// 正确</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="加载外部内容时禁用-nodejs-集成">加载外部内容时禁用 NodeJS 集成</h2>
<p>使用<code>BrowserWindow</code>、<code>BrowserView</code>、<code>&lt;webview&gt;</code>加载远程内容时，都需要通过禁用 NodeJS 集成去限制远程代码的执行权限，避免恶意代码跨站攻击。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">nodeIntegration</span> <span class="attr">src</span>=<span class="string">"page.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">src</span>=<span class="string">"page.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">/** 错误 */</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow();</span></span><br><span class="line"><span class="actionscript">  mainWindow.loadURL(<span class="string">"https://my-website.com"</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">  <span class="comment">/** 正确 */</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span></span><br><span class="line">    webPreferences: &#123;</span><br><span class="line"><span class="actionscript">      nodeIntegration: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">      preload: <span class="string">"./preload.js"</span>,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于需要与远程代码共享的变量或函数，可以通过将其挂载至当前页面的<code>window</code>全局对象来实现。</p>
</blockquote>
<h2 id="渲染进程中启用上下文隔离">渲染进程中启用上下文隔离</h2>
<p>上下文隔离是 Electron 提供的试验特性，通过为远程加载的代码创造一个全新上下文环境，避免与主进程中的代码出现冲突或者相互污染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程</span></span><br><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">  webPreferences: &#123;</span><br><span class="line">    contextIsolation: <span class="literal">true</span>,</span><br><span class="line">    preload: <span class="string">"preload.js"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="处理远程内容中的会话许可">处理远程内容中的会话许可</h2>
<p>当页面尝试使用某个特性时，会弹出通知让用户手动进行确认；而默认情况下，Electron 会自动批准所有的许可请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">session</span><br><span class="line">  .fromPartition(<span class="string">"some-partition"</span>)</span><br><span class="line">  .setPermissionRequestHandler(<span class="function">(<span class="params">webContents, permission, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = webContents.getURL();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (permission === <span class="string">"notifications"</span>) &#123;</span><br><span class="line">      callback(<span class="literal">true</span>); <span class="comment">// 通过许可请求</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!url.startsWith(<span class="string">"https://my-website.com"</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> callback(<span class="literal">false</span>); <span class="comment">// 拒绝许可请求</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="不要禁用-websecurity">不要禁用 webSecurity</h2>
<p>在渲染进程禁用<code>webSecurity</code>将导致许多重要的安全性功能被关闭，因此 Electron 默认开启。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">  webPreferences: &#123;</span><br><span class="line">    webSecurity: <span class="literal">false</span>, <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="定义-csp-安全策略">定义 CSP 安全策略</h2>
<p>内容安全策略 CSP 允许 Electron 通过<code>webRequest</code>对指定 URL 的访问进行约束，例如允许加载<code>https://uinika.github.io/</code>这个源，那么<code>https://hack.attacker.com</code>将不会被允许加载，CSP 是处理跨站脚本攻击、数据注入攻击的另外一层保护措施。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">session.defaultSession.webRequest.onHeadersReceived(<span class="function">(<span class="params">details, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  callback(&#123;</span><br><span class="line">    responseHeaders: &#123;</span><br><span class="line">      ...details.responseHeaders,</span><br><span class="line">      <span class="string">"Content-Security-Policy"</span>: [<span class="string">"default-src 'none'"</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用<code>file://</code>协议打开本地文件时，可以通过元数据标签<code>&lt;meta&gt;</code>的属性来添加 CSP 约束。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Security-Policy"</span> <span class="attr">content</span>=<span class="string">"default-src 'none'"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="别设置-allowrunninginsecurecontent-为-true">别设置 allowRunningInsecureContent 为 true</h2>
<p>Electron 默认不允许在 HTTPS 页面中加载 HTTP 来源的代码，如果将<code>allowRunningInsecureContent</code>属性设置为<code>true</code>会禁用这种保护。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">  webPreferences: &#123;</span><br><span class="line">    allowRunningInsecureContent: <span class="literal">true</span>, <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="不要开启实验性功能">不要开启实验性功能</h2>
<p>开发人员可以通过<code>experimentalFeatures</code>属性启用未经严格测试的 Chromium 实验性功能，不过 Electron 官方出于稳定性和安全性考虑并不建议这样做。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">  webPreferences: &#123;</span><br><span class="line">    experimentalFeatures: <span class="literal">true</span>, <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="不要使用-enableblinkfeatures">不要使用 enableBlinkFeatures</h2>
<p>Blink 是 Chromium 内置的 HTML/CSS 渲染引擎，开发者可以通过<code>enableBlinkFeatures</code>启用其某些默认是禁用的特性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">  webPreferences: &#123;</span><br><span class="line">    enableBlinkFeatures: [<span class="string">"ExecCommandInJavaScript"</span>], <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="禁用-webview-的-allowpopups">禁用 webview 的 allowpopups</h2>
<p>开启<code>allowpopups</code>属性将使<code>window.open()</code>创建一个新的窗口和<code>BrowserWindows</code>，若非必要状况，尽量不要使用此属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">allowpopups</span> <span class="attr">src</span>=<span class="string">"page.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">src</span>=<span class="string">"page.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="验证-webview-选项与参数">验证 webview 选项与参数</h2>
<p>通过渲染进程创建的<code>&lt;WebView&gt;</code>默认不集成 NodeJS，但是它可以通过<code>webPreferences</code>属性创建出一个独立的渲染进程。在<code>&lt;WebView&gt;</code>标签开始渲染之前，Electron 将会触发一个<code>will-attach-webview</code>事件，可以通过该事件防止创建具有潜在不安全选项的 Web 视图。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">"web-contents-created"</span>, (event, contents) =&gt; &#123;</span><br><span class="line">  contents.on(<span class="string">"will-attach-webview"</span>, (event, webPreferences, params) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果未使用或者验证位置合法，那么将会剥离预加载脚本。</span></span><br><span class="line">    <span class="keyword">delete</span> webPreferences.preload;</span><br><span class="line">    <span class="keyword">delete</span> webPreferences.preloadURL;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 禁用NodeJS集成。</span></span><br><span class="line">    webPreferences.nodeIntegration = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证正在加载的URL。</span></span><br><span class="line">    <span class="keyword">if</span> (!params.src.startsWith(<span class="string">"https://www.zhihu.com/people/uinika/columns"</span>)) &#123;</span><br><span class="line">      event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="禁用或限制网页跳转">禁用或限制网页跳转</h2>
<p>如果 Electron 应用程序不需要导航或只需导航至特定页面，最佳实践是将导航限制在已知范围，并禁止其它类型的导航。可以通过在<code>will- navigation</code>事件处理函数中调用<code>event.preventDefault()</code>并添加额外的判断来实现这一点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL = <span class="built_in">require</span>(<span class="string">"url"</span>).URL;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"web-contents-created"</span>, (event, contents) =&gt; &#123;</span><br><span class="line">  contents.on(<span class="string">"will-navigate"</span>, (event, navigationUrl) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> parsedUrl = <span class="keyword">new</span> URL(navigationUrl);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parsedUrl.origin !== <span class="string">"https://www.zhihu.com/people/uinika/posts"</span>) &#123;</span><br><span class="line">      event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="禁用或限制新窗口创建">禁用或限制新窗口创建</h2>
<p>限制在 Electron 应用程序中创建额外窗口，并避免因此带来额外的安全隐患。<code>webContents</code>创建新窗口时会触发一个<code>web-contents-created</code>事件，该事件包含了将要打开的 URL 以及相关选项，可以在这个事件中检查窗口的创建，从而对其进行相应的限制。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; shell &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">"web-contents-created"</span>, (event, contents) =&gt; &#123;</span><br><span class="line">  contents.on(<span class="string">"new-window"</span>, (event, navigationUrl) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 通知操作系统在默认浏览器上打开URL</span></span><br><span class="line">    event.preventDefault();</span><br><span class="line">    shell.openExternal(navigationUrl);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Electron 2.0 版本开始，会在可执行文件名为 Electron 时会为开发者在控制台显示安全相关的警告和建议，开发人员也可以在<code>process.env</code>或<code>window</code>对象上配置<code>ELECTRON_ENABLE_SECURITY_WARNINGS</code>或<code>ELECTRON_DISABLE_SECURITY_WARNINGS</code>手动开启或关闭这些警告。</p>
</blockquote>
<h1 id="应用发布">应用发布</h1>
<p>Electron 的发布有别于传统桌面应用程序编译打包的发部过程，需要首先下载已经<a href="https://github.com/electron/electron/releases" target="_blank" rel="noopener">预编译完成的二进制包</a>，Linux 下二进制包结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">➜  electron-v3.0.7-linux-x64 tree -L 2</span><br><span class="line">.</span><br><span class="line">├── blink_image_resources_200_percent.pak</span><br><span class="line">├── content_resources_200_percent.pak</span><br><span class="line">├── content_shell.pak</span><br><span class="line">├── electron</span><br><span class="line">├── icudtl.dat</span><br><span class="line">├── libffmpeg.so</span><br><span class="line">├── libnode.so</span><br><span class="line">├── LICENSE</span><br><span class="line">├── LICENSES.chromium.html</span><br><span class="line">├── locales</span><br><span class="line">├── natives_blob.bin</span><br><span class="line">├── ui_resources_200_percent.pak</span><br><span class="line">├── v8_context_snapshot.bin</span><br><span class="line">├── version</span><br><span class="line">└── views_resources_200_percent.pak</span><br><span class="line">└── resources</span><br><span class="line">   ├── default_app.asar</span><br><span class="line">   └── electron.asar</span><br></pre></td></tr></table></figure>
<p>接下来，就可以部署前面编写的源代码，Electron 里主要有如下两种部署方式：</p>
<ol type="1">
<li>直接将代码放置到<code>resources</code>下的子目录，比如<code>app</code>目录：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── app</span><br><span class="line">│   ├── package.json</span><br><span class="line">│   └── resource</span><br><span class="line">│       ├── index.html</span><br><span class="line">│       └── main.js</span><br><span class="line">├── default_app.asar</span><br><span class="line">└── electron.asar</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>将应用打包加密为<code>asar</code>文件以后放置到<code>resources</code>目录，比如<code>app.asar</code>文件。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── app.asar</span><br><span class="line">├── default_app.asar</span><br><span class="line">└── electron.asar</span><br></pre></td></tr></table></figure>
<h1 id="asar-打包源码">asar 打包源码</h1>
<p><a href="https://github.com/electron/asar" target="_blank" rel="noopener">asar</a> 是一种简单的文件扩展格式，可以将文件如同<code>tar</code>格式一样前后连接在一起，支持随机读写，并使用 JSON 来保存文件信息，可以方便的读取与解析。Electron 通过它可以解决 Windows 文件路径长度的限制，提高<code>require</code>语句的加载速度，并且避免源代码泄漏。</p>
<p>首先，需要安装<code>asar</code>这个 npm 包，然后可以选择全局安装然通过命令行使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  npm install asar</span><br><span class="line">➜  asar pack electron-demo app.asar</span><br></pre></td></tr></table></figure>
<p>当然，更加工程化的方式是通过代码来执行打包操作，就像下面这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> asar = <span class="built_in">require</span>(<span class="string">"asar"</span>);</span><br><span class="line"></span><br><span class="line">src = <span class="string">"../octopus"</span>;</span><br><span class="line">dest = <span class="string">"build/app.asar"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 打包完成后的回调函数 */</span></span><br><span class="line">callback = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.info(<span class="string">"asar打包完成！"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">asar.createPackage(src, dest, callback);</span><br></pre></td></tr></table></figure>
<p>Electron 在 Web 页面可以通过<code>file:</code>协议读取 asar 包中的文件，即将 asar 文件视为一个虚拟的文件夹来进行操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">"electron"</span>);</span><br><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow();</span><br><span class="line"></span><br><span class="line">mainWindow.loadURL(<span class="string">"file:///path/to/example.asar/static/index.html"</span>);</span><br></pre></td></tr></table></figure>
<p>如果需要对 asar 文件进行 MD5 或者 SHA 完整性校验，可以对 asar 档案文件本身进行操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asar list app.asar</span><br></pre></td></tr></table></figure>
<h1 id="rcedit-编辑可执行文件">rcedit 编辑可执行文件</h1>
<p><a href="http://fvwmrcedit.sourceforge.net/" target="_blank" rel="noopener">RcEdit</a>是一款通过编辑窗口管理器的 rc 文件来对其进行配置的工具，Nodejs 社区提供了<a href="https://www.npmjs.com/package/rcedit" target="_blank" rel="noopener">node-rcedit</a>工具对 Windows 操作系统的<code>.exe</code>文件进行配置，首先通过<code>npm i rcedit --save-dev</code>为项目安装该依赖项。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rcedit = <span class="built_in">require</span>(<span class="string">"rcedit"</span>);</span><br><span class="line"></span><br><span class="line">rcedit(exePath, options, callback);</span><br></pre></td></tr></table></figure>
<p><code>rcedit()</code>函数包含有如下属性：</p>
<ol type="1">
<li><code>exePath</code>：需要进行修改的 Windows 可执行文件所在路径。</li>
<li><code>options</code>：一个拥有如下属性的配置对象。
<ul>
<li><code>version-string</code>：版本字符串；</li>
<li><code>file-version</code>：文件版本；</li>
<li><code>product-version</code>：产品版本；</li>
<li><code>icon</code>：图标文件<code>.ico</code>的路径;</li>
<li><code>requested-execution-level</code>：需要修改的执行级别（<em><code>asInvoker</code>、<code>highestAvailable</code>、<code>requireAdministrator</code></em>）。</li>
<li><code>application-manifest</code>：本地清单文件的路径。</li>
</ul></li>
<li><code>callback</code>：函数执行完毕之后回调，完整的函数签名为<code>function(error)</code>。</li>
</ol>
<h1 id="yarn-包管理器">yarn 包管理器</h1>
<p>Yarn 是一款由 Facebook 推出的 JavaScript 包管理器，与 NodeJS 提供的 Npm 一样使用<code>package.json</code>作为包信息文件。</p>
<p>测试当前 Yarn 的安装版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn --version</span><br></pre></td></tr></table></figure>
<p>初始化新项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn init</span><br></pre></td></tr></table></figure>
<p>添加依赖包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add [package]</span><br><span class="line">yarn add [package]@[version]</span><br><span class="line">yarn add [package]@[tag]</span><br></pre></td></tr></table></figure>
<p>将依赖项添加到不同的依赖项类别：devDependencies、peerDependencies 和 optionalDependencies。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add [package] --dev</span><br><span class="line">yarn add [package] --peer</span><br><span class="line">yarn add [package] --optional</span><br></pre></td></tr></table></figure>
<p>升级依赖包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn upgrade [package]</span><br><span class="line">yarn upgrade [package]@[version]</span><br><span class="line">yarn upgrade [package]@[tag]</span><br></pre></td></tr></table></figure>
<p>移除依赖包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn remove [package]</span><br></pre></td></tr></table></figure>
<p>可以直接使用<code>yarn</code>命令安装项目的全部依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br></pre></td></tr></table></figure>
<h1 id="windows-installer">windows-installer</h1>
<p><a href="https://github.com/electron/windows-installer" target="_blank" rel="noopener">windows-installer</a>是一个用于为 Electron 应用程序构建 Windows 安装程序的 Npn 包，底层基于<a href="https://github.com/Squirrel/Squirrel.Windows" target="_blank" rel="noopener">Squirrel</a>（<em>一组用于管理<strong>C#</strong>或<strong>C++</strong>开发的 Windows 应用程序的安装、更新的工具库</em>）进行实现。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev electron-winstaller</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> electronInstaller = <span class="built_in">require</span>(<span class="string">"electron-winstaller"</span>);</span><br><span class="line"></span><br><span class="line">resultPromise = electronInstaller.createWindowsInstaller(&#123;</span><br><span class="line">  appDirectory: <span class="string">"/tmp/build/my-app-64"</span>,</span><br><span class="line">  outputDirectory: <span class="string">"/tmp/build/installer64"</span>,</span><br><span class="line">  authors: <span class="string">"My App Inc."</span>,</span><br><span class="line">  exe: <span class="string">"myapp.exe"</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">resultPromise.then(</span><br><span class="line">  () =&gt; <span class="built_in">console</span>.log(<span class="string">"It worked!"</span>),</span><br><span class="line">  (e) =&gt; <span class="built_in">console</span>.log(<span class="string">`No dice: <span class="subst">$&#123;e.message&#125;</span>`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h1 id="electron-build">electron-build</h1>
<p>除了像上面这样通过预编译包手动打包应用程序，也可以采用<a href="https://github.com/electron-userland/electron-forge" target="_blank" rel="noopener">electron-forge</a>、<a href="https://www.electron.build/" target="_blank" rel="noopener">electron-packager</a>等第三方包来完成这项工作，在这里笔者选择<a href="https://www.electron.build/" target="_blank" rel="noopener">electron-builder</a>来进行自动化打包任务。</p>
<p>Electron Userland 是一个维护 Electron 模块的第三方社区，electron-builder 是由其维护的一款能够同时处理 Windows、MacOS、Linux 多平台的打包编译工具。由于 electron-builder 工具包的文件体积较大，其社区强烈推荐使用更快速的<code>yarn</code>来代替<code>npm</code>作为包管理方案。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add electron-builder --dev</span><br></pre></td></tr></table></figure>
<p>electron-builder 能够以<strong>命令行</strong>或者<strong>JavaScript API</strong>的方式进行使用：</p>
<p>（1）如果安装在项目目录下的<code>node_modules</code>目录，可以直接通过 NodeJS 提供的<code>npx</code>以命令行方式使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx electron-builder</span><br></pre></td></tr></table></figure>
<p>（2）也可以像使用其它 Npm 包那样直接调用 electron-builder 提供的 API。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> builder = <span class="built_in">require</span>(<span class="string">"electron-builder"</span>);</span><br><span class="line"><span class="keyword">const</span> Platform = builder.Platform;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise is returned</span></span><br><span class="line">builder</span><br><span class="line">  .build(&#123;</span><br><span class="line">    targets: Platform.MAC.createTarget(),</span><br><span class="line">    config: &#123;</span><br><span class="line">      <span class="string">"//"</span>: <span class="string">"build options, see https://goo.gl/QQXmcV"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// handle result</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// handle error</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>官方推荐使用<a href="https://github.com/electron-userland/electron-webpack-quick-start" target="_blank" rel="noopener">electron-webpack-quick-start</a>作为 Electron 应用的项目模板。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 指定编译配置</span></span><br><span class="line">  <span class="attr">"build"</span>: &#123;</span><br><span class="line">    <span class="attr">"appId"</span>: <span class="string">"your.id"</span>,</span><br><span class="line">    <span class="attr">"mac"</span>: &#123;</span><br><span class="line">      <span class="attr">"category"</span>: <span class="string">"your.app.category.type"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 添加编译指令</span></span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"pack"</span>: <span class="string">"electron-builder --dir"</span>,</span><br><span class="line">    <span class="attr">"dist"</span>: <span class="string">"electron-builder"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 确保原生依赖总是匹配Electron版本</span></span><br><span class="line">  <span class="attr">"postinstall"</span>: <span class="string">"electron-builder install-app-deps</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果项目中存在原生依赖，还需要设置<a href="https://www.electron.build/configuration/configuration#Configuration-nodeGypRebuild" target="_blank" rel="noopener">nodeGypRebuild</a>为<code>true</code>。</p>
</blockquote>
<p>如果需要调试<code>electron-builder</code>的行为，那么需要设置<code>DEBUG=electron-builder</code>环境变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> DEBUG=electron-builder  // Cmder</span><br><span class="line"><span class="variable">$env</span>:DEBUG=electron-builder  // PowerShell</span><br></pre></td></tr></table></figure>
<h1 id="electron-forge">electron-forge</h1>
<p><a href="https://electronforge.io/" target="_blank" rel="noopener">electron-forge</a>同样是由 Electron Userland 维护的一款命令行工具，用于快速建立、打包、发布一个 Electron 应用程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">λ  npm install -g electron-forge</span><br><span class="line">λ  electron-forge init my-new-project</span><br><span class="line">λ  <span class="built_in">cd</span> my-new-project</span><br><span class="line">λ  electron-forge start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>目前 Github 上 electron-builder 的 Star 远远超过 electron-forge，由于笔者项目需要使用 React，因而也就选用带有支持 React 项目模板的 electron-builder，需要尝试 electron-forge 的同学可以移步官网查看更多信息。</p>
</blockquote>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Hank
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://uinika.github.io/Web/Electron.html" title="使用 Electron 打造跨平台桌面应用">https://uinika.github.io/Web/Electron.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Server/" rel="tag"><i class="fa fa-tag"></i> Server</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Web/Flux.html" rel="prev" title="Flux 数据流两三事儿">
      <i class="fa fa-chevron-left"></i> Flux 数据流两三事儿
    </a></div>
      <div class="post-nav-item">
    <a href="/Web/Javascript.html" rel="next" title="JavaScript 6 简明语法书">
      JavaScript 6 简明语法书 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#getting-start"><span class="nav-number">1.</span> <span class="nav-text">Getting Start</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#主进程与渲染进程"><span class="nav-number">2.</span> <span class="nav-text">主进程与渲染进程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#核心模块"><span class="nav-number">3.</span> <span class="nav-text">核心模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#app-模块"><span class="nav-number">3.1.</span> <span class="nav-text">app 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#browserwindow-模块"><span class="nav-number">3.2.</span> <span class="nav-text">BrowserWindow 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#globalshortcut-模块"><span class="nav-number">3.3.</span> <span class="nav-text">globalShortcut 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#clipboard-模块"><span class="nav-number">3.4.</span> <span class="nav-text">clipboard 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#globalshortcut-模块-1"><span class="nav-number">3.5.</span> <span class="nav-text">globalShortcut 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ipcmain-与-ipcrenderer-模块"><span class="nav-number">3.6.</span> <span class="nav-text">ipcMain 与 ipcRenderer 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#menu-与-menuitem-模块"><span class="nav-number">3.7.</span> <span class="nav-text">Menu 与 MenuItem 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#netlog-模块"><span class="nav-number">3.8.</span> <span class="nav-text">netLog 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#powermonitor-模块"><span class="nav-number">3.9.</span> <span class="nav-text">powerMonitor 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#powersaveblocker-模块"><span class="nav-number">3.10.</span> <span class="nav-text">powerSaveBlocker 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#protocol-模块"><span class="nav-number">3.11.</span> <span class="nav-text">protocol 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#net-模块"><span class="nav-number">3.12.</span> <span class="nav-text">net 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#remote-模块"><span class="nav-number">3.13.</span> <span class="nav-text">remote 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#screen-模块"><span class="nav-number">3.14.</span> <span class="nav-text">screen 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell-模块"><span class="nav-number">3.15.</span> <span class="nav-text">shell 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#systempreferences-模块"><span class="nav-number">3.16.</span> <span class="nav-text">systemPreferences 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tray-模块"><span class="nav-number">3.17.</span> <span class="nav-text">Tray 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webframe-模块"><span class="nav-number">3.18.</span> <span class="nav-text">webFrame 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#session-模块"><span class="nav-number">3.19.</span> <span class="nav-text">session 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#desktopcapturer-模块"><span class="nav-number">3.20.</span> <span class="nav-text">desktopCapturer 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dialog-模块"><span class="nav-number">3.21.</span> <span class="nav-text">dialog 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#contenttracing-模块"><span class="nav-number">3.22.</span> <span class="nav-text">contentTracing 模块</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#webview-标签"><span class="nav-number">4.</span> <span class="nav-text">webview 标签</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#webcontents-属性"><span class="nav-number">5.</span> <span class="nav-text">webContents 属性</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#window.open-函数"><span class="nav-number">6.</span> <span class="nav-text">window.open() 函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#electron-进程"><span class="nav-number">7.</span> <span class="nav-text">Electron 进程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#沙箱机制"><span class="nav-number">8.</span> <span class="nav-text">沙箱机制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#macbook-touchbar-支持"><span class="nav-number">9.</span> <span class="nav-text">MacBook TouchBar 支持</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建应用图标"><span class="nav-number">10.</span> <span class="nav-text">创建应用图标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安全原则"><span class="nav-number">11.</span> <span class="nav-text">安全原则</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用安全的协议加载外部内容"><span class="nav-number">11.1.</span> <span class="nav-text">使用安全的协议加载外部内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加载外部内容时禁用-nodejs-集成"><span class="nav-number">11.2.</span> <span class="nav-text">加载外部内容时禁用 NodeJS 集成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#渲染进程中启用上下文隔离"><span class="nav-number">11.3.</span> <span class="nav-text">渲染进程中启用上下文隔离</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理远程内容中的会话许可"><span class="nav-number">11.4.</span> <span class="nav-text">处理远程内容中的会话许可</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不要禁用-websecurity"><span class="nav-number">11.5.</span> <span class="nav-text">不要禁用 webSecurity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义-csp-安全策略"><span class="nav-number">11.6.</span> <span class="nav-text">定义 CSP 安全策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#别设置-allowrunninginsecurecontent-为-true"><span class="nav-number">11.7.</span> <span class="nav-text">别设置 allowRunningInsecureContent 为 true</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不要开启实验性功能"><span class="nav-number">11.8.</span> <span class="nav-text">不要开启实验性功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不要使用-enableblinkfeatures"><span class="nav-number">11.9.</span> <span class="nav-text">不要使用 enableBlinkFeatures</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用-webview-的-allowpopups"><span class="nav-number">11.10.</span> <span class="nav-text">禁用 webview 的 allowpopups</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证-webview-选项与参数"><span class="nav-number">11.11.</span> <span class="nav-text">验证 webview 选项与参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用或限制网页跳转"><span class="nav-number">11.12.</span> <span class="nav-text">禁用或限制网页跳转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用或限制新窗口创建"><span class="nav-number">11.13.</span> <span class="nav-text">禁用或限制新窗口创建</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#应用发布"><span class="nav-number">12.</span> <span class="nav-text">应用发布</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#asar-打包源码"><span class="nav-number">13.</span> <span class="nav-text">asar 打包源码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rcedit-编辑可执行文件"><span class="nav-number">14.</span> <span class="nav-text">rcedit 编辑可执行文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#yarn-包管理器"><span class="nav-number">15.</span> <span class="nav-text">yarn 包管理器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#windows-installer"><span class="nav-number">16.</span> <span class="nav-text">windows-installer</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#electron-build"><span class="nav-number">17.</span> <span class="nav-text">electron-build</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#electron-forge"><span class="nav-number">18.</span> <span class="nav-text">electron-forge</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hank"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Hank</p>
  <div class="site-description" itemprop="description">My world of IT, learn it & play it.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/uinika" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;uinika" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/uinika/posts" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;uinika&#x2F;posts" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:uinika@outlook.com" title="Email → mailto:uinika@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>Email</a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:uinika@outlook.com?call|chat" title="Skype → skype:uinika@outlook.com?call|chat" rel="noopener" target="_blank"><i class="fa fa-fw fa-skype"></i>Skype</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/7998979/uinika?tab=profile" title="Stack Overflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;7998979&#x2F;uinika?tab&#x3D;profile" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2010 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"><a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.6m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">23:40</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
