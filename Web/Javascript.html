<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#8C634F">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#8C634F">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Monda:300,300italic,400,400italic,700,700italic|Source+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"uinika.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#A38272","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="JavaScript 遵循了 ECMAScript 语言规范，2012 年之后的现代浏览器都完整支持 ECMAScript 5.1 标准。2015 年 6 月 17 日，ECMA 国际组织发布了 ECMAScript 6 标准，官方称为 ECMAScript 2015（俗称为 ES6），从此 ECMAScript 每年发布一次新标准，本文覆盖了当前最新 ECMAScript2017 草案中的新特性">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript 6 简明语法书">
<meta property="og:url" content="https://uinika.github.io/Web/Javascript.html">
<meta property="og:site_name" content="Bit by bit">
<meta property="og:description" content="JavaScript 遵循了 ECMAScript 语言规范，2012 年之后的现代浏览器都完整支持 ECMAScript 5.1 标准。2015 年 6 月 17 日，ECMA 国际组织发布了 ECMAScript 6 标准，官方称为 ECMAScript 2015（俗称为 ES6），从此 ECMAScript 每年发布一次新标准，本文覆盖了当前最新 ECMAScript2017 草案中的新特性">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/logo.png">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/05.simple-object-hierarchy.png">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/05.creating-objects-with-simple-definitions.png">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/05.mark-WorkerBee.png">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/05.figure8.4.png">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/05.figure8.5.png">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/05.figure8.6.png">
<meta property="og:image" content="https://uinika.github.io/Web/Javascript/06.promises.png">
<meta property="article:published_time" content="2020-05-21T13:39:03.845Z">
<meta property="article:modified_time" content="2020-05-21T13:39:03.845Z">
<meta property="article:author" content="Hank">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://uinika.github.io/Web/Javascript/logo.png">

<link rel="canonical" href="https://uinika.github.io/Web/Javascript.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>JavaScript 6 简明语法书 | Bit by bit</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Bit by bit" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bit by bit</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Electronics, Embedded & Web</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-th-large"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">53</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">22</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-briefcase"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-it圈">

    <a href="/industry/" rel="section"><i class="fa fa-fw fa-microchip"></i>IT圈</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/uinika" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://uinika.github.io/Web/Javascript.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Hank">
      <meta itemprop="description" content="My world of IT, learn it & play it.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bit by bit">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JavaScript 6 简明语法书
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 21:39:03" itemprop="dateCreated datePublished" datetime="2020-05-21T21:39:03+08:00">2020-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>49k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>44 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>JavaScript 遵循了 ECMAScript 语言规范，2012 年之后的现代浏览器都完整支持 <strong>ECMAScript 5.1</strong> 标准。2015 年 6 月 17 日，ECMA 国际组织发布了 <strong>ECMAScript 6</strong> 标准，官方称为 <strong>ECMAScript 2015</strong>（俗称为 <strong>ES6</strong>），从此 ECMAScript 每年发布一次新标准，<strong>本文覆盖了当前最新 ECMAScript2017 草案中的新特性</strong>。示例代码和术语定义参考了《JavaScrip 高级程序设计》，但是该书成文于 ES6 发布之前，因此从<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank" rel="noopener">《Mozilla JavaScript Reference》</a>摘取了部分内容作为补充。出于查阅与核对的方便，本文目录结构与 Mozilla 官方英文文档保持一致。</p>
<p><img src="/Web/Javascript/logo.png"></p>
<p>JavaScript 标准化工作由<strong>ECMA</strong>（<em>European Computer Manufacturers Association</em>）国际组织负责，JavaScript 的语言标准被称为<strong>ECMAScript</strong>，企业遵循该标准开发各自的 JavaScript 实现，例如 Firefox 的<code>SpiderMonkey</code>或者 Chrome 中的<code>V8</code>解析引擎（<em>ECMAScript 的规范文档主要针对解析引擎的开发人员，而非 JavaScript 脚本的编写人员</em>）。</p>
<a id="more"></a>
<p>ECMAScript 并未对<strong>文档对象模型 DOM</strong>进行定义，该标准交由<strong>W3C</strong>（<em>World Wide Web Consortium</em>）和<strong>WHATWG</strong>（<em>Web Hypertext Application Technology Working Group</em>）制定。本文使用 Firefox 浏览器作为 JavaScript 测试代码的编写与运行环境，可以通过<code>Ctrl+Shift+K</code>快捷键进入控制台，或者使用<code>Shift+F4</code>进入代码草稿纸，执行和调试本文中的示例代码。</p>
<h2 id="grammar-and-types">Grammar and types</h2>
<p>本章节主要讨论 JavaScript 的基础语法、变量声明、数据类型和字面量。</p>
<h3 id="basics">Basics</h3>
<p>JavaScript 是轻量级的、解释型的、使用<em>first-class functions</em>（<em>即函数能够以参数的形式传递给其它函数，也可以作为其它函数的返回值，或能够以值的形式指派给一个变量</em>）的编程语言，其编程风格是基于原型的、多范式的、面向对象的动态脚本语言。</p>
<p>JavaScript 对大小写敏感，并且使用 Unicode 字符集编码。JavaScript 语句<em>statements</em>以分号进行分隔， 空格、缩进、换行符被称为<em>whitespace</em>，JavaScript 源代码从左至右执行，并能自动在语句尾部插入分号。但为避免出现副作用，依然推荐在语句末尾手动添加分号。</p>
<h3 id="comments">Comments</h3>
<p>JavaScript 注释的语法与 C++等其它语言类似。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a one line comment</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* this is a longer,</span></span><br><span class="line"><span class="comment">   multi-line comment</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* You can't, however, /* nest comments */</span> <span class="built_in">SyntaxError</span> *<span class="regexp">/</span></span><br></pre></td></tr></table></figure>
<h3 id="declarations">Declarations</h3>
<p>JavaScript 拥有 3 种变量声明方式。</p>
<ol type="1">
<li><code>var</code>：声明一个变量。</li>
<li><code>let</code>：声明具有块作用域的变量。</li>
<li><code>const</code>：声明只读的常量。</li>
</ol>
<h3 id="variables">Variables</h3>
<p>变量名称被称为标识符<em>identifiers</em>，必须以<code>字母</code>、下划线<code>_</code>、美元符<code>$</code>开头，其它字符可以是数字或大小写字母。</p>
<h3 id="declaring-variables">Declaring variables</h3>
<p>声明变量有 3 种方式：</p>
<ol type="1">
<li>使用关键字<code>var</code>声明，可以是局部或全局变量。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">42</span>;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>不使用关键字声明，变量为全局变量。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">42</span>;</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>使用关键字<code>let</code>声明一个块作用域变量。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> y = <span class="number">13</span>;</span><br></pre></td></tr></table></figure>
<h3 id="evaluating-variables">Evaluating variables</h3>
<p>使用<code>var</code>或<code>let</code>关键字声明变量时，如果不指定初值，那么其默认值为<code>undefined</code>。因此，如果对一个未经声明的变量进行操作，就会发生<code>ReferenceError</code>错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"The value of a is "</span> + a); <span class="comment">// The value of a is undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"The value of b is "</span> + b); <span class="comment">// The value of b is undefined</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"The value of c is "</span> + c); <span class="comment">// Uncaught ReferenceError: c is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"The value of x is "</span> + x); <span class="comment">// The value of x is undefined</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"The value of y is "</span> + y); <span class="comment">// Uncaught ReferenceError: y is not defined</span></span><br><span class="line"><span class="keyword">let</span> y;</span><br></pre></td></tr></table></figure>
<p>可以通过<code>undefined</code>判断变量是否被赋值，下面代码中 input 变量没有被指定值，if 语句的结果为 true。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input;</span><br><span class="line"><span class="keyword">if</span> (input === <span class="literal">undefined</span>) &#123;</span><br><span class="line">  doThis();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  doThat();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在布尔上下文中，<code>undefined</code>被自动判定为<code>false</code>，下面代码中变量 myArray 的值为 undefined，因此 myFunction()函数将会被执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myArray = [];</span><br><span class="line"><span class="keyword">if</span> (!myArray[<span class="number">0</span>]) myFunction();</span><br></pre></td></tr></table></figure>
<p>数值上下文当中<code>undefined</code>会被转换为<code>NaN</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line">a + <span class="number">2</span>; <span class="comment">// Evaluates to NaN</span></span><br></pre></td></tr></table></figure>
<p>如果变量的值为<code>null</code>，那么该变量在数值上下文中被视为<code>0</code>，布尔表达式中被视为<code>false</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(n * <span class="number">32</span>); <span class="comment">// Will log 0 to the console</span></span><br></pre></td></tr></table></figure>
<h3 id="variable-scope">Variable scope</h3>
<p>函数外部声明的变量是<strong>全局变量</strong>(<em>global variable</em>)，在整个文档上下文中有效。函数内部声明的变量称为<strong>局部变量</strong>(<em>local variable</em>)，只在被声明的函数当中有效。</p>
<p>JavaScript 在 ECMAScript 2015 规范发布之前，并没有块作用域概念。因此代码块中的定义的变量将会被指派到临近的函数作用域或全局作用域。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// x is 5</span></span><br></pre></td></tr></table></figure>
<p>使用 ECMAScript 2015 的 let 关键字声明，则会展现出不同的行为。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(y); <span class="comment">// ReferenceError: y is not defined</span></span><br></pre></td></tr></table></figure>
<h3 id="variable-hoisting">Variable hoisting</h3>
<p>JavaScript 可以引用稍后声明的变量而不会引发异常，即感觉上是将变量提升至函数或语句的顶部，被提升的变量将会返回<code>undefined</code>。即使在使用或引用某个变量之后，再进行声明或初始化操作，这个被提升的引用仍将返回<code>undefined</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Example 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">console</span>.log(x === <span class="literal">undefined</span>); <span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Example 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// will return a value of undefined</span></span><br><span class="line"><span class="keyword">var</span> myvar = <span class="string">"my value"</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(myvar); <span class="comment">// undefined</span></span><br><span class="line">  <span class="keyword">var</span> myvar = <span class="string">"local value"</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>上面代码也可以改写为如下形式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Example 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> x;</span><br><span class="line"><span class="built_in">console</span>.log(x === <span class="literal">undefined</span>); <span class="comment">// true</span></span><br><span class="line">x = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Example 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> myvar = <span class="string">"my value"</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> myvar;</span><br><span class="line">  <span class="built_in">console</span>.log(myvar); <span class="comment">// undefined</span></span><br><span class="line">  myvar = <span class="string">"local value"</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>由于存在变量声明提升，函数中所有<code>var</code>语句应该尽可能放置在接近函数顶部的位置，这将大大提升程序代码的清晰程度。</p>
<p>ECMAScript 2015 当中，<code>let</code>和<code>const</code>将不会被提升至代码块顶部，因此在代码块当中，在变量声明之前引用该变量将会发生<code>ReferenceError</code>(<em>变量进入暂时性死区，直至该变量被声明</em>)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// ReferenceError</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<h3 id="function-hoisting">Function hoisting</h3>
<p>对于函数而言，只有<strong>函数声明</strong>可以被提升至代码顶部，而非<strong>函数表达式</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Function declaration */</span></span><br><span class="line"></span><br><span class="line">foo(); <span class="comment">// "bar"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"bar"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Function expression */</span></span><br><span class="line"></span><br><span class="line">baz(); <span class="comment">// TypeError: baz is not a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> baz = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"bar2"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="global-variables">Global variables</h3>
<p>浏览器中的全局对象是<strong>window</strong>，可以通过<code>window.variable</code>语法读写全局变量。也可以通过指定<em>window</em>或<em>frame</em>的名字，从一个<em>window</em>或<em>frame</em>访问另一个<em>window</em>或<em>frame</em>中声明的变量。例如，在文档中声明 1 个变量<em>phoneNumber</em>，那么就可以在子<em>frame</em>中通过<code>parent.phoneNumber</code>进行引用。</p>
<h3 id="constants">Constants</h3>
<p>可以通过关键字<code>const</code>创建一个只读的常量，常量标识符的命名规则与变量相同。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PI = <span class="number">3.14</span>;</span><br></pre></td></tr></table></figure>
<p>常量不可以通过赋值改变其值，也不可以在脚本运行时重新声明，<strong>它必须被初始化为某个值</strong>。</p>
<p><code>const</code>常量的作用域与<code>let</code>变量的作用域相同，在同一作用域中，常量名不能与变量名、函数名同名。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// THIS WILL CAUSE AN ERROR</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> f = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// THIS WILL CAUSE AN ERROR ALSO</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> g = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">var</span> g;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//statements</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，<code>const</code>声明的对象的属性并不会受到常量的保护。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MY_OBJECT = &#123; <span class="attr">key</span>: <span class="string">"value"</span> &#125;;</span><br><span class="line">MY_OBJECT.key = <span class="string">"otherValue"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="data-structures-and-types">Data structures and types</h3>
<ul>
<li><p>原生数据类型 Boolean、null、undefined、Number、String、Symbol(<em>ECMAScript 2015 定义的全新数据类型，其实例唯一并且不可变</em>)。</p></li>
<li><p>引用数据类型，对象 Object。</p></li>
</ul>
<h3 id="data-type-conversion">Data type conversion</h3>
<p>JavaScript 是动态类型语言，声明变量时不需要指定数据类型，因为在脚本执行过程中变量的数据类型会动态转换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> answer = <span class="number">42</span>;</span><br><span class="line">answer = <span class="string">"Thanks for all the fish..."</span>;</span><br></pre></td></tr></table></figure>
<p>在涉及加号运算符<strong>+</strong>的数字和字符串表达式中，JavaScript 自动将数字值转换为字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="string">"The answer is "</span> + <span class="number">42</span>; <span class="comment">// "The answer is 42"</span></span><br><span class="line">y = <span class="number">42</span> + <span class="string">" is the answer"</span>; <span class="comment">// "42 is the answer"</span></span><br></pre></td></tr></table></figure>
<p>涉及其它运算符时，JavaScript 并不会将数字转换为字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"37"</span> - <span class="number">7</span>; <span class="comment">// 30</span></span><br><span class="line"><span class="string">"37"</span> + <span class="number">7</span>; <span class="comment">// "377"</span></span><br></pre></td></tr></table></figure>
<h3 id="converting-strings-to-numbers">Converting strings to numbers</h3>
<p>可以通过下面 2 种方法将字符串转换为对应的数字。</p>
<ol type="1">
<li>通过<code>parseInt()</code>、<code>parseFloat()</code>进行转换。</li>
<li>使用单目的加法运算符<code>+</code>。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"1.1"</span> + <span class="string">"1.1"</span> = <span class="string">"1.11.1"</span>(+<span class="string">"1.1"</span>) + +<span class="string">"1.1"</span> = <span class="number">2.2</span>;</span><br><span class="line"><span class="comment">// Note: the parentheses are added for clarity, not required.</span></span><br></pre></td></tr></table></figure>
<h3 id="literals">Literals</h3>
<p>计算机科学中，字面量<em>literal</em>用于表达源代码中一个固定值的表示方法，例如整数、浮点数、字符串、布尔类型。而在 JavaScript 当中，可以使用如下几种字面量：</p>
<h4 id="array-literals">Array literals</h4>
<p>数组字面量是使用方括号<code>[]</code>包含零个或多个表达式的列表，每个表达式代表数组的 1 个元素，数组的长度就是方括号中元素的个数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> coffees = [<span class="string">"French Roast"</span>, <span class="string">"Colombian"</span>, <span class="string">"Kona"</span>];</span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a.length); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(a[<span class="number">0</span>]); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>如果在方括号中连续书写 2 个逗号<code>,</code>，数组就会产生一个值为<code>undefined</code>的元素，下面数组<code>fish</code>的第 2 个元素值为 undefined。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fish = [<span class="string">"Lion"</span>, , <span class="string">"Angel"</span>];</span><br></pre></td></tr></table></figure>
<p>往数组列表最后一个元素后添加的逗号将被忽略，例如下面代码中数组<code>myList</code>的长度为<code>3</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myList = [<span class="string">"home"</span>, , <span class="string">"school"</span>];</span><br></pre></td></tr></table></figure>
<p>下面代码中，数组<code>myList</code>的长度为 4，元素<code>myList[0]</code>和<code>myList[2]</code>缺失，被默认为<code>undefined</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myList = [, <span class="string">"home"</span>, , <span class="string">"school"</span>];</span><br></pre></td></tr></table></figure>
<p>再看一个例子，数组<code>myList</code>的长度是<code>4</code>，元素<code>myList[1]</code>和<code>myList[3]</code>缺失，只有最后的逗号被忽略。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myList = [<span class="string">"home"</span>, , <span class="string">"school"</span>, ,];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>显式将缺失的元素声明为<code>undefined</code>，将大大提高代码的清晰度和可维护性。</p>
</blockquote>
<h4 id="boolean-literals">Boolean literals</h4>
<p>布尔类型有<code>true</code>和<code>false</code>两种字面量。</p>
<blockquote>
<p>不要混淆布尔对象与原始布尔类型，布尔对象只是原始布尔类型的包装类。</p>
</blockquote>
<h4 id="integers">Integers</h4>
<p>整数可以用如下方式表示：</p>
<ol type="1">
<li><strong>十进制</strong>整数由一串数字序列组成，没有任何前缀。</li>
<li><strong>八进制</strong>整数以 0(或 0O、0o)开头，只能包括数字 0-7。</li>
<li><strong>十六进制</strong>整数以 0x(或 0X)开头，可以包含数字 0-9 和字母 a~f 或 A~F。</li>
<li><strong>二进制</strong>整数以 0b(或 0B)开头，只能包含数字 0 和 1。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>, <span class="number">117</span> and <span class="number">-345</span> (decimal, base <span class="number">10</span>)</span><br><span class="line"><span class="number">015</span>, <span class="number">0001</span> and <span class="number">-0</span>o77 (octal, base <span class="number">8</span>)</span><br><span class="line"><span class="number">0x1123</span>, <span class="number">0x00111</span> and <span class="number">-0xF1A7</span> (hexadecimal, <span class="string">"hex"</span> or base <span class="number">16</span>)</span><br><span class="line"><span class="number">0b11</span>, <span class="number">0b0011</span> and <span class="number">-0</span>b11 (binary, base <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h4 id="floating-point-literals">Floating-point literals</h4>
<p>浮点数可以以小数或指数形式表示，但至少拥有一位数字，且必须带小数点或者 e 或 E。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.14</span> -</span><br><span class="line"><span class="number">0.2345789</span> - <span class="comment">// -0.23456789</span></span><br><span class="line">  <span class="number">3.12e12</span>; <span class="comment">// -3.12*1012</span></span><br><span class="line"><span class="number">0.1e-23</span>; <span class="comment">// 0.1*10-23=10-24=1e-24</span></span><br></pre></td></tr></table></figure>
<h4 id="object-literals">Object literals</h4>
<p>对象字面量是封闭在花括号<code>{}</code>中的<em>键-值对</em>的列表。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Sales = <span class="string">"Toyota"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CarTypes</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> name === <span class="string">"Honda"</span> ? name : <span class="string">"Sorry, we don't sell "</span> + name + <span class="string">"."</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car = &#123; <span class="attr">myCar</span>: <span class="string">"Saturn"</span>, <span class="attr">getCar</span>: CarTypes(<span class="string">"Honda"</span>), <span class="attr">special</span>: Sales &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(car.myCar); <span class="comment">// Saturn</span></span><br><span class="line"><span class="built_in">console</span>.log(car.getCar); <span class="comment">// Honda</span></span><br><span class="line"><span class="built_in">console</span>.log(car.special); <span class="comment">// Toyota</span></span><br></pre></td></tr></table></figure>
<p>可以使用数字或字符串作为属性名，也可以嵌套使用对象字面量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> car = &#123; <span class="attr">manyCars</span>: &#123; <span class="attr">a</span>: <span class="string">"Saab"</span>, <span class="attr">b</span>: <span class="string">"Jeep"</span> &#125;, <span class="number">7</span>: <span class="string">"Mazda"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(car.manyCars.b); <span class="comment">// Jeep</span></span><br><span class="line"><span class="built_in">console</span>.log(car[<span class="number">7</span>]); <span class="comment">// Mazda</span></span><br></pre></td></tr></table></figure>
<p>对象属性名可以使用空字符串，如果对象属性名是非法的标识符，则必须使用双引号<code>""</code>进行包裹。不合法的属性名不能用<code>.</code>访问其属性值，而要通过类数组标记<code>[""]</code>进行访问和赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unusualPropertyNames = &#123;</span><br><span class="line">  <span class="string">""</span>: <span class="string">"An empty string"</span>,</span><br><span class="line">  <span class="string">"!"</span>: <span class="string">"Bang!"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(unusualPropertyNames.<span class="string">""</span>);   <span class="comment">// SyntaxError: Unexpected string</span></span><br><span class="line"><span class="built_in">console</span>.log(unusualPropertyNames[<span class="string">""</span>]);  <span class="comment">// An empty string</span></span><br><span class="line"><span class="built_in">console</span>.log(unusualPropertyNames.!);    <span class="comment">// SyntaxError: Unexpected token !</span></span><br><span class="line"><span class="built_in">console</span>.log(unusualPropertyNames[<span class="string">"!"</span>]); <span class="comment">// Bang!</span></span><br></pre></td></tr></table></figure>
<p>注意观察如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123; <span class="attr">a</span>: <span class="string">"alpha"</span>, <span class="number">2</span>: <span class="string">"two"</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(foo.a); <span class="comment">// alpha</span></span><br><span class="line"><span class="built_in">console</span>.log(foo[<span class="number">2</span>]); <span class="comment">// two</span></span><br><span class="line"><span class="comment">//console.log(foo.2);  // Error: missing ) after argument list</span></span><br><span class="line"><span class="comment">//console.log(foo[a]); // Error: a is not defined</span></span><br><span class="line"><span class="built_in">console</span>.log(foo[<span class="string">"a"</span>]); <span class="comment">// alpha</span></span><br><span class="line"><span class="built_in">console</span>.log(foo[<span class="string">"2"</span>]); <span class="comment">// two</span></span><br></pre></td></tr></table></figure>
<p>ES2015 当中，对象字面量提供了更多的新特性(<strong>例如在创建时设置原型、简写 foo：foo 属性赋值、定义方法、调用父类的 super 方法、使用表达式动态计算属性名</strong>)，更利于面向对象的设计。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="comment">// __proto__</span></span><br><span class="line">  __proto__: theProtoObj,</span><br><span class="line">  <span class="comment">// Shorthand for ‘handler: handler’</span></span><br><span class="line">  handler,</span><br><span class="line">  <span class="comment">// Methods</span></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="comment">// Super calls</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"d "</span> + <span class="keyword">super</span>.toString();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Computed (dynamic) property names</span></span><br><span class="line">  [<span class="string">"prop_"</span> + <span class="function">(<span class="params">(</span>) =&gt;</span> <span class="number">42</span>)()]: <span class="number">42</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="regexp-literals">RegExp literals</h4>
<p>正则表达式字面量通过正斜杠<code>/</code>包围正则表达式而成。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="regexp">/ab+c/</span>;</span><br></pre></td></tr></table></figure>
<h4 id="string-literals">String literals</h4>
<p>由双引号<code>"</code>或单引号<code>‘</code>括起来的零个或多个字符。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"foo"</span>;</span><br><span class="line"><span class="string">"bar"</span>;</span><br><span class="line"><span class="string">"1234"</span>;</span><br><span class="line"><span class="string">"one line \n another line"</span>;</span><br><span class="line"><span class="string">"John's cat"</span>;</span><br></pre></td></tr></table></figure>
<p>可以在<em>字符串字面量</em>上使用<em>字符串对象</em>的所有方法，JavaScript 会自动将字符串字面量转换为临时的字符串对象。当方法调用完毕之后，该临时字符串对象就会被销毁。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"John's cat"</span>.length);</span><br><span class="line"><span class="comment">// Will print the number of symbols in the string including whitespace.</span></span><br><span class="line"><span class="comment">// In this case, 10.</span></span><br></pre></td></tr></table></figure>
<p>ES2015 提供了模板字面量特性(<em>template literals</em>)，提供了一些语法糖帮助构建字符串。除此之外，还可以在模板字面量中通过添加标签来自定义模板的解析过程，从而防止注入攻击，或者建立基于字符串的高级封装。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Basic literal string creation</span></span><br><span class="line"><span class="string">`In JavaScript '\n' is a line-feed.`</span><span class="string">`In JavaScript template strings can run // Multiline strings</span></span><br><span class="line"><span class="string"> over multiple lines, but double and single</span></span><br><span class="line"><span class="string"> quoted strings cannot.`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// String interpolation</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Bob"</span>,</span><br><span class="line">  time = <span class="string">"today"</span>;</span><br><span class="line"><span class="string">`Hello <span class="subst">$&#123;name&#125;</span>, how are you <span class="subst">$&#123;time&#125;</span>?`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Construct an HTTP request prefix is used to interpret the replacements and construction</span></span><br><span class="line">POST<span class="string">`http://foo.org/bar?a=<span class="subst">$&#123;a&#125;</span>&amp;b=<span class="subst">$&#123;b&#125;</span></span></span><br><span class="line"><span class="string">     Content-Type: application/json</span></span><br><span class="line"><span class="string">     X-Credentials: <span class="subst">$&#123;credentials&#125;</span></span></span><br><span class="line"><span class="string">     &#123; "foo": <span class="subst">$&#123;foo&#125;</span>,</span></span><br><span class="line"><span class="string">       "bar": <span class="subst">$&#123;bar&#125;</span>&#125;`</span>(myOnReadyStateChangeHandler);</span><br></pre></td></tr></table></figure>
<p>转义字符(<em>Escaping characters</em>)，通过在引号前加上反斜线<code>\</code>，可以在字符串中插入引号。下面表格展示了 JavaScript 当中常用的一些转义字符：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">元素</th>
<th style="text-align: left;">语义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>\0</code></td>
<td style="text-align: left;">Null 字节</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\b</code></td>
<td style="text-align: left;">退格符</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>\f</code></td>
<td style="text-align: left;">换页符</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\n</code></td>
<td style="text-align: left;">换行符</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>\r</code></td>
<td style="text-align: left;">回车符</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\t</code></td>
<td style="text-align: left;">Tab (制表符)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>\v</code></td>
<td style="text-align: left;">垂直制表符</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\'</code></td>
<td style="text-align: left;">单引号</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>\"</code></td>
<td style="text-align: left;">双引号</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\\</code></td>
<td style="text-align: left;">反斜杠字符（）</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>\XXX</code></td>
<td style="text-align: left;">由从 0 ～ 377 最多三位八进制数 XXX 表示的 Latin-1 字符，例如\251 是版权标识的八进制序列。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\xXX</code></td>
<td style="text-align: left;">由从 00 ～ FF 两位十六进制数字 XX 表示的 Latin-1 字符，例如 是版权标识的十六进制序列。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>\uXXXX</code></td>
<td style="text-align: left;">由四位十六进制数字 XXXX 表示的 Unicode 字符，例如 是版权标识的 Unicode 序列。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\uXXXXX</code></td>
<td style="text-align: left;">Unicode code point 转义字符。例如相当于 Unicode 转义字符87E 的简写。</td>
</tr>
</tbody>
</table>
<p>可以按照以下方式，在字符串中使用转义字符。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> quote = <span class="string">'He read "The Cremation of Sam McGee" by R.W. Service.'</span>;</span><br><span class="line"><span class="keyword">var</span> test = <span class="string">"one line \n another line"</span>;</span><br><span class="line"><span class="keyword">var</span> home = <span class="string">"c:\\temp"</span>;</span><br></pre></td></tr></table></figure>
<p>JavaScript 中执行换行有 2 种方式，一种是在换行之前加上反斜线<code>\</code>转义换行码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str =</span><br><span class="line">  <span class="string">"this string \</span></span><br><span class="line"><span class="string">is broken \</span></span><br><span class="line"><span class="string">across multiple\</span></span><br><span class="line"><span class="string">lines."</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str); <span class="comment">// this string is broken across multiplelines.</span></span><br></pre></td></tr></table></figure>
<p>另一种方式，则是直接在行末添加换行符进行转义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> poem =</span><br><span class="line">  <span class="string">"Roses are red,\n\</span></span><br><span class="line"><span class="string">Violets are blue.\n\</span></span><br><span class="line"><span class="string">Sugar is sweet,\n\</span></span><br><span class="line"><span class="string">and so is foo."</span>;</span><br></pre></td></tr></table></figure>
<h2 id="functions">Functions</h2>
<p>函数是 JavaScript 的基本组成部分之一，包含了一段用于执行特定计算的语句，调用函数时，必须在调用该函数的作用域内对其进行定义。</p>
<h3 id="defining-function">Defining function</h3>
<h4 id="函数声明">函数声明</h4>
<p>由函数名称、参数列表、函数语句构成，例如下面代码定义了一个 square 函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> number * number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">theObject</span>) </span>&#123;</span><br><span class="line">  theObject.make = <span class="string">"Toyota"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mycar = &#123; <span class="attr">make</span>: <span class="string">"Honda"</span>, <span class="attr">model</span>: <span class="string">"Accord"</span>, <span class="attr">year</span>: <span class="number">1998</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> x, y;</span><br><span class="line"></span><br><span class="line">x = mycar.make; <span class="comment">// x gets the value "Honda"</span></span><br><span class="line"></span><br><span class="line">myFunc(mycar);</span><br><span class="line">y = mycar.make; <span class="comment">// y gets the value "Toyota"</span></span><br><span class="line"><span class="comment">// (the make property was changed by the function)</span></span><br></pre></td></tr></table></figure>
<h4 id="函数表达式">函数表达式</h4>
<p>函数也可以通过函数表达式的方式来创建，这样的函数是匿名的，例如函数 square 也可这样进行定义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> square = <span class="function"><span class="keyword">function</span> (<span class="params">number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> number * number;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> x = square(<span class="number">4</span>); <span class="comment">// x gets the value 16</span></span><br></pre></td></tr></table></figure>
<p>当然，这样方式定义的函数也可以提供函数名，并且可以用于在函数内部指代函数本身，例如下面代码中的 fac 函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> factorial = <span class="function"><span class="keyword">function</span> <span class="title">fac</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n &lt; <span class="number">2</span> ? <span class="number">1</span> : n * fac(n - <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(factorial(<span class="number">3</span>));</span><br></pre></td></tr></table></figure>
<p>通过这种方式，可以很方便的将函数作为参数传递给另外一个函数，例如下面的 map 函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">f, a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = [], <span class="comment">// Create a new Array</span></span><br><span class="line">    i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i != a.length; i++) result[i] = f(a[i]);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> multiply = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x * x;</span><br><span class="line">&#125;; <span class="comment">// Expression function.</span></span><br><span class="line">map(multiply, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">10</span>]);</span><br></pre></td></tr></table></figure>
<p>JavaScript 当中，可以先进行条件判断后，再来对函数进行定义，例如当 num 等于 0 时才会定义 myFunc。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myFunc;</span><br><span class="line"><span class="keyword">if</span> (num === <span class="number">0</span>) &#123;</span><br><span class="line">  myFunc = <span class="function"><span class="keyword">function</span> (<span class="params">theObject</span>) </span>&#123;</span><br><span class="line">    theObject.make = <span class="string">"Toyota"</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>除上述 2 种定义函数的方法之外，也可以在运行时用 Function 构造器来创建一个函数。</p>
</blockquote>
<h3 id="calling-functions">Calling functions</h3>
<p>定义函数仅仅是赋予其名称并明确被调用后的行为，函数只有在调用后才会被真正执行，例如定义 square 函数之后可以这样进行调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">square(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p>函数的调用和函数的定义一定要处于同一个作用域，其中函数声明的方式可以进行函数提升。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(square(<span class="number">5</span>));</span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是使用函数表达式定义函数时，则无法实现函数提升。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(square); <span class="comment">// square is hoisted with an initial value undefined.</span></span><br><span class="line"><span class="built_in">console</span>.log(square(<span class="number">5</span>)); <span class="comment">// TypeError: square is not a function</span></span><br><span class="line"><span class="keyword">var</span> square = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在函数内部可以使用当前函数名进行递归操作，即函数可以调用其本身，例如下面函数执行的递归阶乘运算：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">0</span> || n === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// You could then compute the factorials of one through five as follows</span></span><br><span class="line"><span class="keyword">var</span> a, b, c, d, e;</span><br><span class="line">a = factorial(<span class="number">1</span>); <span class="comment">// a gets the value 1</span></span><br><span class="line">b = factorial(<span class="number">2</span>); <span class="comment">// b gets the value 2</span></span><br><span class="line">c = factorial(<span class="number">3</span>); <span class="comment">// c gets the value 6</span></span><br><span class="line">d = factorial(<span class="number">4</span>); <span class="comment">// d gets the value 24</span></span><br><span class="line">e = factorial(<span class="number">5</span>); <span class="comment">// e gets the value 120</span></span><br></pre></td></tr></table></figure>
<h3 id="function-scope">Function scope</h3>
<p>在函数作用域中定义的函数，可以访问其父函数中定义的所有变量，以及父函数有权访问的任何其他变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The following variables are defined in the global scope</span></span><br><span class="line"><span class="keyword">var</span> num1 = <span class="number">20</span>,</span><br><span class="line">  num2 = <span class="number">3</span>,</span><br><span class="line">  name = <span class="string">"Chamahk"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This function is defined in the global scope</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1 * num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiply(); <span class="comment">// Returns 60</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A nested function example</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num1 = <span class="number">2</span>,</span><br><span class="line">    num2 = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">" scored "</span> + (num1 + num2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> add();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getScore(); <span class="comment">// Returns "Chamahk scored 5"</span></span><br></pre></td></tr></table></figure>
<h3 id="scope-and-the-function-stack">Scope and the function stack</h3>
<h4 id="递归">递归</h4>
<p>递归是指函数可以指向并调用自身。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// statements go here</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在该函数作用域下，有 3 种方式可以调用该函数本身。</p>
<ol type="1">
<li>函数名<code>bar()</code></li>
<li>语句<code>arguments.callee()</code></li>
<li>指向该函数的变量名<code>foo()</code></li>
</ol>
<p>调用自身的函数称为<strong>递归函数</strong>(<em>recursive function</em>)，某种意义上<strong>递归</strong>类似于<strong>循环</strong>，都是在重复执行相同的代码，且都需要一个避免陷入无限循环/递归的终止条件。</p>
<p>例如，下面的 while 循环：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (x &lt; <span class="number">10</span>) &#123;</span><br><span class="line">  <span class="comment">// "x &lt; 10" is the loop condition</span></span><br><span class="line">  <span class="comment">// do stuff</span></span><br><span class="line">  x++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以被转换为递归函数<code>loop()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loop</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x &gt;= <span class="number">10</span>)</span><br><span class="line">    <span class="comment">// "x &gt;= 10" is the exit condition (equivalent to "!(x &lt; 10)")</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// do stuff</span></span><br><span class="line">  loop(x + <span class="number">1</span>); <span class="comment">// the recursive call</span></span><br><span class="line">&#125;</span><br><span class="line">loop(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>有些算法不能使用简单的循环来实现，例如获取树结构的所有节点时，使用递归函数将会更加简便。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">walkTree</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (node == <span class="literal">null</span>)</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// do something with node</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">    walkTree(node.childNodes[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>递归函数当中使用了<strong>函数堆栈</strong>，具体请看下面的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (i &lt; <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"begin: "</span> + i);</span><br><span class="line">  foo(i - <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"end: "</span> + i);</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// begin: 3</span></span><br><span class="line"><span class="comment">// begin: 2</span></span><br><span class="line"><span class="comment">// begin: 1</span></span><br><span class="line"><span class="comment">// begin: 0</span></span><br><span class="line"><span class="comment">// end: 0</span></span><br><span class="line"><span class="comment">// end: 1</span></span><br><span class="line"><span class="comment">// end: 2</span></span><br><span class="line"><span class="comment">// end: 3</span></span><br></pre></td></tr></table></figure>
<h4 id="嵌套函数和闭包">嵌套函数和闭包</h4>
<p>闭包(<em>closure</em>)是拥有自身独立环境和变量的表达式(通常是函数)，在一个函数内嵌套另外一个函数，此时内部函数就形成了闭包。</p>
<p>内部函数只可以在外部函数中访问，且内部函数相对外部函数是私有的(不能使用外部函数的参数和变量)，但内部函数可以继承外部函数的参数和变量。换而言之，内部函数可以包含外部函数的作用域。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addSquares</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">square</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> square(a) + square(b);</span><br><span class="line">&#125;</span><br><span class="line">a = addSquares(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">// returns 13</span></span><br><span class="line">b = addSquares(<span class="number">3</span>, <span class="number">4</span>); <span class="comment">// returns 25</span></span><br><span class="line">c = addSquares(<span class="number">4</span>, <span class="number">5</span>); <span class="comment">// returns 41</span></span><br></pre></td></tr></table></figure>
<p>由于内部函数形成了闭包，所以可以在内部函数当中调用外部函数，并为外部函数和内部函数指定参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outside</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">inside</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> inside;</span><br><span class="line">&#125;</span><br><span class="line">fn_inside = outside(<span class="number">3</span>); <span class="comment">// Think of it like: give me a function that adds 3 to whatever you give it</span></span><br><span class="line">result = fn_inside(<span class="number">5</span>); <span class="comment">// returns 8</span></span><br><span class="line"></span><br><span class="line">result1 = outside(<span class="number">3</span>)(<span class="number">5</span>); <span class="comment">// returns 8</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意上例中<code>inside</code>被返回时<code>x</code>是如何保留下来的，一个闭包中必须保存其可见作用域中的所有参数和变量，因为每次调用所传入的参数可能都是不同的，每次对外部函数的调用实际上相当于重新创建了这个闭包，只有当返回的<code>inside</code>没有再被引用时，相应的内存才会被释放。</p>
</blockquote>
<h4 id="多层嵌套函数">多层嵌套函数</h4>
<p>函数可以被多层嵌套(例如，函数 A 可以包含函数 B，函数 B 可以再包含函数 C)，最终 B 和 C 都形成了闭包，所以 B 可以访问 A，C 可以访问 B 和 A。因此，闭包能够以类似递归的方式包含多个作用域，从而形成一条作用域链(<em>scope chaining</em>)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params">z</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(x + y + z);</span><br><span class="line">    &#125;</span><br><span class="line">    C(<span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  B(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">A(<span class="number">1</span>); <span class="comment">// logs 6 (1 + 2 + 3)</span></span><br></pre></td></tr></table></figure>
<p>上面例子中，C 可以访问 B 的 y、A 的 x，因为 B 是一个包含了 A 的闭包，所以 B 可以访问 A 的参数和变量；C 是一个包含了 B 的闭包，因为 B 包含 A，C 也包含 A，所以 C 可以访问 B 和 A 的参数和变量。但是，反过来 A 却不能访问 C，因为 A 看不到 B 中的参数和变量，而 C 是 B 中的一个变量，所以 C 是 B 私有的。</p>
<h4 id="命名冲突">命名冲突</h4>
<p>当同一个闭包作用域下 2 个参数或者变量同名时，就会产生命名冲突。更近的作用域拥有更高的优先级，更远的作用域优先级相应也就更低。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outside</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">inside</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> inside;</span><br><span class="line">&#125;</span><br><span class="line">result = outside()(<span class="number">20</span>); <span class="comment">// returns 20 instead of 10</span></span><br></pre></td></tr></table></figure>
<h3 id="closures">Closures</h3>
<p>闭包是 JavaScript 中最强大的特性之一，JavaScript 允许函数嵌套，并且内部函数可以访问定义在外部函数中的所有变量和函数，以及外部函数能访问的所有变量和函数。但外部函数却不能够访问定义在内部函数中的变量和函数，这给内部函数的变量提供了一定的安全性。当内部函数以某种方式被任何一个外部函数作用域访问时，就产生了一个<strong>闭包</strong>。</p>
<blockquote>
<p>当内部函数生存周期大于外部函数时，由于内部函数可以访问外部函数的作用域，定义在外部函数的变量、函数的生存周期就会大于外部函数本身。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pet = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// The outer function defines a variable called "name"</span></span><br><span class="line">  <span class="keyword">var</span> getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name; <span class="comment">// The inner function has access to the "name" variable of the outer function</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> getName; <span class="comment">// Return the inner function, thereby exposing it to outer scopes</span></span><br><span class="line">&#125;;</span><br><span class="line">myPet = pet(<span class="string">"Vivie"</span>);</span><br><span class="line"></span><br><span class="line">myPet(); <span class="comment">// Returns "Vivie"</span></span><br></pre></td></tr></table></figure>
<p>实际代码可能更加复杂，在下面的情形中，返回了一个包含可以操作外部函数的一系列方法所组成的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createPet = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sex;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setName: <span class="function"><span class="keyword">function</span> (<span class="params">newName</span>) </span>&#123;</span><br><span class="line">      name = newName;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> name;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    getSex: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    setSex: <span class="function"><span class="keyword">function</span> (<span class="params">newSex</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="keyword">typeof</span> newSex === <span class="string">"string"</span> &amp;&amp;</span><br><span class="line">        (newSex.toLowerCase() === <span class="string">"male"</span> || newSex.toLowerCase() === <span class="string">"female"</span>)</span><br><span class="line">      ) &#123;</span><br><span class="line">        sex = newSex;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pet = createPet(<span class="string">"Vivie"</span>);</span><br><span class="line">pet.getName(); <span class="comment">// Vivie</span></span><br><span class="line"></span><br><span class="line">pet.setName(<span class="string">"Oliver"</span>);</span><br><span class="line">pet.setSex(<span class="string">"male"</span>);</span><br><span class="line">pet.getSex(); <span class="comment">// male</span></span><br><span class="line">pet.getName(); <span class="comment">// Oliver</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，内嵌函数可以操作外部函数的<code>name</code>参数，除了内嵌函数本身，没有其它方法可以取得内嵌的变量。内嵌函数的内嵌变量就像保险柜一样，为内嵌函数保留稳定而又安全的数据去参与运算。这些内嵌函数可以不被分配给一个变量，甚至不一定要有名字。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getCode = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> secureCode = <span class="string">"0]Eal(eh&amp;2"</span>; <span class="comment">// A code we do not want outsiders to be able to modify...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> secureCode;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">getCode(); <span class="comment">// Returns the secureCode</span></span><br></pre></td></tr></table></figure>
<p>尽管有上述优点，但使用闭包时仍然要小心避免一些陷阱，例如外部函数定义了与内部函数相同的变量名，那么外部函数将再也无法指向该变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createPet = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Outer function defines a variable called "name"</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setName: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Enclosed function also defines a variable called "name"</span></span><br><span class="line">      name = name; <span class="comment">// ??? How do we access the "name" defined by the outer function ???</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>闭包中的 this 变量非常诡异，使用时必须十分小心，因为 this 指代什么完全取决于函数在何处被调用，而非在何处被定义。</p>
</blockquote>
<h3 id="arguments-object">Arguments object</h3>
<p>函数的实际参数会被保存在一个类似数组的 arguments 对象中，在函数作用域内可以通过<code>arguments[i]</code>引用传入的参数，第 1 个传来的参数是<code>arguments[0]</code>，参数个数可以通过<code>arguments.length</code>获得。使用 arguments 对象，可以处理比声明个数更多的参数，这在事先不知道参数个数的场景下十分有用。</p>
<p>例如，设想有一个用来连接字符串的函数，唯一事先确定的参数是用来分隔字符串各连接部分的字符(即下面例子中的<code>separator</code>参数)，该函数可以按如下方式进行定义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myConcat</span>(<span class="params">separator</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">""</span>; <span class="comment">// initialize list</span></span><br><span class="line">  <span class="keyword">var</span> i;</span><br><span class="line">  <span class="comment">// iterate through arguments</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">    result += <span class="built_in">arguments</span>[i] + separator;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以向这个函数传递任意数量的参数，从而返回一个由各参数连接而成的字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// returns "red, orange, blue, "</span></span><br><span class="line">myConcat(<span class="string">", "</span>, <span class="string">"red"</span>, <span class="string">"orange"</span>, <span class="string">"blue"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// returns "elephant; giraffe; lion; cheetah; "</span></span><br><span class="line">myConcat(<span class="string">"; "</span>, <span class="string">"elephant"</span>, <span class="string">"giraffe"</span>, <span class="string">"lion"</span>, <span class="string">"cheetah"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// returns "sage. basil. oregano. pepper. parsley. "</span></span><br><span class="line">myConcat(<span class="string">". "</span>, <span class="string">"sage"</span>, <span class="string">"basil"</span>, <span class="string">"oregano"</span>, <span class="string">"pepper"</span>, <span class="string">"parsley"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>arguments 变量只是<em>类数组对象</em>，并不是一个真正意义的数组，称其为类数组对象只是因为其具备索引和 length 属性，但并不拥有其它 Array 对象的操作方法。</p>
</blockquote>
<h3 id="function-parameter">Function parameter</h3>
<p>ECMAScript 6 为函数添加了两个新类型的参数：默认参数(<em>default parameters</em>)，剩余参数(<em>rest parameters</em>)。</p>
<h4 id="default-parameters">Default parameters</h4>
<p>JavaScript 中，函数参数的默认值是 undefined。然而某些情况下可能需要设置不同的默认值，此时就可以考虑使用默认参数。</p>
<blockquote>
<p>过去设定默认值的方法是在函数内判断参数值是否为 undefined，如果为 true 则赋予一个默认值。</p>
</blockquote>
<p>下面例子中，调用函数时没有实参传递给 b，其值默认为 undefined，于是 a*b 计算得到 NaN：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  b = <span class="keyword">typeof</span> b !== <span class="string">"undefined"</span> ? b : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiply(<span class="number">5</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<p>使用默认参数之后，就不再需要对参数进行默认值检查。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiply(<span class="number">5</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h4 id="rest-parameters">Rest parameters</h4>
<p>剩余参数语法允许将不确定数量的参数表示为数组，下面例子中，使用剩余参数收集从第 2 个至最后 1 个参数，然后将剩余参数数组的每个元素与第 1 个参数相乘。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">multiplier, ...theArgs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> theArgs.map(<span class="function">(<span class="params">x</span>) =&gt;</span> multiplier * x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = multiply(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [2, 4, 6]</span></span><br></pre></td></tr></table></figure>
<h3 id="arrow-functions">Arrow functions</h3>
<p>箭头函数表达式与函数表达式相比，具有更简短的语法，并以词法方式绑定 this。</p>
<blockquote>
<p>箭头函数总是匿名的。</p>
</blockquote>
<h4 id="更简短的语法">更简短的语法</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="string">"Hydrogen"</span>, <span class="string">"Helium"</span>, <span class="string">"Lithium"</span>, <span class="string">"Beryllium"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a2 = a.map(<span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.length;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a2); <span class="comment">// logs [8, 6, 7, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a3 = a.map(<span class="function">(<span class="params">s</span>) =&gt;</span> s.length);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a3); <span class="comment">// logs [8, 6, 7, 9]</span></span><br></pre></td></tr></table></figure>
<h3 id="词法式绑定-this">词法式绑定 this</h3>
<p>箭头函数出现之前，每个新函数都重新定义了自己的 this(严格模式下，以函数方式调用时 this 为 undefined，以对象方式使用时 this 指向对象上下文)，不利于实现面向对象的编程风格。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// The Person() constructor defines `this` as itself.</span></span><br><span class="line">  <span class="keyword">this</span>.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span> <span class="title">growUp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// In nonstrict mode, the growUp() function defines `this`</span></span><br><span class="line">    <span class="comment">// as the global object, which is different from the `this`</span></span><br><span class="line">    <span class="comment">// defined by the Person() constructor.</span></span><br><span class="line">    <span class="keyword">this</span>.age++;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure>
<p>ECMAScript 3/5 当中，通过把 this 的值赋值给一个变量可以修复该问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>; <span class="comment">// Some choose `that` instead of `self`.</span></span><br><span class="line">  <span class="comment">// Choose one and be consistent.</span></span><br><span class="line">  self.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span> <span class="title">growUp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// The callback refers to the `self` variable of which</span></span><br><span class="line">    <span class="comment">// the value is the expected object.</span></span><br><span class="line">    self.age++;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以使用 Function.prototype.bind()方法为函数传递正确的 this。</p>
</blockquote>
<p>使用箭头函数可以正确捕捉闭包上下文中的 this 值，所以下面的代码工作正常。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.age++; <span class="comment">// |this| properly refers to the person object</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure>
<h3 id="predefined-functions">Predefined functions</h3>
<p>JavaScript 语言当中的顶级内建函数：</p>
<ul>
<li><p>eval()：对字符串格式的 JavaScript 代码求值。</p></li>
<li><p>uneval()：创建的一个 Object 的源代码的字符串表示。</p></li>
<li><p>isFinite()：判断传入的值是否为有限的数值。</p></li>
<li><p>isNaN()：判断一个值是否是 NaN，其内部的强制转换规则十分有趣(可以考虑使用 ES6 中定义的 Number.isNaN()代替，或使用 typeof 来判断数值类型)。</p></li>
<li><p>parseFloat()：解析字符串参数，并返回一个浮点数。</p></li>
<li><p>parseInt()：解析字符串参数，并返回指定基数的整数。</p></li>
<li><p>decodeURI()：对经过 encodeURI 函数或其他类似方法编码过的字符串进行解码。</p></li>
<li><p>decodeURIComponent()：对经过 encodeURIComponent 函数或其他类似方法编码过的字符串进行解码。</p></li>
<li><p>encodeURI()：通过用以一个，两个，三个或四个转义序列表示字符的 UTF-8 编码替换统一资源标识符(URI)的某些字符来进行编码(每个字符对应四个转义序列，这四个序列组了两个”替代“字符)。</p></li>
<li><p>encodeURIComponent()：通过用以一个，两个，三个或四个转义序列表示字符的 UTF-8 编码替换统一资源标识符（URI）的每个字符来进行编码（每个字符对应四个转义序列，这四个序列组了两个”替代“字符）。</p></li>
<li><p>escape()： <em>已废弃</em>，用于计算生成一个新的字符串，其中的某些字符已被替换为十六进制转义序列。使用 encodeURI 或者 encodeURIComponent 替代本方法。</p></li>
<li><p>unescape()：<em>已废弃</em>，用于计算生成一个新的字符串，其中的十六进制转义序列将被其表示的字符替换。建议使用 decodeURI()或者 decodeURIComponent 替代本方法。</p></li>
</ul>
<h2 id="working-with-objects">Working with objects</h2>
<p>Javascript 基于简单的对象范式设计，一个对象由多个<code>key-value</code>属性组成。</p>
<h3 id="objects-overview">Objects overview</h3>
<p>Javascript 对象的概念可以比照现实生活中的物体，一个对象就是一个拥有属性和类型的实体。例如，一个杯子可以看作一个拥有颜色，图案，重量，材质等属性的对象。</p>
<h3 id="objects-and-properties">Objects and properties</h3>
<p>属性用来定义对象的特征，可以通过点运算符<code>.</code>来访问。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objectName.propertyName;</span><br></pre></td></tr></table></figure>
<p>对象名字与变量一样对大小写敏感，可以在定义对象属性时直接进行赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myCar = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">myCar.make = <span class="string">"Ford"</span>;</span><br><span class="line">myCar.model = <span class="string">"Mustang"</span>;</span><br><span class="line">myCar.year = <span class="number">1969</span>;</span><br></pre></td></tr></table></figure>
<p>没有赋值的属性默认为<code>undefined</code>，而非<code>null</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myCar.color; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>对象的属性也可以通过方括号<code>[]</code>访问或设置，例如可以按下面方式访问<code>myCar</code>对象的属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// four variables are created and assigned in a single go,</span></span><br><span class="line"><span class="comment">// separated by commas</span></span><br><span class="line"><span class="keyword">var</span> myObj = <span class="keyword">new</span> <span class="built_in">Object</span>(),</span><br><span class="line">  str = <span class="string">"myString"</span>,</span><br><span class="line">  rand = <span class="built_in">Math</span>.random(),</span><br><span class="line">  obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line">myObj.type = <span class="string">"Dot syntax"</span>;</span><br><span class="line">myObj[<span class="string">"date created"</span>] = <span class="string">"String with space"</span>;</span><br><span class="line">myObj[str] = <span class="string">"String value"</span>;</span><br><span class="line">myObj[rand] = <span class="string">"Random Number"</span>;</span><br><span class="line">myObj[obj] = <span class="string">"Object"</span>;</span><br><span class="line">myObj[<span class="string">""</span>] = <span class="string">"Even an empty string"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myObj);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为每个对象属性都有一个用于访问它的字符串值，所以对象有时也被称为关联数组(<em>associative arrays</em>) 。</p>
</blockquote>
<p>当然，也可以通过变量作为索引来访问对象的属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> propertyName = <span class="string">"make"</span>;</span><br><span class="line">myCar[propertyName] = <span class="string">"Ford"</span>;</span><br><span class="line"></span><br><span class="line">propertyName = <span class="string">"model"</span>;</span><br><span class="line">myCar[propertyName] = <span class="string">"Mustang"</span>;</span><br></pre></td></tr></table></figure>
<p>可以在<code>for...in</code>语句中通过方括号<code>[]</code>来枚举一个对象的全部属性，如下<code>showProps(obj, objName)</code>函数的作用是将某个对象及其名称作为参数传入时，返回该对象全部属性所组成的字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showProps</span>(<span class="params">obj, objName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="comment">// obj.hasOwnProperty() is used to filter out properties from the object's prototype chain</span></span><br><span class="line">    <span class="keyword">if</span> (obj.hasOwnProperty(i)) &#123;</span><br><span class="line">      result += objName + <span class="string">"."</span> + i + <span class="string">" = "</span> + obj[i] + <span class="string">"\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，函数调用<code>showProps(myCar, "myCar")</code>将返回以下值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myCar.make = Ford;</span><br><span class="line">myCar.model = Mustang;</span><br><span class="line">myCar.year = <span class="number">1969</span>;</span><br></pre></td></tr></table></figure>
<h3 id="enumerate-the-properties-of-an-object">Enumerate the properties of an object</h3>
<p>从 ECMAScript 5 开始，有 3 种原生方法可以用于枚举对象的属性：</p>
<ul>
<li><p><code>for...in</code> 依次访问一个对象及其原型链中所有可枚举的属性。</p></li>
<li><p><code>Object.keys(o)</code> 返回对象 o 所拥有的属性名称(不包括原型)组成的数组。</p></li>
<li><p><code>Object.getOwnPropertyNames(o)</code> 返回对象 o 所拥有属性名称(无论是否可枚举)组成的数组。</p></li>
</ul>
<p>在 ECMAScript 5 之前，没有原生方法可以枚举对象的所有属性，但可以通过如下编写函数来完成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listAllProperties</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> objectToInspect;</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (</span><br><span class="line">    objectToInspect = o;</span><br><span class="line">    objectToInspect !== <span class="literal">null</span>;</span><br><span class="line">    objectToInspect = <span class="built_in">Object</span>.getPrototypeOf(objectToInspect)</span><br><span class="line">  ) &#123;</span><br><span class="line">    result = result.concat(<span class="built_in">Object</span>.getOwnPropertyNames(objectToInspect));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个函数在展示隐藏属性(即原型中不能通过对象访问的属性，因为更早的原型链中包含有相同的属性名)时很有用，可以通过在数组中去除同名元素即可列出需要访问的属性。</p>
</blockquote>
<h3 id="creating-new-objects">Creating new objects</h3>
<h4 id="using-object-initializers">Using object initializers</h4>
<p>对象初始化器(<em>object initializer</em>)也被称为对象字面量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  property_1: value_1, <span class="comment">// property_# may be an identifier...</span></span><br><span class="line">  property_2: value_2, <span class="comment">// or a number...</span></span><br><span class="line">  <span class="comment">// ...,</span></span><br><span class="line">  <span class="string">"property n"</span>: value_n,</span><br><span class="line">&#125;; <span class="comment">// or a string</span></span><br></pre></td></tr></table></figure>
<p>JavaScript 每次遇到对象字面量时都会创建对象，同样的，在函数中的对象字面量，在每次函数调用时也会创建对象。</p>
<p>下面例子中，只有当<code>cond</code>的值为<code>true</code>时，才会创建对象并赋值给变量<code>x</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (cond) <span class="keyword">var</span> x = &#123; <span class="attr">greeting</span>: <span class="string">"hi there"</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>下面例子中，<code>myHonda</code>对象拥有 3 个属性，且其<code>engine</code>属性本身也是一个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myHonda = &#123; <span class="attr">color</span>: <span class="string">"red"</span>, <span class="attr">wheels</span>: <span class="number">4</span>, <span class="attr">engine</span>: &#123; <span class="attr">cylinders</span>: <span class="number">4</span>, <span class="attr">size</span>: <span class="number">2.2</span> &#125; &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="using-a-constructor-function">Using a constructor function</h4>
<p>首先，创建一个构造函数来定义对象(<em>通常构造函数首字母大写</em>)，然后通过<code>new</code>关键字创建对象实例。</p>
<p>下面创建一个 Car 类，拥有 make, model, year 属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">make, model, year</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.make = make;</span><br><span class="line">  <span class="keyword">this</span>.model = model;</span><br><span class="line">  <span class="keyword">this</span>.year = year;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意通过 this 关键字将传入函数的参数赋值给对象属性。</p>
</blockquote>
<p>接下来，可以像这样来创建 mycar 对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mycar = <span class="keyword">new</span> Car(<span class="string">"Eagle"</span>, <span class="string">"Talon TSi"</span>, <span class="number">1993</span>);</span><br><span class="line"><span class="keyword">var</span> kenscar = <span class="keyword">new</span> Car(<span class="string">"Nissan"</span>, <span class="string">"300ZX"</span>, <span class="number">1992</span>);</span><br><span class="line"><span class="keyword">var</span> vpgscar = <span class="keyword">new</span> Car(<span class="string">"Mazda"</span>, <span class="string">"Miata"</span>, <span class="number">1990</span>);</span><br></pre></td></tr></table></figure>
<p>一个对象的属性值可以是另一个对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rand = <span class="keyword">new</span> Person(<span class="string">"Rand McKinnon"</span>, <span class="number">33</span>, <span class="string">"M"</span>);</span><br><span class="line"><span class="keyword">var</span> ken = <span class="keyword">new</span> Person(<span class="string">"Ken Jones"</span>, <span class="number">39</span>, <span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">make, model, year, owner</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.make = make;</span><br><span class="line">  <span class="keyword">this</span>.model = model;</span><br><span class="line">  <span class="keyword">this</span>.year = year;</span><br><span class="line">  <span class="keyword">this</span>.owner = owner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car1 = <span class="keyword">new</span> Car(<span class="string">"Eagle"</span>, <span class="string">"Talon TSi"</span>, <span class="number">1993</span>, rand);</span><br><span class="line"><span class="keyword">var</span> car2 = <span class="keyword">new</span> Car(<span class="string">"Nissan"</span>, <span class="string">"300ZX"</span>, <span class="number">1992</span>, ken);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码将 rand、ken 作为 owner 参数的值。</p>
</blockquote>
<p>可以使用下面代码访问 car2 的拥有者的姓名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">car2.owner.name;</span><br></pre></td></tr></table></figure>
<p>可以总是为之前定义的对象增加新的属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">car1.color = <span class="string">"black"</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为 car1 增加 color 属性，并赋值为"black"，然而这并不会影响其它对象。</p>
</blockquote>
<blockquote>
<p>要为某个类型的所有对象增加新属性，必须将属性加入到 Car 对象的类型定义函数中。</p>
</blockquote>
<h4 id="using-the-object.create-method">Using the Object.create method</h4>
<p>通过 Object.create()创建对象时，可以通过传入第 1 个参数选定要创建对象的原型，第 2 个参数指定创建对象的属性和值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Animal properties and method encapsulation</span></span><br><span class="line"><span class="keyword">var</span> Animal = &#123;</span><br><span class="line">  type: <span class="string">"Invertebrates"</span>, <span class="comment">// Default value of properties</span></span><br><span class="line">  displayType: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Method which will display type of Animal</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.type);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create new animal type called animal1</span></span><br><span class="line"><span class="keyword">var</span> animal1 = <span class="built_in">Object</span>.create(Animal);</span><br><span class="line">animal1.displayType(); <span class="comment">// Output:Invertebrates</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create new animal type called Fishes</span></span><br><span class="line"><span class="keyword">var</span> fish = <span class="built_in">Object</span>.create(Animal);</span><br><span class="line">fish.type = <span class="string">"Fishes"</span>;</span><br><span class="line">fish.displayType(); <span class="comment">// Output:Fishes</span></span><br></pre></td></tr></table></figure>
<h3 id="inheritance">Inheritance</h3>
<p>所有 JavaScript 对象至少继承于一个对象，被继承的对象称作原型，原型中的属性可以通过<code>prototype</code>属性进行访问。</p>
<h3 id="indexing-object-properties">Indexing object properties</h3>
<p>如果最初使用字符串名称定义一个属性，则后面可以通过该字符串名称来访问(无论通过点运算符<code>.</code>还是数组运算符<code>[]</code>)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj[<span class="string">"name"</span>] = <span class="string">"test"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj[<span class="string">"name"</span>]); <span class="comment">// test</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.name); <span class="comment">// test</span></span><br></pre></td></tr></table></figure>
<p>但是，如果使用了数字来定义属性名称，则必须通过索引进行访问。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line">obj[<span class="number">5</span>]=<span class="string">"test"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj[<span class="number">5</span>]); <span class="comment">// test</span></span><br><span class="line"><span class="built_in">console</span>.log(obj<span class="number">.5</span>); <span class="comment">// Exception: SyntaxError: missing ) after argument list</span></span><br></pre></td></tr></table></figure>
<p>对于 DOM 操作情况其实也类似，例如获取 forms 数组，即可以通过数字访问(<em>出现在 DOM 中的序数</em>)，也可以通过字符串访问(<em>标签 form 的 name 属性</em>)。</p>
例如，HTML 文档中第 2 个
<form>
<p>标签拥有一个值为<code>myForm</code>的<code>name</code>属性，那么可以通过下面 3 种方式都访问该 form 元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.forms[<span class="number">1</span>];</span><br><span class="line"><span class="built_in">document</span>.forms[<span class="string">"myForm"</span>];</span><br><span class="line"><span class="built_in">document</span>.forms.myForm;</span><br></pre></td></tr></table></figure>
<h3 id="defining-properties-for-an-object-type">Defining properties for an object type</h3>
<p>我们可以通过 prototype 属性，为上面定义过的 Car 类定义属性，从而让 Car 类的所有对象都具备该属性。下面代码为<code>Car</code>类增加了<code>color</code>属性，然后为对象<code>car1</code>的<code>color</code>属性赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Car.prototype.color = <span class="literal">null</span>;</span><br><span class="line">car1.color = <span class="string">"black"</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参见 Function 对象的 prototype 属性。</p>
</blockquote>
<h3 id="defining-methods">Defining methods</h3>
<p>对象的方法是指与某个对象属性关联的函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">objectName.methodname = function_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObj = &#123;</span><br><span class="line">  myMethod: <span class="function"><span class="keyword">function</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...do something</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// OR THIS WORKS TOO</span></span><br><span class="line"></span><br><span class="line">  myOtherMethod(params) &#123;</span><br><span class="line">    <span class="comment">// ...do something else</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// then call the method in the context of the object as follows</span></span><br><span class="line">object.methodname(params);</span><br></pre></td></tr></table></figure>
<p>可以在对象的构造函数中定义该对象的方法，例如为之前定义过的 Car 对象添加一个格式化显示其属性的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">displayCar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">"A Beautiful "</span> + <span class="keyword">this</span>.year + <span class="string">" "</span> + <span class="keyword">this</span>.make + <span class="string">" "</span> + <span class="keyword">this</span>.model;</span><br><span class="line">  pretty_print(result); <span class="comment">// pretty_print is a function to display a horizontal rule and a string.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.displayCar = displayCar;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">make, model, year, owner</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.make = make;</span><br><span class="line">  <span class="keyword">this</span>.model = model;</span><br><span class="line">  <span class="keyword">this</span>.year = year;</span><br><span class="line">  <span class="keyword">this</span>.owner = owner;</span><br><span class="line">  <span class="keyword">this</span>.displayCar = displayCar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">car1.displayCar();</span><br><span class="line">car2.displayCar();</span><br></pre></td></tr></table></figure>
<ul>
<li>注意上面代码中的 this 指代的是该方法所属的对象。</li>
</ul>
<h3 id="using-this-for-object-references">Using this for object references</h3>
<p>关键字 this 在对象的方法中可以用来指代当前对象，例如，下面代码中用来检测某个对象属性中的最大/最小值的<code>validate</code>函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params">obj, lowval, hival</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj.value &lt; lowval || obj.value &gt; hival) &#123;</span><br><span class="line">    alert(<span class="string">"Invalid Value!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在每个元素的<code>onchange</code>事件处理器中调用该<code>validate()</code>并将 this 传入。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">size</span>=<span class="string">"3"</span> <span class="attr">onChange</span>=<span class="string">"validate(this, 18, 99)"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>this 可以在 HTML 表单中指代当前 form 元素，下面例子中，表单中 button 元素的 onclick 事件处理器通过<code>this.form</code>来指代其所在的表单元素<code>myForm</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>Form name:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"text1"</span> <span class="attr">value</span>=<span class="string">"Beluga"</span> /&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">name</span>=<span class="string">"button1"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"button"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">value</span>=<span class="string">"Show Form Name"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">onclick</span>=<span class="string">"this.form.text1.value = this.form.name"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="defining-getters-and-setters">Defining getters and setters</h3>
<p>getter/setter 语法用来获取或设置对象(<em>通过对象字面量定义</em>)的属性，直接定义 getter/setter 函数的语法为<code>get property()</code>或<code>set proerty()</code>，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">  a: <span class="number">7</span>,</span><br><span class="line">  <span class="keyword">get</span> b() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.a + <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> c(x) &#123;</span><br><span class="line">    <span class="keyword">this</span>.a = x / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 7</span></span><br><span class="line"><span class="built_in">console</span>.log(o.b); <span class="comment">// 8</span></span><br><span class="line">o.c = <span class="number">50</span>;</span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要注意，getter/setter 的函数名称应该为对象字面量中的属性名。</p>
</blockquote>
<p>如果需要定义一个已经声明的函数作为 getter/setter，可以使用<code>Object.defineProperty</code>语法(旧语法中使用<code>Object.prototype.__defineGetter__</code>)。</p>
<p>下面例子使用 getter/setter 为 Date 对象的原型添加 year 属性，定义 year 属性的 getter/setter 时用到了 Date 类中已有的 getFullYear 和 setFullYear 方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// These statements define a getter and setter for the year property.</span></span><br><span class="line"><span class="keyword">var</span> d = <span class="built_in">Date</span>.prototype;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(d, <span class="string">"year"</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>: function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.getFullYear();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>: function (y) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setFullYear(y);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// These statements use the getter and setter in a Date object.</span></span><br><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="built_in">console</span>.log(now.year); <span class="comment">// 2000</span></span><br><span class="line">now.year = <span class="number">2001</span>; <span class="comment">// 987617605170</span></span><br><span class="line"><span class="built_in">console</span>.log(now);</span><br><span class="line"><span class="comment">// Wed Apr 18 11:13:25 GMT-0700 (Pacific Daylight Time) 2001</span></span><br></pre></td></tr></table></figure>
<p>总结一下，定义 getter/setter 方法有 2 种方式：</p>
<ol type="1">
<li>在对象字面量中添加<code>get/set property()</code>函数，其中 getter 方法没有参数，而 setter 方法只接受 1 个参数(<em>设置新值</em>）。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">  a: <span class="number">7</span>,</span><br><span class="line">  <span class="keyword">get</span> b() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.a + <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> c(x) &#123;</span><br><span class="line">    <span class="keyword">this</span>.a = x / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>使用 Object.defineProperties 函数，对一个已创建的对象添加 getter/setter 方法，该函数第 1 个参数是需要定义 getter/setter 的对象，第 2 个参数是一个对象，该对象的属性名会作为 getter/setter 的名字，属性值是用来定义 getter/setter 的函数，下面例子定义了和上面相同的 getter/setter 方法。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123; <span class="attr">a</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperties(o, &#123;</span><br><span class="line">  b: &#123;</span><br><span class="line">    <span class="keyword">get</span>: function () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.a + <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  c: &#123;</span><br><span class="line">    <span class="keyword">set</span>: function (x) &#123;</span><br><span class="line">      <span class="keyword">this</span>.a = x / <span class="number">2</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">o.c = <span class="number">10</span>; <span class="comment">// Runs the setter, which assigns 10 / 2 (5) to the 'a' property</span></span><br><span class="line"><span class="built_in">console</span>.log(o.b); <span class="comment">// Runs the getter, which yields a + 1 or 6</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这两种定义方式取决于当前的编程风格和工作量，第 1 种方式更加简洁和自然，第 2 种方式虽然更能体现 JavaScript 的动态特性，但也会让代码变得更加难以阅读和理解。</p>
</blockquote>
<h3 id="deleting-properties">Deleting properties</h3>
<p>可以使用<code>delete</code>操作符删除一个非继承的属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creates a new object, myobj, with two properties, a and b.</span></span><br><span class="line"><span class="keyword">var</span> myobj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">myobj.a = <span class="number">5</span>;</span><br><span class="line">myobj.b = <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Removes the a property, leaving myobj with only the b property.</span></span><br><span class="line"><span class="keyword">delete</span> myobj.a;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a"</span> <span class="keyword">in</span> myobj); <span class="comment">// yields "false"</span></span><br></pre></td></tr></table></figure>
<p>如果一个全局变量未使用<code>var</code>关键字声明，那么也可以通过<code>delete</code>进行删除。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g = <span class="number">17</span>;</span><br><span class="line"><span class="keyword">delete</span> g;</span><br></pre></td></tr></table></figure>
<h3 id="comparing-objects">Comparing Objects</h3>
<p>JavaScript 对象属于引用类型，任意 2 个单独的对象永远不可能相等，即使它们拥有相同的属性。只有在比较 2 个具备相同引用的对象时才返回 true。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Two variables, two distinct objects with the same properties</span></span><br><span class="line"><span class="keyword">var</span> fruit = &#123; <span class="attr">name</span>: <span class="string">"apple"</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> fruitbear = &#123; <span class="attr">name</span>: <span class="string">"apple"</span> &#125;;</span><br><span class="line"></span><br><span class="line">fruit == fruitbear; <span class="comment">// return false</span></span><br><span class="line">fruit === fruitbear; <span class="comment">// return false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Two variables, a single object</span></span><br><span class="line"><span class="keyword">var</span> fruit = &#123; <span class="attr">name</span>: <span class="string">"apple"</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> fruitbear = fruit; <span class="comment">// assign fruit object reference to fruitbear</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// here fruit and fruitbear are pointing to same object</span></span><br><span class="line">fruit == fruitbear; <span class="comment">// return true</span></span><br><span class="line">fruit === fruitbear; <span class="comment">// return true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fruit.name = <span class="string">"grape"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(fruitbear); <span class="comment">// yields &#123; name: "grape" &#125; instead of &#123; name: "apple" &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="details-of-the-object-model">Details of the object model</h2>
<p>JavaScript 是基于原型(<em>而非基于类</em>)的面向对象语言。</p>
<h3 id="class-based-vs.-prototype-based-languages">Class-based vs. prototype-based languages</h3>
<p>基于类的面向对象语言，构建在类(<em>class</em>)和实例(<em>instance</em>)两个概念之上。</p>
<ul>
<li><p><strong>类</strong>：定义了所有用于具有某一组特征对象的属性，类并不描述任何特定的个体。</p></li>
<li><p><strong>实例</strong>：类的实例化体现，即类的一个成员。</p></li>
</ul>
<p>JavaScript 等基于原型的语言只会拥有<strong>对象</strong>，且具备一个<strong>原型对象</strong>(<em>prototypical object</em>)的概念。原型对象可以作为新对象获取属性的模板，但新对象可以(<em>在创建时或运行时</em>)指定其自身属性。而任何对象都可以作为另一个对象的原型(<em>prototype</em>)，从而允许后者共享前者的属性。下面的表格展示了基于类(Java)和基于原型(JavaScript)语言中对象概念的一些比较：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">基于类 (Java)</th>
<th style="text-align: left;">基于原型的 (JavaScript)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">类、实例分别为不同的概念</td>
<td style="text-align: left;">所有对象均为实例</td>
</tr>
<tr class="even">
<td style="text-align: left;">通过类定义定义类，然后通过构造方法来实例化类</td>
<td style="text-align: left;">通过构造器函数来定义、创建一个对象</td>
</tr>
<tr class="odd">
<td style="text-align: left;">通过<code>new</code>操作符创建单个对象</td>
<td style="text-align: left;">同样通过<code>new</code>操作符创建对象</td>
</tr>
<tr class="even">
<td style="text-align: left;">通过类定义来定义子类，从而构建对象的层级结构</td>
<td style="text-align: left;">指定一个对象作为原型并且与构造函数一起构建对象的层级结构</td>
</tr>
<tr class="odd">
<td style="text-align: left;">遵循类链继承属性</td>
<td style="text-align: left;">遵循原型链继承属性</td>
</tr>
<tr class="even">
<td style="text-align: left;">类定义指定类所有实例的全部属性，无法在运行时动态添加属性</td>
<td style="text-align: left;">构造器函数或原型指定初始的属性，然后允许动态的向单个对象或者整个对象集合中添加或移除属性</td>
</tr>
</tbody>
</table>
<h3 id="the-employee-example">The employee example</h3>
<p><img src="/Web/Javascript/05.simple-object-hierarchy.png"></p>
<h4 id="employee-definitions">Employee definitions</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String name = <span class="string">""</span>;</span><br><span class="line">   <span class="keyword">public</span> String dept = <span class="string">"general"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">this</span>.dept = <span class="string">"general"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="manager-and-workerbee-definitions">Manager and WorkerBee definitions</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> Employee[] reports = <span class="keyword">new</span> Employee[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkerBee</span> <span class="keyword">extends</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String[] projects = <span class="keyword">new</span> String[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Manager</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Employee.call(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.reports = [];</span><br><span class="line">&#125;</span><br><span class="line">Manager.prototype = <span class="built_in">Object</span>.create(Employee.prototype);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WorkerBee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Employee.call(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.projects = [];</span><br><span class="line">&#125;</span><br><span class="line">WorkerBee.prototype = <span class="built_in">Object</span>.create(Employee.prototype);</span><br></pre></td></tr></table></figure>
<h4 id="salesperson-and-engineer-definitions">SalesPerson and Engineer definitions</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SalesPerson</span> <span class="keyword">extends</span> <span class="title">WorkerBee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String dept = <span class="string">"sales"</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">double</span> quota = <span class="number">100.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> <span class="keyword">extends</span> <span class="title">WorkerBee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String dept = <span class="string">"engineering"</span>;</span><br><span class="line">   <span class="keyword">public</span> String machine = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SalesPerson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  WorkerBee.call(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.dept = <span class="string">"sales"</span>;</span><br><span class="line">  <span class="keyword">this</span>.quota = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line">SalesPerson.prototype = <span class="built_in">Object</span>.create(WorkerBee.prototype);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  WorkerBee.call(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.dept = <span class="string">"engineering"</span>;</span><br><span class="line">  <span class="keyword">this</span>.machine = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype = <span class="built_in">Object</span>.create(WorkerBee.prototype);</span><br></pre></td></tr></table></figure>
<h4 id="creating-objects-with-simple-definitions">Creating objects with simple definitions</h4>
<p><img src="/Web/Javascript/05.creating-objects-with-simple-definitions.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jim = <span class="keyword">new</span> Employee(); <span class="comment">// parentheses can be omitted if the constructor takes no arguments</span></span><br><span class="line"><span class="comment">// jim.name is ''</span></span><br><span class="line"><span class="comment">// jim.dept is 'general'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sally = <span class="keyword">new</span> Manager();</span><br><span class="line"><span class="comment">// sally.name is ''</span></span><br><span class="line"><span class="comment">// sally.dept is 'general'</span></span><br><span class="line"><span class="comment">// sally.reports is []</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mark = <span class="keyword">new</span> WorkerBee();</span><br><span class="line"><span class="comment">// mark.name is ''</span></span><br><span class="line"><span class="comment">// mark.dept is 'general'</span></span><br><span class="line"><span class="comment">// mark.projects is []</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fred = <span class="keyword">new</span> SalesPerson();</span><br><span class="line"><span class="comment">// fred.name is ''</span></span><br><span class="line"><span class="comment">// fred.dept is 'sales'</span></span><br><span class="line"><span class="comment">// fred.projects is []</span></span><br><span class="line"><span class="comment">// fred.quota is 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jane = <span class="keyword">new</span> Engineer();</span><br><span class="line"><span class="comment">// jane.name is ''</span></span><br><span class="line"><span class="comment">// jane.dept is 'engineering'</span></span><br><span class="line"><span class="comment">// jane.projects is []</span></span><br><span class="line"><span class="comment">// jane.machine is ''</span></span><br></pre></td></tr></table></figure>
<h3 id="object-properties">Object properties</h3>
<p>接下来讨论，对象如何通过 prototype chain 从其它对象继承属性，以及在运行时添加 1 个属性时所发生的情况。</p>
<h4 id="inheriting-properties">Inheriting properties</h4>
<p>假如通过下面语句创建了 mark 作为 WorkerBee 对象的实例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mark = <span class="keyword">new</span> WorkerBee();</span><br></pre></td></tr></table></figure>
<p>javascript 解析<code>new</code>操作符时，会创建一个通用对象，并将其作为关键字<code>this</code>的值传递给<code>WorkerBee</code>构造函数。该构造函数显式的设置 projects 的属性值，然后隐式的将该构造函数内部的<code>__proto__</code>属性设置为 WorkerBee.prototype 的值，<code>__proto__</code>最终决定了返回对象属性时所使用的原型链。最后，JavaScript 返回新创建的对象，并赋值给变量 mark。</p>
<p><img src="/Web/Javascript/05.mark-WorkerBee.png"></p>
<p>上述过程，不会显式将<code>mark</code>所继承原型链中的属性作为本地变量存放在 mark 对象，获取属性值时，javascript 首先检查对象本身是否存在该属性值；如果有，则返回该值；如果不存在，则会通过<code>__proto__</code>对原型链进行检查。如果原型链中包含该属性值，则返回这个值；如果没有找到该属性，就认为对象中不存在该属性；因此，mark 对象中的属性打印如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mark.name = <span class="string">""</span>;</span><br><span class="line">mark.dept = <span class="string">"general"</span>;</span><br><span class="line">mark.projects = [];</span><br></pre></td></tr></table></figure>
<p>构造函数当中的属性值，是 WorkerBee 中所有对象所共享的默认值，但可以通过 mark 来修改这些属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mark.name = <span class="string">"Doe, Mark"</span>;</span><br><span class="line">mark.dept = <span class="string">"admin"</span>;</span><br><span class="line">mark.projects = [<span class="string">"navigator"</span>];</span><br></pre></td></tr></table></figure>
<h4 id="adding-properties">Adding properties</h4>
<p>JavaScript 可以在运行时为任意对象添加属性，而不必受限于构造器函数提供的属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mark.bonus = <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样对象 mark 就拥有了 bonus 属性，而其它 WorkerBee 则不具备该属性。</p>
</blockquote>
<p>如果向构造器函数的原型对象添加属性，那么该属性将添加到从该原型中继承属性的所有对象当中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Employee.prototype.specialty = <span class="string">"none"</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行上面语句后，mark 对象将会拥有<code>specialty</code>属性，其值为<code>"none"</code>。</p>
</blockquote>
<p>下图展示了在<code>Employee</code>原型中添加该属性，然后在<code>Engineer</code>原型中重载该属性的效果。</p>
<p><img src="/Web/Javascript/05.figure8.4.png"></p>
<h3 id="more-flexible-constructors">More flexible constructors</h3>
<p>我们可以通过为构造函数传入参数，来创建具有指定属性值的实例。</p>
<p><img src="/Web/Javascript/05.figure8.5.png"></p>
<p>接下来的代码用 Java 和 Javascript 分别描述了上面图表中对象的定义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String name;</span><br><span class="line">   <span class="keyword">public</span> String dept;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Employee</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>(<span class="string">""</span>, <span class="string">"general"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Employee</span> <span class="params">(String name)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>(name, <span class="string">"general"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Employee</span> <span class="params">(String name, String dept)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = name;</span><br><span class="line">      <span class="keyword">this</span>.dept = dept;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Javascript</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params">name, dept</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name || <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">this</span>.dept = dept || <span class="string">"general"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkerBee</span> <span class="keyword">extends</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String[] projects;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">WorkerBee</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>(<span class="keyword">new</span> String[<span class="number">0</span>]);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">WorkerBee</span> <span class="params">(String[] projs)</span> </span>&#123;</span><br><span class="line">      projects = projs;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Javascript</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WorkerBee</span>(<span class="params">projs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.projects = projs || [];</span><br><span class="line">&#125;</span><br><span class="line">WorkerBee.prototype = <span class="keyword">new</span> Employee();</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> <span class="keyword">extends</span> <span class="title">WorkerBee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String machine;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Engineer</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      dept = <span class="string">"engineering"</span>;</span><br><span class="line">      machine = <span class="string">""</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Engineer</span> <span class="params">(String mach)</span> </span>&#123;</span><br><span class="line">      dept = <span class="string">"engineering"</span>;</span><br><span class="line">      machine = mach;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Javascript</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params">mach</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.dept = <span class="string">"engineering"</span>;</span><br><span class="line">  <span class="keyword">this</span>.machine = mach || <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype = <span class="keyword">new</span> WorkerBee();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码中，使用了 JavaScript 设置默认值的习惯性用法，通过逻辑或操作符<code>||</code>对第 1 个参数进行布尔运算，如果结果为真，则操作符返回该值，否则操作符返回第 2 个参数的值。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.name = name || <span class="string">""</span>;</span><br></pre></td></tr></table></figure>
<p>运行上述代码之后，可以通过如下语句创建新的<code>Engineer</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jane = <span class="keyword">new</span> Engineer(<span class="string">"belau"</span>);</span><br></pre></td></tr></table></figure>
<p>此时，<code>Jane</code>的属性如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jane.name == <span class="string">""</span>;</span><br><span class="line">jane.dept == <span class="string">"engineering"</span>;</span><br><span class="line">jane.projects == [];</span><br><span class="line">jane.machine == <span class="string">"belau"</span>;</span><br></pre></td></tr></table></figure>
<p>到目前为止，构造函数已经能够创建一个普通对象，然后为新对象指定本地的属性和属性值。接下来，还可以直接调用原型链上更高层次对象的构造函数，从而添加更多的属性。</p>
<p><img src="/Web/Javascript/05.figure8.6.png"></p>
<p>下面代码是<code>Engineer</code>构造器的定义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params">name, projs, mach</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.base = WorkerBee;</span><br><span class="line">  <span class="keyword">this</span>.base(name, <span class="string">"engineering"</span>, projs);</span><br><span class="line">  <span class="keyword">this</span>.machine = mach || <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如下所示，创建一个新的<code>Engineer</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jane = <span class="keyword">new</span> Engineer(<span class="string">"Doe, Jane"</span>, [<span class="string">"navigator"</span>, <span class="string">"javascript"</span>], <span class="string">"belau"</span>);</span><br></pre></td></tr></table></figure>
<p>上面代码执行时会经历如下步骤：</p>
<ol type="1">
<li><code>new</code>操作符创建了 1 个新的通用对象，并将其<code>__proto__</code>属性设置为<code>Engineer.prototype</code>。</li>
<li><code>new</code>操作符将该新对象作为<code>this</code>的值传递给<code>Engineer</code>构造器。</li>
<li>构造器为该新对象创建 1 个名为<code>base</code>的新属性，并指向<code>WorkerBee</code>的构造器，从而让<code>WorkerBee</code>构造器成为<code>Engineer</code>对象的 1 个方法。</li>
<li>构造器调用<code>base</code>方法，并将传递给该构造器参数中的 2 个再传递给<code>base</code>方法，同时还传递 1 个字符串参数<code>"engineering"</code>。通过显式在构造器中使用<code>"engineering"</code>表明所有 Engineer 对象继承的<code>dept属性</code>具有相同值，且该值重载了继承自<code>Employee</code>的值。</li>
<li>因为<code>base</code>是<code>Engineer</code>的 1 个方法，在调用<code>base</code>时，JavaScript 会将在步骤 1 中创建的对象绑定给<code>this</code>关键字。这样，<code>WorkerBee</code>函数接着将<code>"Doe, Jane"</code>和<code>"engineering"</code>参数传递给<code>Employee</code>构造器函数。当从<code>Employee</code>构造器函数返回时，<code>WorkerBee</code>函数用剩下的参数设置<code>projects</code>属性。</li>
<li>当从<code>base</code>方法返回后，<code>Engineer</code>构造器将对象的<code>machine</code>属性初始化为<code>"belau"</code>。</li>
<li>当从构造器返回时，JavaScript 会将新对象赋值给<code>jane</code>变量。</li>
</ol>
<p>在<code>Engineer</code>构造器中调用<code>WorkerBee</code>构造器，并不会为<code>Engineer</code>对象设置好继承关系，因为调用<code>WorkerBee</code>构造器只会确保<code>Engineer</code>对象以所有在构造器中所指定的属性被调用。如果后续在<code>Employee</code>或者<code>WorkerBee</code>原型中添加了属性，这些属性将不会被<code>Engineer</code>对象继承。</p>
<p>例如下面的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params">name, projs, mach</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.base = WorkerBee;</span><br><span class="line">  <span class="keyword">this</span>.base(name, <span class="string">"engineering"</span>, projs);</span><br><span class="line">  <span class="keyword">this</span>.machine = mach || <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> jane = <span class="keyword">new</span> Engineer(<span class="string">"Doe, Jane"</span>, [<span class="string">"navigator"</span>, <span class="string">"javascript"</span>], <span class="string">"belau"</span>);</span><br><span class="line">Employee.prototype.specialty = <span class="string">"none"</span>;</span><br></pre></td></tr></table></figure>
<p>上面代码中，对象<code>jane</code>不会继承<code>specialty</code>属性，必须显式设置原型才能确保动态的继承。</p>
<p>修改成下面语句，即可使<code>jane</code>对象的<code>specialty</code>属性为<em>none</em>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params">name, projs, mach</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.base = WorkerBee;</span><br><span class="line">  <span class="keyword">this</span>.base(name, <span class="string">"engineering"</span>, projs);</span><br><span class="line">  <span class="keyword">this</span>.machine = mach || <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype = <span class="keyword">new</span> WorkerBee();</span><br><span class="line"><span class="keyword">var</span> jane = <span class="keyword">new</span> Engineer(<span class="string">"Doe, Jane"</span>, [<span class="string">"navigator"</span>, <span class="string">"javascript"</span>], <span class="string">"belau"</span>);</span><br><span class="line">Employee.prototype.specialty = <span class="string">"none"</span>;</span><br></pre></td></tr></table></figure>
<p>继承的另一种实现途径是使用<code>call()</code>或<code>apply()</code>方法，下面两段代码的实现方式是等价的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params">name, projs, mach</span>) </span>&#123;</span><br><span class="line">  WorkerBee.call(<span class="keyword">this</span>, name, <span class="string">"engineering"</span>, projs);</span><br><span class="line">  <span class="keyword">this</span>.machine = mach || <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params">name, projs, mach</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.base = WorkerBee;</span><br><span class="line">  <span class="keyword">this</span>.base(name, <span class="string">"engineering"</span>, projs);</span><br><span class="line">  <span class="keyword">this</span>.machine = mach || <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为不再需要再使用 base，所以调用 call()的方式更简单明了。</p>
</blockquote>
<h3 id="property-inheritance-revisited">Property inheritance revisited</h3>
<p>前面小节描述了 JavaScript 构造器和原型如何提供层级结构和继承的实现，接下来讨论更进一步的细节。</p>
<h4 id="local-versus-inherited-values">Local versus inherited values</h4>
<p>正如本章前面所述，在访问一个对象的属性时，JavaScript 将执行下面的步骤：</p>
<ul>
<li>1、检查本地值是否存在。如果存在返回该值。</li>
<li>2、如果本地值不存在，检查原型链(通过<code>__proto__</code>属性)。</li>
<li>3、如果原型链中某个对象具有指定属性的值，则返回该值。</li>
<li>4、如果这样的属性不存在，则对象不具有该属性。</li>
</ul>
<p>以上步骤的结果依赖于定义对象的方式，看下面这个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">this</span>.dept = <span class="string">"general"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WorkerBee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.projects = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WorkerBee.prototype = <span class="keyword">new</span> Employee();</span><br></pre></td></tr></table></figure>
<p>基于这些定义，假定通过如下语句创建<code>WorkerBee</code>的实例<code>amy</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> amy = <span class="keyword">new</span> WorkerBee();</span><br></pre></td></tr></table></figure>
<p>则<code>amy</code>对象将具有一个本地属性<code>projects</code>，而<code>name</code>和<code>dept</code>属性则是从<code>__proto__</code>属性获得的，因此<code>amy</code>对象具有的属性值如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">amy.name == <span class="string">""</span>;</span><br><span class="line">amy.dept == <span class="string">"general"</span>;</span><br><span class="line">amy.projects == [];</span><br></pre></td></tr></table></figure>
<p>现在，假设修改了与 Employee 相关联原型中的 name 属性的值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Employee.prototype.name = <span class="string">"Unknown"</span>;</span><br></pre></td></tr></table></figure>
<p>此时，新的值并不会传播给所有<code>Employee</code>实例。</p>
<p>在创建<code>Employee</code>对象的任意实例时，该实例的<code>name</code>属性将获得一个本地值(<em>空字符串</em>)。这意味着在创建一个新的<code>Employee</code>对象作为<code>WorkerBee</code>的原型时，<code>WorkerBee.prototype</code>的<code>name</code>属性将具有一个本地值。因此，当 JavaScript 查找<code>amy</code>对象(<em>WorkerBee 的实例</em>)的<code>name</code>属性时，JavaScript 将找到<code>WorkerBee.prototype</code>中的本地值。因此，也就不会继续在原型链中向上找到<code>Employee.prototype</code>了。</p>
<p>如果需要在运行时修改一个对象的属性值，并且希望该值被所有该对象的后代继承，就不能在该对象的构造器函数中定义该属性。而应该将该属性添加到该对象所关联的原型中。</p>
<p>将前面的代码作如下修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.dept = <span class="string">"general"</span>;</span><br><span class="line">&#125;</span><br><span class="line">Employee.prototype.name = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WorkerBee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.projects = [];</span><br><span class="line">&#125;</span><br><span class="line">WorkerBee.prototype = <span class="keyword">new</span> Employee();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> amy = <span class="keyword">new</span> WorkerBee();</span><br><span class="line"></span><br><span class="line">Employee.prototype.name = <span class="string">"Unknown"</span>;</span><br></pre></td></tr></table></figure>
<p>在这种情况下，<code>amy</code>的<code>name</code>属性将为<code>"Unknown"</code>。</p>
<blockquote>
<p>如果希望对象的属性具有默认值，并且希望在运行时修改这些默认值，则应该在对象的原型中设置这些属性，而非是在构造器函数中。</p>
</blockquote>
<h4 id="determining-instance-relationships">Determining instance relationships</h4>
<p>JavaScript 的属性查找机制首先在对象自身的属性中查找，如果指定的属性名称没有找到，将在对象的特殊属性<code>__proto__</code>中查找。这个过程被称为<strong>在原型链中查找</strong>。</p>
<p>对象的<code>__proto__</code>属性是在构建对象时设置的，用来保存<code>prototype</code>属性的值。所以表达式<code>new Foo()</code>将创建一个对象，其<code>__proto__ == Foo.prototype</code>。所以修改<code>Foo.prototype</code>的属性，就会改变所有通过<code>new Foo()</code>所创建的对象属性。</p>
<p>有了<strong>原型继承 prototype inheritance</strong>的存在，就可以通过比较对象的<code>__proto__</code>或<code>prototype</code>属性检测其继承关系。为此，JavaScript 提供了<code>instanceof</code>操作符，如果对象继承自函数的原型，则该操作符返回<code>true</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="keyword">var</span> isTrue = f <span class="keyword">instanceof</span> Foo;</span><br></pre></td></tr></table></figure>
<p>更详细一点的例子，通过下面方式创建<code>Engineer</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chris = <span class="keyword">new</span> Engineer(<span class="string">"Pigman, Chris"</span>, [<span class="string">"jsd"</span>], <span class="string">"fiji"</span>);</span><br></pre></td></tr></table></figure>
<p>对于上面的<code>chris</code>对象，以下所有语句结果均为<code>true</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chris.__proto__ == Engineer.prototype;</span><br><span class="line">chris.__proto__.__proto__ == WorkerBee.prototype;</span><br><span class="line">chris.__proto__.__proto__.__proto__ == Employee.prototype;</span><br><span class="line">chris.__proto__.__proto__.__proto__.__proto__ == <span class="built_in">Object</span>.prototype;</span><br><span class="line">chris.__proto__.__proto__.__proto__.__proto__.__proto__ == <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>基于此，可以编写一个自定义的<code>instanceOf</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">instanceOf</span>(<span class="params">object, constructor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (object != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (object == <span class="keyword">constructor</span>.prototype) return true;</span><br><span class="line">    if (typeof object == "xml") &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">constructor</span>.prototype == XML.prototype;</span><br><span class="line">    &#125;</span><br><span class="line">    object = object.__proto__;</span><br><span class="line">  &#125;</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">instanceOf(chris, Engineer); // true</span><br><span class="line">instanceOf(chris, WorkerBee); // true</span><br><span class="line">instanceOf(chris, Employee); // true</span><br><span class="line">instanceOf(chris, Object); // true</span><br><span class="line">instanceOf(chris, SalesPerson); // false</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的实现中，检查对象类型是否为"xml"的目的在于解决新近版本 JavaScript 中表达 XML 对象的特异之处。</p>
</blockquote>
<h4 id="global-information-in-constructors">Global information in constructors</h4>
<p>在创建构造器时设置全局信息需要注意，例如：希望为每位雇员分配 1 个唯一标识，可能会按如下方式定义<code>Employee</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> idCounter = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params">name, dept</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name || <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">this</span>.dept = dept || <span class="string">"general"</span>;</span><br><span class="line">  <span class="keyword">this</span>.id = idCounter++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于该定义，在创建新的<code>Employee</code>时，构造器为其分配了序列中的下一个标识符，然后递增全局的标识符计数器。因此，如果随后的语句如下，则<code>victoria.id</code>为<code>1</code>而<code>harry.id</code>为<code>2</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> victoria = <span class="keyword">new</span> Employee(<span class="string">"Pigbert, Victoria"</span>, <span class="string">"pubs"</span>);</span><br><span class="line"><span class="keyword">var</span> harry = <span class="keyword">new</span> Employee(<span class="string">"Tschopik, Harry"</span>, <span class="string">"sales"</span>);</span><br></pre></td></tr></table></figure>
<p>但是问题在于，每一次创建<code>Employee</code>对象时，<code>idCounter</code>都将被递增一次。如果创建本章中所描述的整个<code>Employee</code>层级结构，则每次设置原型时，<code>Employee</code>构造器都将会被调用一次。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> idCounter = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span> (<span class="params">name, dept</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name || <span class="string">""</span>;</span><br><span class="line">   <span class="keyword">this</span>.dept = dept || <span class="string">"general"</span>;</span><br><span class="line">   <span class="keyword">this</span>.id = idCounter++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Manager</span> (<span class="params">name, dept, reports</span>) </span>&#123;...&#125;</span><br><span class="line">Manager.prototype = <span class="keyword">new</span> Employee;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WorkerBee</span> (<span class="params">name, dept, projs</span>) </span>&#123;...&#125;</span><br><span class="line">WorkerBee.prototype = <span class="keyword">new</span> Employee;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span> (<span class="params">name, projs, mach</span>) </span>&#123;...&#125;</span><br><span class="line">Engineer.prototype = <span class="keyword">new</span> WorkerBee;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SalesPerson</span> (<span class="params">name, projs, quota</span>) </span>&#123;...&#125;</span><br><span class="line">SalesPerson.prototype = <span class="keyword">new</span> WorkerBee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mac = <span class="keyword">new</span> Engineer(<span class="string">"Wood, Mac"</span>);</span><br></pre></td></tr></table></figure>
<p>假设上面省略掉的函数定义中包含<code>base</code>属性，这种情况下<code>mac</code>对象创建时<code>mac.id</code>的值会为<code>5</code>，计数器存在额外递增的问题。</p>
<p>如果需要准确的计数器，可以使用下面的方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params">name, dept</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name || <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">this</span>.dept = dept || <span class="string">"general"</span>;</span><br><span class="line">  <span class="keyword">if</span> (name) <span class="keyword">this</span>.id = idCounter++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当作为原型创建新的<code>Employee</code>实例时并不会指定参数，如果不指定参数，则<code>name</code>属性值为空字符串，则接下来的<code>if</code>语句中将不会递增计数器。</p>
<h4 id="no-multiple-inheritance">No multiple inheritance</h4>
<p>某些面向对象语言可以支持多重继承，即对象可以从多个父对象中继承属性，但是<strong>JavaScript 不支持多重继承</strong>。</p>
<p>JavaScript 属性的继承是在运行时通过检索对象的原型链来实现的，因为一个对象只拥有一个与之关联的原型，所以 JavaScript 无法动态的从多个原型链中继承。</p>
<p>JavaScript 中，可以在构造器函数中调用多个其它的构造器函数，从而模拟出多重继承的假象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hobbyist</span>(<span class="params">hobby</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.hobby = hobby || <span class="string">"scuba"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span>(<span class="params">name, projs, mach, hobby</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.base1 = WorkerBee;</span><br><span class="line">  <span class="keyword">this</span>.base1(name, <span class="string">"engineering"</span>, projs);</span><br><span class="line">  <span class="keyword">this</span>.base2 = Hobbyist;</span><br><span class="line">  <span class="keyword">this</span>.base2(hobby);</span><br><span class="line">  <span class="keyword">this</span>.machine = mach || <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype = <span class="keyword">new</span> WorkerBee();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dennis = <span class="keyword">new</span> Engineer(<span class="string">"Doe, Dennis"</span>, [<span class="string">"collabra"</span>], <span class="string">"hugo"</span>);</span><br></pre></td></tr></table></figure>
<p>假设使用本章前面的<code>WorkerBee</code>的定义，此时<code>dennis</code>对象将会具有如下属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dennis.name == <span class="string">"Doe, Dennis"</span>;</span><br><span class="line">dennis.dept == <span class="string">"engineering"</span>;</span><br><span class="line">dennis.projects == [<span class="string">"collabra"</span>];</span><br><span class="line">dennis.machine == <span class="string">"hugo"</span>;</span><br><span class="line">dennis.hobby == <span class="string">"scuba"</span>;</span><br></pre></td></tr></table></figure>
<p><code>dennis</code>确实从<code>Hobbyist</code>构造器中获得了<code>hobby</code>属性，但如果添加一个新的属性到<code>Hobbyist</code>构造器的原型，则<code>dennis</code>对象并不会继承该属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hobbyist.prototype.equipment = [<span class="string">"mask"</span>, <span class="string">"fins"</span>, <span class="string">"regulator"</span>, <span class="string">"bcd"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="control-flow-and-error-handling">Control flow and error handling</h2>
<p>JavaScript 中任何表达式(<em>expression</em>)都可以看作一条语句(<em>statement</em>)，每条语句可以使用分号(<em>;</em>)来分隔。可以在每行书写一条语句，也可以在一行书写多条语句，推荐采用第 1 种方式，以便于代码维护。</p>
<h3 id="block-statement">Block statement</h3>
<p>通过一对花括号<code>{}</code>来分组语句块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  statement_1;</span><br><span class="line">  statement_2;</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  statement_n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 ES6 之前，Javascript 没有块作用域，如果在块的外部声明一个变量，然后在块中声明了一个相同变量名的变量，并赋予不同的值，那么程序执行中将会使用块中的值，这样做在 Javascript 中是合法的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// outputs 2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>从 ECMAScript 2015 开始，使用<code>let</code>定义的变量是块作用域的。</p>
</blockquote>
<h3 id="conditional-statements">Conditional statements</h3>
<p>条件判断语句，根据指定的条件返回的结果(<code>true</code>或<code>false</code>)来执行特定的语句。 JavaScript 提供了 2 种条件判断语句：<code>if...else</code>和<code>switch</code>。</p>
<h4 id="if...else">if...else</h4>
<p>当逻辑条件为<code>true</code>时，执行<code>if</code>后面的语句，为假时则执行<code>else</code>后面的语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if (condition_1) &#123;</span><br><span class="line">  statement_1;</span><br><span class="line">&#125;</span><br><span class="line">[else if (condition_2) &#123;</span><br><span class="line">  statement_2;</span><br><span class="line">&#125;]</span><br><span class="line">...</span><br><span class="line">[else if (condition_n_1) &#123;</span><br><span class="line">  statement_n_1;</span><br><span class="line">&#125;]</span><br><span class="line">[else &#123;</span><br><span class="line">  statement_n;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<p>如果需要在条件表达式当中赋值，需要在赋值语句前后额外添加一对括号：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((x = y)) &#123;</span><br><span class="line">  <span class="comment">/* do the right thing */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Javascript 当中<code>false</code>、<code>undefined</code>、<code>null</code>、<code>0</code>、<code>空字符串""</code>、<code>NaN</code>会被渲染为<code>false</code>值。</p>
<blockquote>
<p>需要注意区分原始数据类型的 true 和 false 与 Boolean 对象的 true 和 false 值。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">if</span> (b) <span class="comment">// this condition evaluates to true</span></span><br><span class="line"><span class="keyword">if</span> (b == <span class="literal">true</span>) <span class="comment">// this condition evaluates to false</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以在 if...else...语句中使用多个 return 语句。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span>.form1.threeChar.value.length == <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alert(</span><br><span class="line">      <span class="string">"Enter exactly three characters. "</span> +</span><br><span class="line">        <span class="built_in">document</span>.form1.threeChar.value +</span><br><span class="line">        <span class="string">" is not valid."</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="switch-statement">switch statement</h4>
<p>switch 语句渲染表达式的值，然后尝试匹配后续的 case，匹配成功则执行相应语句。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (expression) &#123;</span><br><span class="line">  <span class="keyword">case</span> label_1:</span><br><span class="line">    statements_1</span><br><span class="line">    [<span class="keyword">break</span>;]</span><br><span class="line">  <span class="keyword">case</span> label_2:</span><br><span class="line">    statements_2</span><br><span class="line">    [<span class="keyword">break</span>;]</span><br><span class="line">    ...</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    statements_def</span><br><span class="line">    [<span class="keyword">break</span>;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (fruittype) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"Oranges"</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Oranges are $0.59 a pound."</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"Apples"</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Apples are $0.32 a pound."</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"Bananas"</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Bananas are $0.48 a pound."</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"Cherries"</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Cherries are $3.00 a pound."</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"Mangoes"</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Mangoes are $0.56 a pound."</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"Papayas"</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Mangoes and papayas are $2.79 a pound."</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Sorry, we are out of "</span> + fruittype + <span class="string">"."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Is there anything else you'd like?"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="exception-handling-statements">Exception handling statements</h3>
<p>可以使用<code>throw</code>语句抛出异常，并且通过<code>try...catch</code>语句进行捕获和处理。</p>
<h4 id="exception-types">Exception types</h4>
<p>JavaScript 异常处理可以抛出任意对象、数值或字母串作为错误信息，但是使用 ECMAScript exceptions、DOMException、DOMError 等内置的异常类型将会更加有效。</p>
<h4 id="throw-statement">throw statement</h4>
<p>throw 语句用来抛出 1 个异常，抛出异常时一个含有值的表达式将会被抛出。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="string">"Error2"</span>; <span class="comment">// String type</span></span><br><span class="line"><span class="keyword">throw</span> <span class="number">42</span>; <span class="comment">// Number type</span></span><br><span class="line"><span class="keyword">throw</span> <span class="literal">true</span>; <span class="comment">// Boolean type</span></span><br><span class="line"><span class="keyword">throw</span> &#123;</span><br><span class="line">  toString: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"I'm an object!"</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以在抛出异常时声明一个对象，这样可以在 catch 块中获取到对象属性。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create an object type UserException</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserException</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.message = message;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"UserException"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Make the exception convert to a pretty string when used as a string</span></span><br><span class="line"><span class="comment">// (e.g. by the error console)</span></span><br><span class="line">UserException.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">': "'</span> + <span class="keyword">this</span>.message + <span class="string">'"'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an instance of the object type and throw it</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UserException(<span class="string">"Value too high"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="try...catch-statement">try...catch statement</h4>
<p>如果<code>try代码块</code>中的语句 throw 出异常，那么执行流程会立即进入<code>catch代码块</code>。如果<code>try代码块</code>没有抛出异常，<code>catch代码块</code>就会被跳过，而<code>finally代码块</code>总会紧跟在<code>try和catch代码块</code>之后执行。</p>
<p>下面例子调用了一个根据参数值来获取月份英文名称的函数，如果传递值与月份数值不相符，则会抛出一个<code>"InvalidMonthNo"</code>异常，并在 catch 块中设置<code>monthName</code>变量为<code>unknown</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMonthName</span>(<span class="params">mo</span>) </span>&#123;</span><br><span class="line">  mo = mo - <span class="number">1</span>; <span class="comment">// Adjust month number for array index (1 = Jan, 12 = Dec)</span></span><br><span class="line">  <span class="keyword">var</span> months = [</span><br><span class="line">    <span class="string">"Jan"</span>,</span><br><span class="line">    <span class="string">"Feb"</span>,</span><br><span class="line">    <span class="string">"Mar"</span>,</span><br><span class="line">    <span class="string">"Apr"</span>,</span><br><span class="line">    <span class="string">"May"</span>,</span><br><span class="line">    <span class="string">"Jun"</span>,</span><br><span class="line">    <span class="string">"Jul"</span>,</span><br><span class="line">    <span class="string">"Aug"</span>,</span><br><span class="line">    <span class="string">"Sep"</span>,</span><br><span class="line">    <span class="string">"Oct"</span>,</span><br><span class="line">    <span class="string">"Nov"</span>,</span><br><span class="line">    <span class="string">"Dec"</span>,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">if</span> (months[mo]) &#123;</span><br><span class="line">    <span class="keyword">return</span> months[mo];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">"InvalidMonthNo"</span>; <span class="comment">//throw keyword is used here</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// statements to try</span></span><br><span class="line">  monthName = getMonthName(myMonth); <span class="comment">// function could throw exception</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  monthName = <span class="string">"unknown"</span>;</span><br><span class="line">  logMyErrors(e); <span class="comment">// pass exception object to error handler -&gt; your own function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="the-catch-block">The catch block</h5>
<p>catch 代码块用来处理 try 代码块中产生的异常，catch 代码块通过参数<code>catchID</code>存放 throw 语句抛出的值，可以通过该参数获取到抛出的异常信息。</p>
<blockquote>
<p>下面例子中的 catch 代码块将会被立即执行，从而打印出 try 块中抛出的 myException 异常信息。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="string">"myException"</span>; <span class="comment">// generates an exception</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// statements to handle any exceptions</span></span><br><span class="line">  logMyErrors(e); <span class="comment">// pass exception object to error handler</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="the-finally-block">The finally block</h5>
<p>finally 代码块无论是否抛出异常都会被执行(<em>即使没有 catch 代码块，finally 代码块的语句最终也会被执行</em>)。</p>
<p>下面例子用服务器端 Javascript 打开一个文件，如果文件打开时抛出一个异常，finally 会在脚本错误之前关闭文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openMyFile();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  writeMyFile(theData); <span class="comment">//This may throw a error</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  handleError(e); <span class="comment">// If we got a error we handle it</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  closeMyFile(); <span class="comment">// always close the resource</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Javascript 异常处理按照 try -&gt; catch -&gt; finally 的顺序执行。</p>
</blockquote>
<p>如果 finally 代码块 return 一个返回值，那么该返回值将会是整个<strong>try-catch-finally</strong>流程的返回值，不管之前在 try 和 catch 代码块中 return 了什么返回值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">"bogus"</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// this return statement is suspended</span></span><br><span class="line">    <span class="comment">// until finally block has completed</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>); <span class="comment">// not reachable</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// overwrites the previous "return"</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>); <span class="comment">// not reachable</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// "return false" is executed now</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">5</span>); <span class="comment">// not reachable</span></span><br><span class="line">&#125;</span><br><span class="line">f(); <span class="comment">// console 0, 1, 3; returns false</span></span><br></pre></td></tr></table></figure>
<p>通过 finally 代码块重写返回值的场景，同样适用于抛出异常或在 catch 代码块中重新抛出异常的场景。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">"bogus"</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'caught inner "bogus"'</span>);</span><br><span class="line">    <span class="keyword">throw</span> e; <span class="comment">// this throw statement is suspended until</span></span><br><span class="line">    <span class="comment">// finally block has completed</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// overwrites the previous "throw"</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// "return false" is executed now</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  f();</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// this is never reached because the throw inside</span></span><br><span class="line">  <span class="comment">// the catch is overwritten</span></span><br><span class="line">  <span class="comment">// by the return in finally</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'caught outer "bogus"'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OUTPUT</span></span><br><span class="line"><span class="comment">// caught inner "bogus"</span></span><br></pre></td></tr></table></figure>
<h5 id="nesting-try...catch-statements">Nesting try...catch statements</h5>
<p>可以嵌套一个或多个<code>try...catch</code>语句，如果一个内部的<code>try...catch</code>语句没有<code>catch</code>代码块，它将会自动匹配外部<code>try...catch</code>语句的<code>catch</code>代码块。</p>
<h4 id="utilizing-error-objects">Utilizing Error objects</h4>
<p>根据错误类型，可以用考虑使用内置对象 Error 的<code>name</code>和<code>message</code>属性，从而获取更简练的信息，其中<code>name</code>提供了常规的错误类(例如<code>DOMException</code>或<code>Error</code>)，而<code>message</code>提供了一条从错误对象转换成字符串的简明信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomethingErrorProne</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ourCodeMakesAMistake()) &#123;</span><br><span class="line">    <span class="keyword">throw</span> (<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'The message'</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    doSomethingToGetAJavascriptError();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  doSomethingErrorProne();</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.name); <span class="comment">// logs 'Error'</span></span><br><span class="line">  <span class="built_in">console</span>.log(e.message); <span class="comment">// logs 'The message' or a JavaScript error message)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="promises">Promises</h3>
<p>ES6 增加了对 Promise 对象的支持，允许对异步的操作流进行控制，Promise 对象有以下几种状态:</p>
<ul>
<li>1、pending(<em>进行中</em>): 初始的状态，即正在执行，不处于 fulfilled 或 rejected 状态。</li>
<li>2、fulfilled(<em>已完成</em>): 成功的完成了操作。</li>
<li>3、rejected(<em>已失败</em>): 失败，没有完成操作。</li>
<li>4、settled(<em>已解决</em>): Promise 处于 fulfilled 或 rejected 二者中的任意一个状态, 不会是 pending。</li>
</ul>
<p><img src="/Web/Javascript/06.promises.png"></p>
<p>下面例子使用了 Promise 和 XMLHttpRequest 来加载一张图片：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">imgLoad</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    request.open(<span class="string">"GET"</span>, url);</span><br><span class="line">    request.responseType = <span class="string">"blob"</span>;</span><br><span class="line">    request.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (request.status === <span class="number">200</span>) &#123;</span><br><span class="line">        resolve(request.response);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(</span><br><span class="line">          <span class="built_in">Error</span>(</span><br><span class="line">            <span class="string">"Image didn't load successfully; error code:"</span> + request.statusText</span><br><span class="line">          )</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    request.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      reject(<span class="built_in">Error</span>(<span class="string">"There was a network error."</span>));</span><br><span class="line">    &#125;;</span><br><span class="line">    request.send();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="loops-and-iteration">Loops and iteration</h2>
<p>本章节介绍 Javascript 中的迭代循环语句。</p>
<h3 id="for-statement">for statement</h3>
<p>for 循环会一直重复执行，直到指定的循环条件为 fasle。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for ([initialExpression]; [condition]; [incrementExpression])</span><br><span class="line">  statement</span><br></pre></td></tr></table></figure>
<ul>
<li>1、如果存在初始化表达式<code>initialExpression</code>，它将被执行，该表达式主要用于初始化一个或多个循环计数器，也可以声明变量。</li>
<li>2、计算<code>condition</code>表达式的值，如果值是<code>true</code>，循环内的<code>statement</code>会被执行。如果是<code>false</code>，for 循环终止。如果该表达式被省略，则<code>condition</code>的值被认为是 true。</li>
<li>3、循环内的<code>statement</code>被执行，如果需要执行多条语句，可以使用代码块<code>{...}</code>进行包裹。</li>
<li>4、如果有更新表达式<code>incrementExpression</code>，执行它，然后流程回至步骤 2。</li>
</ul>
<p>下面例子中，函数<code>howMany</code>使用 for 循环去计算一个滑动列表中被选中项目的个数(<em>1 个<code>&lt;select&gt;</code>允许选择多项</em>)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name=<span class="string">"selectForm"</span>&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">"musicTypes"</span>&gt;Choose some music types, then click the button below:&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">    &lt;select id="musicTypes" name="musicTypes" multiple="multiple"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;option selected="selected"&gt;R&amp;B&lt;/</span>option&gt;</span><br><span class="line">      &lt;option&gt;Jazz&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">      &lt;option&gt;Blues&lt;/</span>option&gt;</span><br><span class="line">      &lt;option&gt;New Age&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">      &lt;option&gt;Classical&lt;/</span>option&gt;</span><br><span class="line">      &lt;option&gt;Opera&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>select&gt;</span><br><span class="line">  &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;p&gt;&lt;input id="btn" type="button" value="How many are selected?" /</span>&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">howMany</span>(<span class="params">selectObject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> numberSelected = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; selectObject.options.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (selectObject.options[i].selected) &#123;</span><br><span class="line">      numberSelected++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> numberSelected;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Number of options selected: '</span> + howMany(<span class="built_in">document</span>.selectForm.musicTypes));</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="do...while-statement">do...while statement</h3>
<p><code>do...while</code>语句一直重复执行，直到指定的条件值为<code>false</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> statement;</span><br><span class="line"><span class="keyword">while</span> (condition);</span><br></pre></td></tr></table></figure>
<ul>
<li>1、<code>statement</code>在<code>condition</code>执行之前会先执行一次，如果<code>condition</code>为<code>true</code>，<code>statement</code>将再次执行，每个执行的结尾会再次执行<code>condition</code>进行检查。</li>
<li>2、当<code>condition</code>为<code>false</code>，执行会停止并将控制权交给 do...while 后续的语句。</li>
</ul>
<p>下面例子中，循环将至少重复 1 次直到<code>i</code>不再小于<code>5</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  i += <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125; <span class="keyword">while</span> (i &lt; <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<h3 id="while-statement">while statement</h3>
<p>while 语句只要指定的条件求值为<code>true</code>，就会一直执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">while (condition)</span><br><span class="line">  statement</span><br></pre></td></tr></table></figure>
<p><code>condition</code>检测会在每次<code>statement</code>执行前发生，如果条件返回为真，<code>statement</code>会被执行并紧接着再次测试条件。如果条件返回为假，执行将停止并把控制权交回给<code>while</code>后面的语句。</p>
<p>下面例子中的 while 循环只要<code>n</code>小于<code>3</code>就会被一直执行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (n &lt; <span class="number">3</span>) &#123;</span><br><span class="line">  n++;</span><br><span class="line">  x += n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在每次循环里，<code>n</code>会增加 1 并被加到<code>x</code>上。所以，<code>x</code>和<code>n</code>的变化是：</p>
<ul>
<li>第一次完成后： n = 1 和 x = 1</li>
<li>第二次完成后： n = 2 和 x = 3</li>
<li>第三次完成后： n = 3 和 x = 6</li>
</ul>
<p>在三次完成后， 条件<code>n&lt;3</code>结果不再为真，所以循环终止了。</p>
</form>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Hank
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://uinika.github.io/Web/Javascript.html" title="JavaScript 6 简明语法书">https://uinika.github.io/Web/Javascript.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/JavaScript/" rel="tag"><i class="fa fa-tag"></i> JavaScript</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Web/Electron.html" rel="prev" title="使用 Electron 打造跨平台桌面应用">
      <i class="fa fa-chevron-left"></i> 使用 Electron 打造跨平台桌面应用
    </a></div>
      <div class="post-nav-item">
    <a href="/Web/JQuery.html" rel="next" title="jQuery 那些容易被忽略的问题">
      jQuery 那些容易被忽略的问题 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#grammar-and-types"><span class="nav-number">1.</span> <span class="nav-text">Grammar and types</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#basics"><span class="nav-number">1.1.</span> <span class="nav-text">Basics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#comments"><span class="nav-number">1.2.</span> <span class="nav-text">Comments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#declarations"><span class="nav-number">1.3.</span> <span class="nav-text">Declarations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#variables"><span class="nav-number">1.4.</span> <span class="nav-text">Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#declaring-variables"><span class="nav-number">1.5.</span> <span class="nav-text">Declaring variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#evaluating-variables"><span class="nav-number">1.6.</span> <span class="nav-text">Evaluating variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#variable-scope"><span class="nav-number">1.7.</span> <span class="nav-text">Variable scope</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#variable-hoisting"><span class="nav-number">1.8.</span> <span class="nav-text">Variable hoisting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-hoisting"><span class="nav-number">1.9.</span> <span class="nav-text">Function hoisting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#global-variables"><span class="nav-number">1.10.</span> <span class="nav-text">Global variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#constants"><span class="nav-number">1.11.</span> <span class="nav-text">Constants</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#data-structures-and-types"><span class="nav-number">1.12.</span> <span class="nav-text">Data structures and types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#data-type-conversion"><span class="nav-number">1.13.</span> <span class="nav-text">Data type conversion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#converting-strings-to-numbers"><span class="nav-number">1.14.</span> <span class="nav-text">Converting strings to numbers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#literals"><span class="nav-number">1.15.</span> <span class="nav-text">Literals</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#array-literals"><span class="nav-number">1.15.1.</span> <span class="nav-text">Array literals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boolean-literals"><span class="nav-number">1.15.2.</span> <span class="nav-text">Boolean literals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#integers"><span class="nav-number">1.15.3.</span> <span class="nav-text">Integers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#floating-point-literals"><span class="nav-number">1.15.4.</span> <span class="nav-text">Floating-point literals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#object-literals"><span class="nav-number">1.15.5.</span> <span class="nav-text">Object literals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#regexp-literals"><span class="nav-number">1.15.6.</span> <span class="nav-text">RegExp literals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string-literals"><span class="nav-number">1.15.7.</span> <span class="nav-text">String literals</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#functions"><span class="nav-number">2.</span> <span class="nav-text">Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#defining-function"><span class="nav-number">2.1.</span> <span class="nav-text">Defining function</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#函数声明"><span class="nav-number">2.1.1.</span> <span class="nav-text">函数声明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数表达式"><span class="nav-number">2.1.2.</span> <span class="nav-text">函数表达式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#calling-functions"><span class="nav-number">2.2.</span> <span class="nav-text">Calling functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-scope"><span class="nav-number">2.3.</span> <span class="nav-text">Function scope</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scope-and-the-function-stack"><span class="nav-number">2.4.</span> <span class="nav-text">Scope and the function stack</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#递归"><span class="nav-number">2.4.1.</span> <span class="nav-text">递归</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#嵌套函数和闭包"><span class="nav-number">2.4.2.</span> <span class="nav-text">嵌套函数和闭包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多层嵌套函数"><span class="nav-number">2.4.3.</span> <span class="nav-text">多层嵌套函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命名冲突"><span class="nav-number">2.4.4.</span> <span class="nav-text">命名冲突</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#closures"><span class="nav-number">2.5.</span> <span class="nav-text">Closures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arguments-object"><span class="nav-number">2.6.</span> <span class="nav-text">Arguments object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-parameter"><span class="nav-number">2.7.</span> <span class="nav-text">Function parameter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#default-parameters"><span class="nav-number">2.7.1.</span> <span class="nav-text">Default parameters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rest-parameters"><span class="nav-number">2.7.2.</span> <span class="nav-text">Rest parameters</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arrow-functions"><span class="nav-number">2.8.</span> <span class="nav-text">Arrow functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#更简短的语法"><span class="nav-number">2.8.1.</span> <span class="nav-text">更简短的语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#词法式绑定-this"><span class="nav-number">2.9.</span> <span class="nav-text">词法式绑定 this</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#predefined-functions"><span class="nav-number">2.10.</span> <span class="nav-text">Predefined functions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#working-with-objects"><span class="nav-number">3.</span> <span class="nav-text">Working with objects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#objects-overview"><span class="nav-number">3.1.</span> <span class="nav-text">Objects overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#objects-and-properties"><span class="nav-number">3.2.</span> <span class="nav-text">Objects and properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#enumerate-the-properties-of-an-object"><span class="nav-number">3.3.</span> <span class="nav-text">Enumerate the properties of an object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#creating-new-objects"><span class="nav-number">3.4.</span> <span class="nav-text">Creating new objects</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#using-object-initializers"><span class="nav-number">3.4.1.</span> <span class="nav-text">Using object initializers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#using-a-constructor-function"><span class="nav-number">3.4.2.</span> <span class="nav-text">Using a constructor function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#using-the-object.create-method"><span class="nav-number">3.4.3.</span> <span class="nav-text">Using the Object.create method</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inheritance"><span class="nav-number">3.5.</span> <span class="nav-text">Inheritance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#indexing-object-properties"><span class="nav-number">3.6.</span> <span class="nav-text">Indexing object properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#defining-properties-for-an-object-type"><span class="nav-number">3.7.</span> <span class="nav-text">Defining properties for an object type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#defining-methods"><span class="nav-number">3.8.</span> <span class="nav-text">Defining methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#using-this-for-object-references"><span class="nav-number">3.9.</span> <span class="nav-text">Using this for object references</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#defining-getters-and-setters"><span class="nav-number">3.10.</span> <span class="nav-text">Defining getters and setters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deleting-properties"><span class="nav-number">3.11.</span> <span class="nav-text">Deleting properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#comparing-objects"><span class="nav-number">3.12.</span> <span class="nav-text">Comparing Objects</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#details-of-the-object-model"><span class="nav-number">4.</span> <span class="nav-text">Details of the object model</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-based-vs.-prototype-based-languages"><span class="nav-number">4.1.</span> <span class="nav-text">Class-based vs. prototype-based languages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-employee-example"><span class="nav-number">4.2.</span> <span class="nav-text">The employee example</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#employee-definitions"><span class="nav-number">4.2.1.</span> <span class="nav-text">Employee definitions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#manager-and-workerbee-definitions"><span class="nav-number">4.2.2.</span> <span class="nav-text">Manager and WorkerBee definitions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#salesperson-and-engineer-definitions"><span class="nav-number">4.2.3.</span> <span class="nav-text">SalesPerson and Engineer definitions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#creating-objects-with-simple-definitions"><span class="nav-number">4.2.4.</span> <span class="nav-text">Creating objects with simple definitions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#object-properties"><span class="nav-number">4.3.</span> <span class="nav-text">Object properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#inheriting-properties"><span class="nav-number">4.3.1.</span> <span class="nav-text">Inheriting properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#adding-properties"><span class="nav-number">4.3.2.</span> <span class="nav-text">Adding properties</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#more-flexible-constructors"><span class="nav-number">4.4.</span> <span class="nav-text">More flexible constructors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#property-inheritance-revisited"><span class="nav-number">4.5.</span> <span class="nav-text">Property inheritance revisited</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#local-versus-inherited-values"><span class="nav-number">4.5.1.</span> <span class="nav-text">Local versus inherited values</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#determining-instance-relationships"><span class="nav-number">4.5.2.</span> <span class="nav-text">Determining instance relationships</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#global-information-in-constructors"><span class="nav-number">4.5.3.</span> <span class="nav-text">Global information in constructors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#no-multiple-inheritance"><span class="nav-number">4.5.4.</span> <span class="nav-text">No multiple inheritance</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#control-flow-and-error-handling"><span class="nav-number">5.</span> <span class="nav-text">Control flow and error handling</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#block-statement"><span class="nav-number">5.1.</span> <span class="nav-text">Block statement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conditional-statements"><span class="nav-number">5.2.</span> <span class="nav-text">Conditional statements</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#if...else"><span class="nav-number">5.2.1.</span> <span class="nav-text">if...else</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#switch-statement"><span class="nav-number">5.2.2.</span> <span class="nav-text">switch statement</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exception-handling-statements"><span class="nav-number">5.3.</span> <span class="nav-text">Exception handling statements</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#exception-types"><span class="nav-number">5.3.1.</span> <span class="nav-text">Exception types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#throw-statement"><span class="nav-number">5.3.2.</span> <span class="nav-text">throw statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#try...catch-statement"><span class="nav-number">5.3.3.</span> <span class="nav-text">try...catch statement</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#the-catch-block"><span class="nav-number">5.3.3.1.</span> <span class="nav-text">The catch block</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#the-finally-block"><span class="nav-number">5.3.3.2.</span> <span class="nav-text">The finally block</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#nesting-try...catch-statements"><span class="nav-number">5.3.3.3.</span> <span class="nav-text">Nesting try...catch statements</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#utilizing-error-objects"><span class="nav-number">5.3.4.</span> <span class="nav-text">Utilizing Error objects</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#promises"><span class="nav-number">5.4.</span> <span class="nav-text">Promises</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loops-and-iteration"><span class="nav-number">6.</span> <span class="nav-text">Loops and iteration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#for-statement"><span class="nav-number">6.1.</span> <span class="nav-text">for statement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#do...while-statement"><span class="nav-number">6.2.</span> <span class="nav-text">do...while statement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#while-statement"><span class="nav-number">6.3.</span> <span class="nav-text">while statement</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hank"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Hank</p>
  <div class="site-description" itemprop="description">My world of IT, learn it & play it.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/uinika" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;uinika" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/uinika/posts" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;uinika&#x2F;posts" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:uinika@outlook.com" title="Email → mailto:uinika@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>Email</a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:uinika@outlook.com?call|chat" title="Skype → skype:uinika@outlook.com?call|chat" rel="noopener" target="_blank"><i class="fa fa-fw fa-skype"></i>Skype</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/7998979/uinika?tab=profile" title="Stack Overflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;7998979&#x2F;uinika?tab&#x3D;profile" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2010 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"><a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.5m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">22:59</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
