<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#8C634F">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#8C634F">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Monda:300,300italic,400,400italic,700,700italic|Source+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"uinika.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#A38272","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="开发小组在 2015 年 11 月的时候，就已经开始尝试使用webpack+babel+react+reflux技术栈，但是团队对这种编译式前端开发的反馈并不友好，一方面 webpack 1.x 版本的打包效率仍然较差，每次保存操作后页面 reload 速度蜗牛一样缓慢，非常影响开发过程中的心情愉悦指数。另一方面，team 的同学们对于传统jQuery+backbone+handlebar+req">
<meta property="og:type" content="article">
<meta property="og:title" content="AngularJS 1.6.x 最佳实践总结">
<meta property="og:url" content="https://uinika.github.io/Web/Angularjs.html">
<meta property="og:site_name" content="Bit by bit">
<meta property="og:description" content="开发小组在 2015 年 11 月的时候，就已经开始尝试使用webpack+babel+react+reflux技术栈，但是团队对这种编译式前端开发的反馈并不友好，一方面 webpack 1.x 版本的打包效率仍然较差，每次保存操作后页面 reload 速度蜗牛一样缓慢，非常影响开发过程中的心情愉悦指数。另一方面，team 的同学们对于传统jQuery+backbone+handlebar+req">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://uinika.github.io/Web/Angularjs/logo.png">
<meta property="og:image" content="https://uinika.github.io/Web/Angularjs/structure-global.png">
<meta property="og:image" content="https://uinika.github.io/Web/Angularjs/structure-module.png">
<meta property="og:image" content="https://uinika.github.io/Web/Angularjs/two-way-data-binding.png">
<meta property="og:image" content="https://uinika.github.io/Web/Angularjs/event-loop.png">
<meta property="og:image" content="https://uinika.github.io/Web/Angularjs/provider.png">
<meta property="article:published_time" content="2020-05-21T13:39:03.782Z">
<meta property="article:modified_time" content="2020-05-21T13:39:03.782Z">
<meta property="article:author" content="Hank">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://uinika.github.io/Web/Angularjs/logo.png">

<link rel="canonical" href="https://uinika.github.io/Web/Angularjs.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>AngularJS 1.6.x 最佳实践总结 | Bit by bit</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Bit by bit" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bit by bit</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Electronics, Embedded & Web</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-th-large"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">55</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">24</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-briefcase"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-it圈">

    <a href="/industry/" rel="section"><i class="fa fa-fw fa-microchip"></i>IT圈</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/uinika" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://uinika.github.io/Web/Angularjs.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Hank">
      <meta itemprop="description" content="My world of IT, learn it & play it.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bit by bit">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AngularJS 1.6.x 最佳实践总结
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 21:39:03" itemprop="dateCreated datePublished" datetime="2020-05-21T21:39:03+08:00">2020-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>开发小组在 2015 年 11 月的时候，就已经开始尝试使用<code>webpack</code>+<code>babel</code>+<code>react</code>+<code>reflux</code>技术栈，但是团队对这种编译式前端开发的反馈并不友好，一方面 webpack 1.x 版本的打包效率仍然较差，每次保存操作后页面 reload 速度蜗牛一样缓慢，非常影响开发过程中的心情愉悦指数。另一方面，team 的同学们对于传统<code>jQuery</code>+<code>backbone</code>+<code>handlebar</code>+<code>requirejs</code>开发方式带有思维惯性，不太能接受 JSX 和 ES6 模块化的写法。</p>
<p><img src="/Web/Angularjs/logo.png"></p>
<p>对于 React 的组件化思想，笔者本人非常推崇，但是遗憾 facebook 并未提供出解决组件间通讯的官方实现，其 Virtual DOM 与 Webpack.sourcemap 结合使用后，debug 变成一件非常困难的事情，并未在实际开发中体现其性能和效率上的优势。且因为社区驱动的 reflux、redux 的存在，实质上又为开发带来了额外的复杂度。更具有决定因素的是，截至在 2015 年底 React 依然停留在 0.14.x 版本，技术栈本身还处于不断成熟的过程，API 也一直在调整与变化。最终从技术成熟度的角度考量，还是稳妥的选择了 Angular 1.6.x 版本。</p>
<a id="more"></a>
<blockquote>
<p>在 React 进入 15.x 版本之后，穿插使用其完成了一个称为<a href="https://github.com/uinika/saga" target="_blank" rel="noopener">Saga</a>的新项目，新增的 context 属性结合 Redux 使用，可以简化组件间通信不少的工作量。</p>
</blockquote>
<p>早在 2013 年 beta 版发布的时候，Angular 就被视为一件神奇的事物，虽然双向绑定的性能问题一直遭到开发人员诟病，但 Google 从 2013 年至今一直给予比较完善的支持，形成了成熟的 API 文档的同时，也提供了大量的最佳实践原则。而 Gulp 这样基于事件流的前端自动化工具的兴起，简化了前、后端技术架构分离后，前端宿主环境的开发、打包、模拟数据的问题。</p>
<p>截至到目前为止，前端小组的同学已经使用 Angular 近 1 年半的时间，其间经历了 5 个项目、2 款产品的考验，积累了许多实践经验，仅在这里做一些总结和分享。</p>
<blockquote>
<p>2017 年，Webpack2、Vue2、Angular4 的相继发布，编译式的前端开发已经成为大势所趋，且单页面场景下 Angular 在性能和组件化解耦方面暴露出非常多不足，目前勤智的前端小组正在全面转向 Vue2。</p>
</blockquote>
<h2 id="项目结构">项目结构</h2>
<p>目录 build、release 主要放置编译、打包压缩后的前端代码，mocks 里是基于 express 编写的模拟 restful 接口，与前端页面服务分处于不同端口不同域下，因此 express 中需要进行 CORS 跨域处理。partials 目录下是全部工程代码，内部模块组织结构如下：</p>
<p><img src="/Web/Angularjs/structure-global.png" title="整体结构"></p>
<p>将 javascript 业务、css 样式、html 表现分离开编写，css 采用 Less 进行预编译，使用 gulp 先合并全部 Less 后再处理成 css，便于 colors、resets 等变量全局共享。使用<code>script.</code>、<code>style.</code>、<code>view.</code>前缀便于在 vscode 或 atom 中组织代码层次，以体现更加直观、优雅的项目结构。</p>
<p><img src="/Web/Angularjs/structure-module.png" title="模块结构"></p>
<h2 id="index-索引页">Index 索引页</h2>
<p>一个非常传统的 index.html，但是内置了 URL 的配置模块，方便实施人员根据现场服务环境，对后端 URL 地址进行修改。但更好的实践是单独将其作为一个 config.js 文件外部引入，代价是需要调整打包策略，避免 gulp 对 config.js 进行代码混淆和压缩操作。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span> <span class="attr">ng-app</span>=<span class="string">"app"</span> <span class="attr">ng-strict-di</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Angular Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"renderer"</span> <span class="attr">content</span>=<span class="string">"webkit"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"assets/favicon.ico"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- base --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">"libraries/font-awesome/css/font-awesome.min.css"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"libraries/animate/animate.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jquery plugin --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"libraries/bootstrap/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"libraries/admin/css/AdminLTE.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">"libraries/admin/css/skins/skin-red-light.css"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- angular plugin --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">"libraries/angular-tree-control/css/tree-control.css"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">"libraries/angular-ui-tree/angular-ui-tree.min.css"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bundle --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bundles/styles.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"fixed skin-red-light layout-top-nav"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span> <span class="attr">ui-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- base --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/jquery/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/lodash/lodash.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/moment/moment-with-locales.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jquery plugin --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/bootstrap/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/admin/js/app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/jquery-fastclick/fastclick.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/jquery-slimscroll/jquery.slimscroll.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- angular --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular/angular.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular/angular-animate.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular/angular-messages.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular/angular-aria.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular/i18n/angular-locale_zh-cn.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular/angular-sanitize.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- angular plugin --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular-router/angular-ui-router.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular-ui-select/select.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"libraries/angular-ui/ui-bootstrap-tpls.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bundle --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      angular.module(<span class="string">"app.common"</span>, []).constant(<span class="string">"URL"</span>, &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="string">"master"</span>: <span class="string">"http://192.168.13.77:8081/test"</span></span></span><br><span class="line"><span class="actionscript">        <span class="string">"slave"</span>: <span class="string">"http://192.168.13.77:8080/test"</span></span></span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bundles/scripts.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="app-启动点">App 启动点</h2>
<p>该文件是整个项目的程序入口点，gulp 自动化压缩后会作为 bundle.js 文件最顶部的一段代码，因此这里开启 Javascript 严格模式后全局有效。每个 js 文件都使用立即调用函数表达式<strong>IIFE</strong>（<em>Immediately-Invoked Function Expression</em>）进行封装，防止局部变量泄露到全局。<code>run</code>和<code>config</code>代码块编写为函数名称进行引用，从而避免 JS 函数过度嵌套后，影响代码的可读性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  angular</span><br><span class="line">    .module(<span class="string">"app"</span>, [</span><br><span class="line">      <span class="comment">// library</span></span><br><span class="line">      <span class="string">"ngAnimate"</span>,</span><br><span class="line">      <span class="string">"ngSanitize"</span>,</span><br><span class="line">      <span class="string">"ui.router"</span>,</span><br><span class="line">      <span class="string">"ui.bootstrap"</span>,</span><br><span class="line">      <span class="comment">// custom</span></span><br><span class="line">      <span class="string">"app.common"</span>,</span><br><span class="line">      <span class="string">"app.login"</span>,</span><br><span class="line">      <span class="string">"app.layout"</span></span><br><span class="line">    ])</span><br><span class="line">    .config(config)</span><br><span class="line">    .run(run);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* config block */</span></span><br><span class="line">  config.$inject = [</span><br><span class="line">    <span class="string">"$qProvider"</span>,</span><br><span class="line">    <span class="string">"$stateProvider"</span>,</span><br><span class="line">    <span class="string">"$urlRouterProvider"</span>,</span><br><span class="line">    <span class="string">"$httpProvider"</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">config</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    $qProvider,</span></span></span><br><span class="line"><span class="function"><span class="params">    $stateProvider,</span></span></span><br><span class="line"><span class="function"><span class="params">    $urlRouterProvider,</span></span></span><br><span class="line"><span class="function"><span class="params">    $httpProvider</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* run block */</span></span><br><span class="line">  run.$inject = [<span class="string">"$rootScope"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">$rootScope</span>) </span>&#123;&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="module-模块">Module 模块</h2>
<p>为了更直观的体现<strong>Angular 模块化</strong>的概念，会将如下代码新建为单独的<code>a.module.js</code>文件，主要用于模块的依赖声明，以及嵌套路由配置。其中，路由使用了<a href="https://github.com/angular-ui/ui-router/wiki" target="_blank" rel="noopener">ui-router</a>提供的方案，父级路由使用<code>abstract</code>属性和<code>template:"&lt;ui-view/&gt;"</code>来实现与子路由的松耦合。</p>
<p>Angular module 中的路由配置是整份前端代码的切割点，通过它完成了整个单页面应用在源码层面的文件切分。更重要的是，通过<code>controllerAs</code>的使用，在接下来的控制器中，通过<code>this</code>指针代替传统<code>$scope</code>的写法，有助于避免在有嵌套的 controller 中调用<code>$parent</code>，有效防止作用域污染的发生。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  angular.module(<span class="string">"app.template"</span>, []);</span><br><span class="line"></span><br><span class="line">  angular.module(<span class="string">"app.template"</span>).config(templateConfig);</span><br><span class="line"></span><br><span class="line">  templateConfig.$inject = [<span class="string">"$stateProvider"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">templateConfig</span>(<span class="params">$stateProvider</span>) </span>&#123;</span><br><span class="line">    $stateProvider</span><br><span class="line">      .state(<span class="string">"template"</span>, &#123;</span><br><span class="line">        parent: <span class="string">"layout"</span>,</span><br><span class="line">        abstract: <span class="literal">true</span>,</span><br><span class="line">        url: <span class="string">"/template"</span>,</span><br><span class="line">        template: <span class="string">"&lt;ui-view/&gt;"</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// Judged</span></span><br><span class="line">      .state(<span class="string">"template.judged"</span>, &#123;</span><br><span class="line">        parent: <span class="string">"template"</span>,</span><br><span class="line">        url: <span class="string">"/judged"</span>,</span><br><span class="line">        templateUrl: <span class="string">"partials/template/judge/view.html"</span>,</span><br><span class="line">        controller: <span class="string">"TemplateJudgeController"</span>,</span><br><span class="line">        controllerAs: <span class="string">"Judge"</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// Trial</span></span><br><span class="line">      .state(<span class="string">"template.trial"</span>, &#123;</span><br><span class="line">        parent: <span class="string">"template"</span>,</span><br><span class="line">        url: <span class="string">"/trial"</span>,</span><br><span class="line">        templateUrl: <span class="string">"partials/template/trial/view.html"</span>,</span><br><span class="line">        controller: <span class="string">"TemplateTrialController"</span>,</span><br><span class="line">        controllerAs: <span class="string">"Trial"</span></span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="controller-控制器">Controller 控制器</h2>
<p>控制器中，通过<code>$inject属性注解</code>手动实现依赖注入，避免代码压缩合并后出现依赖丢失的情况。将<code>this</code>指针赋值给<code>vm</code>对象（view model），其它方法和属性都以子对象的形式挂载到 vm 下面，使其更加整洁和面向对象。</p>
<p>由于 Angular 会自动绑定未在 HTML 中声明的属性，因此约定将所有双向绑定属性声明到 vm 对象当中，且通过赋予其默认值来表达所属数据类型。</p>
<blockquote>
<p>下面代码中的<code>activate()</code>函数主要用来放置 controller 的初始化逻辑。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  angular.module(<span class="string">"app.login"</span>).controller(<span class="string">"LoginController"</span>, LoginController);</span><br><span class="line"></span><br><span class="line">  LoginController.$inject = [</span><br><span class="line">    <span class="string">"loginService"</span>,</span><br><span class="line">    <span class="string">"$state"</span>,</span><br><span class="line">    <span class="string">"verify"</span>,</span><br><span class="line">    <span class="string">"$uibModal"</span>,</span><br><span class="line">    <span class="string">"$scope"</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">LoginController</span>(<span class="params">loginService, $state, verify, $uibModal, $scope</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// two-way data binding on view</span></span><br><span class="line">    vm.account = &#123;</span><br><span class="line">      username: <span class="string">""</span>,</span><br><span class="line">      password: <span class="string">""</span>,</span><br><span class="line">      message: <span class="string">""</span>,</span><br><span class="line">      onSubmit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        loginService</span><br><span class="line">          .auth(&#123;</span><br><span class="line">            username: vm.account.username,</span><br><span class="line">            password: vm.account.password</span><br><span class="line">          &#125;)</span><br><span class="line">          .then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (loginService.validate(result)) &#123;</span><br><span class="line">              vm.account.message = result.message;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initialization function invoked</span></span><br><span class="line">    activate();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="service-服务">Service 服务</h2>
<p>主要用来放置数据操作和数据交互的逻辑，例如：<em>负责 XHR 请求、本地存储、内存存储和其它任何数据操作</em>。最后，Service 通过返回一个对象来组织这些服务。通常情况下，项目每个模块只拥有一个 controller，但是可以存在多个 service，Angular 的设计理念就是寄希望通过 service 来完成业务的复用，这一点主要继承了传统 MVC 的分层思想。</p>
<blockquote>
<p>Angular 的 service 总是单例的，这意味每个<code>injector</code>都只有一个实例化的<code>service</code>。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  angular.module(<span class="string">"app.login"</span>).service(<span class="string">"loginService"</span>, loginService);</span><br><span class="line"></span><br><span class="line">  loginService.$inject = [<span class="string">"$http"</span>, <span class="string">"URL"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loginService</span>(<span class="params">$http, URL</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> path = URL.master;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      auth: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $http.post(path + <span class="string">"/login"</span>, data).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.error(error);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      validate: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// it is a login validator</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="directive-指令">Directive 指令</h2>
<p>指令的命名需要使用一个短小、唯一、具有描述性的前缀（<em>比例企业名称</em>），可以通过在指令配置对象中使用<code>controllerAs</code>属性，取得与控制器中 vm 同样的用法，</p>
<blockquote>
<p>使用 controllerAs 属性时，如果需要把父级作用域绑定到指令 controller 属性指定的作用域时，可以使用<code>bindToController=true</code>。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@type <span class="variable">directive</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@name <span class="variable">uinika</span></span>-scroll</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">uinika</span></span>-scroll-offset</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>auto resize base on overflow-y</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  angular.module(<span class="string">"app.common"</span>).directive(<span class="string">"uinikaScroll"</span>, uinikaScroll);</span><br><span class="line"></span><br><span class="line">  uinikaScroll.$inject = [<span class="string">"$window"</span>, <span class="string">"$document"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">uinikaScroll</span>(<span class="params">$window, $document</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      restrict: <span class="string">"ACE"</span>,</span><br><span class="line">      scope: &#123;</span><br><span class="line">        offset: <span class="string">"@uinikaScrollOffset"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      link: <span class="function"><span class="keyword">function</span> <span class="title">link</span>(<span class="params">scope, element, attrs</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _window = $($<span class="built_in">window</span>);</span><br><span class="line">        <span class="keyword">var</span> _document = $($<span class="built_in">document</span>);</span><br><span class="line">        <span class="keyword">var</span> _offset = $<span class="built_in">window</span>.parseInt(scope.offset);</span><br><span class="line"></span><br><span class="line">        format();</span><br><span class="line"></span><br><span class="line">        _window.resize(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          format();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">// scroll</span></span><br><span class="line">          element.css(&#123;</span><br><span class="line">            <span class="string">"overflow-y"</span>: <span class="string">"scroll"</span></span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">// size</span></span><br><span class="line">          <span class="keyword">var</span> contentHeight = _window.height() || <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">var</span> navbarHeight = _document.find(<span class="string">".main-header"</span>).outerHeight() || <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">var</span> boxheaderHeight =</span><br><span class="line">            _document.find(<span class="string">".box-header"</span>).outerHeight() || <span class="number">0</span>;</span><br><span class="line">          <span class="comment">// calculate</span></span><br><span class="line">          element.outerHeight(</span><br><span class="line">            contentHeight - navbarHeight - boxheaderHeight - _offset</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@type <span class="variable">directive</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@name <span class="variable">slim</span></span>-scroll</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">slim</span></span>-scroll-offset slim-scroll-width slim-scroll-color slim-scroll-edge</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>auto resize base on slimscroll</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  angular.module(<span class="string">"app.common"</span>).directive(<span class="string">"slimScroll"</span>, slimScroll);</span><br><span class="line"></span><br><span class="line">  slimScroll.$inject = [<span class="string">"$window"</span>, <span class="string">"$document"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">slimScroll</span>(<span class="params">$window, $document</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      restrict: <span class="string">"ACE"</span>,</span><br><span class="line">      scope: &#123;</span><br><span class="line">        height: <span class="string">"@slimScrollOffset"</span>,</span><br><span class="line">        size: <span class="string">"@slimScrollWidth"</span>,</span><br><span class="line">        color: <span class="string">"@slimScrollColor"</span>,</span><br><span class="line">        distance: <span class="string">"@slimScrollEdge"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      link: <span class="function"><span class="keyword">function</span> <span class="title">link</span>(<span class="params">scope, element, attrs</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _window = $($<span class="built_in">window</span>);</span><br><span class="line">        <span class="keyword">var</span> _document = $($<span class="built_in">document</span>);</span><br><span class="line">        <span class="comment">// property</span></span><br><span class="line">        <span class="keyword">var</span> _height = $<span class="built_in">window</span>.parseInt(scope.height);</span><br><span class="line">        <span class="keyword">var</span> _size = scope.size ? scope.size + <span class="string">"px"</span> : <span class="string">"6px"</span>;</span><br><span class="line">        <span class="keyword">var</span> _color = scope.color ? scope.color + <span class="string">""</span> : <span class="string">"red"</span>;</span><br><span class="line">        <span class="keyword">var</span> _distance = scope.distance ? scope.distance + <span class="string">"px"</span> : <span class="string">"0px"</span>;</span><br><span class="line"></span><br><span class="line">        format();</span><br><span class="line"></span><br><span class="line">        _window.resize(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          format();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">// size</span></span><br><span class="line">          <span class="keyword">var</span> contentHeight = _window.height() || <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">var</span> navbarHeight = _document.find(<span class="string">".main-header"</span>).outerHeight() || <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">var</span> boxheaderHeight =</span><br><span class="line">            _document.find(<span class="string">".box-header"</span>).outerHeight() || <span class="number">0</span>;</span><br><span class="line">          <span class="comment">// calculate</span></span><br><span class="line">          element.slimScroll(&#123;</span><br><span class="line">            height:</span><br><span class="line">              contentHeight - navbarHeight - boxheaderHeight - _height + <span class="string">"px"</span>,</span><br><span class="line">            color: _color,</span><br><span class="line">            size: _size,</span><br><span class="line">            distance: _distance,</span><br><span class="line">            alwaysVisible: <span class="literal">true</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="filter-过滤器">Filter 过滤器</h2>
<p>过滤输出给用户的表达式值，可用于<code>view</code>、<code>controller</code>、<code>service</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  angular.module(<span class="string">"app.common"</span>).filter(<span class="string">"trim"</span>, trim);</span><br><span class="line"></span><br><span class="line">  trim.$inject = [<span class="string">"$sce"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">trim</span>(<span class="params">$sce</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> input === <span class="string">"string"</span> &amp;&amp; input) input.replace(<span class="regexp">/\s/g</span>, <span class="string">""</span>);</span><br><span class="line">      <span class="keyword">return</span> out;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最佳实践是只通过 filter 筛选指定的对象属性，而非扫描对象本身，避免带来糟糕的性能问题。</p>
</blockquote>
<h2 id="jwt-权限控制">JWT 权限控制</h2>
<p>为了适配移动端浏览器，采用 JWT（<em>JSON Web Token，一种 JSON 风格的轻量级的授权和身份认证规范</em>）作为前后端交互时的权限控制协议。主要是考虑前后端分离之后，在不借助 cookie 和 session 的场景下（<em>部分移动端浏览器未实现相关特性</em>），使浏览器端发起的每个 HTTP 请求都能正确携带权限信息，以便于服务器端进行有效行拦截。</p>
<p>单页面场景下，权限认证需要关注如下 3 个核心问题：</p>
<ol type="1">
<li>登陆校验成功后，持有服务器端生成的 token 令牌。</li>
<li>每次 HTTP 请求都需要持有该 token 令牌的信息。</li>
<li>登陆超时和访问未授权页面的处理（通常为跳转）。</li>
</ol>
<blockquote>
<p>如下代码为项目入口点<code>config代码块</code>的配置，用于获取并放置 token 令牌，以及处理登陆超时的跳转。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">config.$inject = [</span><br><span class="line">  <span class="string">"$qProvider"</span>,</span><br><span class="line">  <span class="string">"$stateProvider"</span>,</span><br><span class="line">  <span class="string">"$urlRouterProvider"</span>,</span><br><span class="line">  <span class="string">"$httpProvider"</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span>(<span class="params">$qProvider, $stateProvider, $urlRouterProvider, $httpProvider</span>) </span>&#123;</span><br><span class="line">  $qProvider.errorOnUnhandledRejections(<span class="literal">false</span>);</span><br><span class="line">  $urlRouterProvider.otherwise(<span class="string">"/login"</span>);</span><br><span class="line">  $stateProvider</span><br><span class="line">    .state(<span class="string">"login"</span>, &#123;</span><br><span class="line">      url: <span class="string">"/login"</span>,</span><br><span class="line">      templateUrl: <span class="string">"partials/login/view.html"</span>,</span><br><span class="line">      controller: <span class="string">"LoginController"</span>,</span><br><span class="line">      controllerAs: <span class="string">"Login"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .state(<span class="string">"layout"</span>, &#123;</span><br><span class="line">      url: <span class="string">"/layout"</span>,</span><br><span class="line">      templateUrl: <span class="string">"partials/layout/view.html"</span>,</span><br><span class="line">      controller: <span class="string">"LayoutController"</span>,</span><br><span class="line">      controllerAs: <span class="string">"Layout"</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** HTTP Interceptor */</span></span><br><span class="line">  $httpProvider.interceptors.push(interceptor);</span><br><span class="line">  interceptor.$inject = [<span class="string">"$q"</span>, <span class="string">"$location"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">interceptor</span>(<span class="params">$q, $location</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      request: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> token = sessionStorage.token;</span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">          config.headers = _.assign(</span><br><span class="line">            &#123;&#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              Authorization: <span class="string">"uinika "</span> + token</span><br><span class="line">            &#125;,</span><br><span class="line">            config.headers</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">      &#125;,</span><br><span class="line">      response: <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        $q.when(response, <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            response.data &amp;&amp;</span><br><span class="line">            response.data.head &amp;&amp;</span><br><span class="line">            <span class="keyword">typeof</span> response.data === <span class="string">"object"</span></span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.data.head.status === <span class="number">202</span>) &#123;</span><br><span class="line">              sessionStorage.message = <span class="string">"登录超时，请重新登录！"</span>;</span><br><span class="line">              $location.url(<span class="string">"/uinika"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如下代码为项目入口点<code>run代码块</code>的配置，主要是处理未登陆访问授权页面的跳转。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">run.$inject = [<span class="string">"$rootScope"</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">$rootScope</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// router listener</span></span><br><span class="line">  $rootScope.$on(<span class="string">"$stateChangeStart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    event,</span></span></span><br><span class="line"><span class="function"><span class="params">    toState,</span></span></span><br><span class="line"><span class="function"><span class="params">    toParams,</span></span></span><br><span class="line"><span class="function"><span class="params">    fromState,</span></span></span><br><span class="line"><span class="function"><span class="params">    fromParams</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (toState.name !== <span class="string">"login"</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!sessionStorage.token) &#123;</span><br><span class="line">        <span class="built_in">window</span>.location.href = <span class="string">"/uinika"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="module-中的-run-和-config">Module 中的 Run 和 Config</h2>
<p>Run 和 Config 分别是 Aangular 模块加载的 2 个生命周期：</p>
<ol type="1">
<li><strong>Config</strong>：首先执行的是 Config 阶段，该阶段发生在 provider 注册和配置的时候，主要用于连接并注册好所有数据源，因此<strong>provider</strong>、<strong>constant</strong>都可以注入到 Config 代码块中，但是其它不确定是否初始化完成的服务不能注入进来。</li>
<li><strong>run</strong>：其次开始进入 Run 阶段，该阶段发生在 injector 创建完成之后，主要用于启动应用，是 Angular 中最接近 C 语言 main 方法的概念。为了避免在模块启动之后再进行配置操作，所以只允许注入<strong>service</strong>、<strong>value</strong>、<strong>constant</strong>。</li>
</ol>
<h2 id="location-的配置">$location 的配置</h2>
<p><code>$location</code>服务是 Angular 对浏览器原生<code>window.location</code>的封装，可以通过<code>$locationProvider</code>进行配置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$locationProvider.html5Mode(<span class="literal">true</span>).hashPrefix(<span class="string">"*"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Hashbang 模式</strong>：<code>http://localhost:5008/#!/login?user=hank</code></li>
<li><strong>HTML5 模式</strong>：<code>http://localhost:5008/login?user=hank</code></li>
</ul>
<blockquote>
<p>Hashbang 是指由<code>#!</code>构成的字符串，类 UNIX 系统会将 Hashbang 后内容作为解释器指令进行解析。</p>
</blockquote>
<h2 id="跨控制器的事件交互">跨控制器的事件交互</h2>
<p>当 Angular 当中同一张页面存在多个控制器时（<em>例如使用了嵌套路由</em>），可以通过 scope 的事件机制进行通信。</p>
<ul>
<li><code>$scope.$on(name, listener);</code> 监听给定类型的事件。</li>
<li><code>$scope.$emit(name, args);</code> 向<strong>上</strong>派发事件，可以携带参数。</li>
<li><code>$scope.$broadcast(name, args);</code> 向<strong>下</strong>派发事件，可以携带参数。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 事件广播</span></span><br><span class="line">$scope.$broadcast(<span class="string">"SEARCH"</span>, vm.search.input);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听事件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $scope.$on(<span class="string">"SEARCH"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event, data</span>) </span>&#123;</span><br><span class="line">    vm.menu.fetch();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>事件相关的处理（<em>即<code>$on()</code>方法</em>），可以统一写在每个控制器的初始化方法<code>activate()</code>当中。</p>
</blockquote>
<h2 id="angular-的-html-模板编译步骤">Angular 的 HTML 模板编译步骤</h2>
<p>Angular 中 HTML 模板的编译会经历下面 3 个步骤：</p>
<ol type="1">
<li><p>$compile 遍历 DOM 查找匹配的 Angular 指令。</p></li>
<li><p>当 DOM 上的所有指令被识别，<code>$compile</code>会按其<code>priority</code>属性的优先级进行排序，接下来指令的<code>compile</code>函数被执行（<em>每个 compile 函数都拥有 1 次修改 DOM 的机会</em>），每一条指令的<code>compile</code>函数都将返回一个<code>link</code>函数，这些函数最后会被合并到一个统一的链接函数当中。</p></li>
<li><p><code>$compile</code>通过这个被合并的链接函数，依次调用每个指令的<code>link</code>函数，注册监听器到 HTML 元素，以及在<code>scope</code>中设置<code>$watch</code>，最后完成<code>scope</code>和<code>template</code>的双向绑定。</p></li>
</ol>
<p><img src="/Web/Angularjs/two-way-data-binding.png" title="双向数据绑定"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $compile = ...; <span class="comment">// injected into your code</span></span><br><span class="line"><span class="keyword">var</span> scope = ...;</span><br><span class="line"><span class="keyword">var</span> parent = ...; <span class="comment">// DOM element where the compiled template can be appended</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> html = <span class="string">"&lt;div ng-bind="</span>exp<span class="string">"&gt;&lt;/div&gt;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 1: parse HTML into DOM element</span></span><br><span class="line"><span class="keyword">var</span> template = angular.element(html);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 2: compile the template</span></span><br><span class="line"><span class="keyword">var</span> linkFn = $compile(template);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 3: link the compiled template with the scope.</span></span><br><span class="line"><span class="keyword">var</span> element = linkFn(scope);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 4: Append to DOM (optional)</span></span><br><span class="line">parent.appendChild(element);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面是 Angular 官方文档中非常具有信息量的一段 demo 代码。</p>
</blockquote>
<h2 id="指令-complie和-link的区别">指令 complie()和 link()的区别</h2>
<p>将 compile 和 link 分为两个阶段主要是出于性能的考虑，让多次 Model 的变化只引发一次 DOM 结构的改变。</p>
<ul>
<li><code>compile()</code>：对 HTML 模板自身进行转换，仅在编译阶段执行一次。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compile</span>(<span class="params">tElement, tAttrs, transclude</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pre: <span class="function"><span class="keyword">function</span> <span class="title">preLink</span>(<span class="params">scope, iElement, iAttrs, controller</span>) </span>&#123; ... &#125;,</span><br><span class="line">    post: <span class="function"><span class="keyword">function</span> <span class="title">postLink</span>(<span class="params">scope, iElement, iAttrs, controller</span>) </span>&#123; ... &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// or</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">postLink</span>(<span class="params"> ... </span>) </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>link()</code>: 在 View 和 Model 之间进行动态关联，将会被执行多次，只能在未定义<code>compile</code>的场景下使用。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">link</span>(<span class="params">scope, iElement, iAttrs, controller, transcludeFn</span>) </span>&#123;</span><br><span class="line">  link: &#123;</span><br><span class="line">    pre: <span class="function"><span class="keyword">function</span> <span class="title">preLink</span>(<span class="params">scope, iElement, iAttrs, controller</span>) </span>&#123; ... &#125;,</span><br><span class="line">    post: <span class="function"><span class="keyword">function</span> <span class="title">postLink</span>(<span class="params">scope, iElement, iAttrs, controller</span>) </span>&#123; ... &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// or</span></span><br><span class="line">  link: <span class="function"><span class="keyword">function</span> <span class="title">postLink</span>(<span class="params"> ... </span>) </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="digest-循环">$digest 循环</h2>
<p>Angular 增强了浏览器原生的事件循环（<em>event loop</em>）机制，将事件循环分为<strong>JavaScript 原生</strong>和<strong>Angular 可执行上下文</strong>两部分，只有进入 Angular 可执行上下文才能够使用双向数据绑定、异常处理、属性观察等特性。</p>
<p>可以在 JavaScript 中通过<code>$apply()</code>方法进入到 Angular 可执行上下文，在大多数<code>controller</code>、<code>service</code>当中<code>$apply()</code>已经被隐式的调用，只有在整合第 3 方类库需要自定义事件时才会显式使用<code>$apply()</code>。</p>
<p><img src="/Web/Angularjs/event-loop.png" title="事件循环"></p>
<ol type="1">
<li>调用<code>scope.$apply(stimulusFn)</code>进入 Angular 可执行上下文，作为参数的 stimulusFn 函数就是需要运行在 Angular 可执行上下文内的代码。</li>
<li>Angular 执行 stimulusFn()函数，该函数通常会对应用状态进行修改。</li>
<li>Angular 进入<span class="math inline">\(digest循环，\)</span>digest 循环又分为<span class="math inline">\(evalAsync队列和\)</span>watch 列表 2 个较小的循环。<span class="math inline">\(digest循环会迭代执行直到Model状态稳定下来，即\)</span>evalAsync 队列为空且$watch 列表中检测不到任何变化的时候。</li>
<li>$evalAsync 队列主要用来异步处理 Angular 执行上下文之外的任务（<em>例如基于当前 scope 对表达式进行异步渲染</em>），这一过程将会发生在浏览器视图渲染之前，从而避免视图闪烁。</li>
<li>$watch 列表是一个在最后一次迭代之后，依然可能发生变化的表达式集合。一旦检测到变化发生，<code>$watch()</code>函数将会被调用，并使用改变后的值对 DOM 进行更新。</li>
<li>当$digest 循环结束后，执行流程离开 Angular 和 JavaScript 上下文。</li>
</ol>
<p>综上所述，<span class="math inline">\(digest循环作为Angular的脏值检查机制，繁重的实现过程造成其性能开销较大。因此，视图层绑定数据时，最佳实践原则是尽量使用`::`一次性绑定，以便减少不必要的\)</span>digest 循环。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;::username&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="如何理解-provider">如何理解 Provider</h2>
<p>Provider 用于创建可以由 injector 依赖注入的服务，Provider 需要通过 auto 模块中的$provide 服务进行创建，Provider 拥有<code>provider()</code>、<code>value()</code>、<code>factory()</code>、<code>service()</code>、<code>constant()</code>、<code>decorator()</code>六种创建方式。</p>
<p><img src="/Web/Angularjs/provider.png" title="$provide"></p>
<ol type="1">
<li><code>provider(name, provider)</code> 该方式必须实现一个<code>$get</code>方法，是其它 Provide 创建方式的核心（<em>不包括 Constant</em>）。</li>
<li><code>constant(name, obj)</code> 定义常量，可以被注入到任何地方，但是不能被 decorator 装饰，也不能被注入其它 service。</li>
<li><code>value(name, obj)</code> 可以是任意数据类型，不能被注入到 config，但可以被 decorator 装饰。</li>
<li><code>factory(name, fn)</code> 创建可注入的普通函数，可以 return 任意值，实质是只拥有$get 方法的 provider。</li>
<li><code>service(name, Fn)</code> 创建可注入的构造函数，调用时会通过<code>new</code>关键字，可以不用 return 任何值，它在 AngularJS 中是单例的。</li>
<li><code>decorator(name, decorFn)</code> 用来装饰其他 provider，可以中断服务的创建流程，然后重写或者修改服务的行为。但 Constant 不能被装饰，因为 Constant 并非 provider()创建。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = angular</span><br><span class="line">    .module(<span class="string">"app.test"</span>, [])</span><br><span class="line">    .config(testConfig)</span><br><span class="line">    .controller(<span class="string">"TestController"</span>, TestController);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Config */</span></span><br><span class="line">  testConfig.$inject = [<span class="string">"$provide"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testConfig</span>(<span class="params">$provide</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 模块上定义provider</span></span><br><span class="line">    <span class="keyword">var</span> provider = $provide.provider(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> message;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        setMessage: <span class="function"><span class="keyword">function</span>(<span class="params">infomation</span>) </span>&#123;</span><br><span class="line">          message = infomation;</span><br><span class="line">        &#125;,</span><br><span class="line">        $<span class="keyword">get</span>: function() &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            infomation: <span class="string">"This is a "</span> + message</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">    provider.setMessage(<span class="string">"Provider!"</span>); <span class="comment">// 设置Provider需要返回的消息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// config中定义factory</span></span><br><span class="line">    $provide.factory(<span class="string">"factory"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        reminder: <span class="string">"This is a Factory!"</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// config中定义service</span></span><br><span class="line">    $provide.service(<span class="string">"service"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.warning = <span class="string">"This is a Service!"</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// config中定义constant</span></span><br><span class="line">    $provide.constant(<span class="string">"CONSTANT"</span>, <span class="string">"This is a Constant!"</span>);</span><br><span class="line">    <span class="comment">// config中定义value</span></span><br><span class="line">    $provide.value(<span class="string">"value"</span>, <span class="string">"This is a Value!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// config上定义decorator</span></span><br><span class="line">    $provide.decorator(<span class="string">"value"</span>, decorator);</span><br><span class="line">    decorator.$inject = [<span class="string">"$delegate"</span>]; <span class="comment">// $delegate是需要被修饰服务的实例，即上面语句中声明的value</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">decorator</span>(<span class="params">$delegate</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $delegate + <span class="string">" with Decorator!!"</span>; <span class="comment">// 对value进行修饰</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Controller */</span></span><br><span class="line">  TestController.$inject = [</span><br><span class="line">    <span class="string">"message"</span>,</span><br><span class="line">    <span class="string">"CONSTANT"</span>,</span><br><span class="line">    <span class="string">"value"</span>,</span><br><span class="line">    <span class="string">"factory"</span>,</span><br><span class="line">    <span class="string">"service"</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">TestController</span>(<span class="params">message, CONSTANT, value, factory, service</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// controller当中调用各个provider</span></span><br><span class="line">    <span class="built_in">console</span>.info(message.infomation);</span><br><span class="line">    <span class="built_in">console</span>.info(CONSTANT);</span><br><span class="line">    <span class="built_in">console</span>.info(value);</span><br><span class="line">    <span class="built_in">console</span>.info(factory.reminder);</span><br><span class="line">    <span class="built_in">console</span>.info(service.warning);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * This is a Provider!</span></span><br><span class="line"><span class="comment">   * This is a Constant!</span></span><br><span class="line"><span class="comment">   * This is a Value! with Decorator!!</span></span><br><span class="line"><span class="comment">   * This is a Factory!</span></span><br><span class="line"><span class="comment">   * This is a Service!</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>除了在 config 当中通过<code>$provide</code>定义 provider 之外，还可以通过 module 上提供的语法糖方法更加方便的建立 provider，出于代码松耦合以及分块编写的考虑，这里推荐使用语法糖的方式去提供 provider。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = angular</span><br><span class="line">    .module(<span class="string">"app.test"</span>, [])</span><br><span class="line">    .config(testConfig)</span><br><span class="line">    .controller(<span class="string">"TestController"</span>, TestController);</span><br><span class="line"></span><br><span class="line">  testConfig.$inject = [<span class="string">"$provide"</span>, <span class="string">"messageProvider"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testConfig</span>(<span class="params">$provide, messageProvider</span>) </span>&#123;</span><br><span class="line">    messageProvider.setMessage(<span class="string">"Provider!"</span>); <span class="comment">// provider可以被注入到config中</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// module上定义provider</span></span><br><span class="line">  <span class="built_in">module</span>.provider(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> message;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      setMessage: <span class="function"><span class="keyword">function</span>(<span class="params">infomation</span>) </span>&#123;</span><br><span class="line">        message = infomation;</span><br><span class="line">      &#125;,</span><br><span class="line">      $<span class="keyword">get</span>: function() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          infomation: <span class="string">"This is a "</span> + message</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// module上定义factory</span></span><br><span class="line">  <span class="built_in">module</span>.factory(<span class="string">"factory"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      reminder: <span class="string">"This is a Factory!"</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// module上定义service</span></span><br><span class="line">  <span class="built_in">module</span>.service(<span class="string">"service"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.warning = <span class="string">"This is a Service!"</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>.constant(<span class="string">"CONSTANT"</span>, <span class="string">"This is a Constant!"</span>); <span class="comment">// module上定义constant</span></span><br><span class="line">  <span class="built_in">module</span>.value(<span class="string">"value"</span>, <span class="string">"This is a Value!"</span>); <span class="comment">// module上定义value</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// module上定义decorator</span></span><br><span class="line">  <span class="built_in">module</span>.decorator(<span class="string">"value"</span>, decorator);</span><br><span class="line">  decorator.$inject = [<span class="string">"$delegate"</span>];</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">decorator</span>(<span class="params">$delegate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $delegate + <span class="string">" with Decorator!!"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  TestController.$inject = [</span><br><span class="line">    <span class="string">"message"</span>,</span><br><span class="line">    <span class="string">"CONSTANT"</span>,</span><br><span class="line">    <span class="string">"value"</span>,</span><br><span class="line">    <span class="string">"factory"</span>,</span><br><span class="line">    <span class="string">"service"</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">TestController</span>(<span class="params">message, CONSTANT, value, factory, service</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// controller当中调用各个provider</span></span><br><span class="line">    <span class="built_in">console</span>.info(message.infomation);</span><br><span class="line">    <span class="built_in">console</span>.info(CONSTANT);</span><br><span class="line">    <span class="built_in">console</span>.info(value);</span><br><span class="line">    <span class="built_in">console</span>.info(factory.reminder);</span><br><span class="line">    <span class="built_in">console</span>.info(service.warning);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * This is a Provider!</span></span><br><span class="line"><span class="comment">   * This is a Constant!</span></span><br><span class="line"><span class="comment">   * This is a Value! with Decorator!!</span></span><br><span class="line"><span class="comment">   * This is a Factory!</span></span><br><span class="line"><span class="comment">   * This is a Service!</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="angular-当中的q">Angular 当中的$q</h2>
<p>一个 promises/deferred 对象的 Promises/A+兼容实现，受到<a href="https://github.com/kriskowal/q" target="_blank" rel="noopener">Kris Kowal"s Q</a>启发但并未实现全部功能，$q 能够以如下 2 种流行的方式进行使用。</p>
<ol type="1">
<li>Kris Kowal"s Q 或者 jQuery 的 Deferred 对象：首先通过<code>$q.defer()</code>创建一个 deferred 对象，然后通过 deferred 对象的 promise 属性转换为 Promise 对象。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncGreet</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> deferred = $q.defer();</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    deferred.notify(<span class="string">"About to greet "</span> + name + <span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">if</span> (okToGreet(name)) &#123;</span><br><span class="line">      deferred.resolve(<span class="string">"Hello, "</span> + name + <span class="string">"!"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      deferred.reject(<span class="string">"Greeting "</span> + name + <span class="string">" is not allowed."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>类似 ES6 原生 Promise 的方式：$q 作为构造函数，接收<code>resolver()</code>函数作为第 1 个参数，<code>$q(resolver)</code>将会返回一个新建的 Promise 对象。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$q(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (okToGreet(name)) &#123;</span><br><span class="line">      resolve(<span class="string">"Hello, "</span> + name + <span class="string">"!"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reject(<span class="string">"Greeting "</span> + name + <span class="string">" is not allowed."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>出于 team 逐步向 ES6 标准演进的考虑，这里推荐使用 ES6 原生风格的 Promise 写法。</p>
</blockquote>
<h2 id="不容忽视的sce-服务">不容忽视的$sce 服务</h2>
<p><span class="math inline">\(sce用于在Angular中提供严格的上下文转义（*SCE, Strict Contextual Escaping*）服务，从而避免XSS（*跨站脚本攻击*）, clickjacking（*点击劫持*）等安全性问题，\)</span>sce 服务目前支持的上下文类型有 5 种。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  angular.module(<span class="string">"app.common"</span>).filter(<span class="string">"uinikaTrustHtml"</span>, uinikaTrustHtml);</span><br><span class="line"></span><br><span class="line">  uinikaTrustHtml.$inject = [<span class="string">"$sce"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">uinikaTrustHtml</span>(<span class="params">$sce</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $sce.trustAsHtml(val);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最佳实践原则：项目中所有用户可以自由编辑的位置，都需要通过<code>$sce</code>进行无害化处理。</p>
</blockquote>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Hank
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://uinika.github.io/Web/Angularjs.html" title="AngularJS 1.6.x 最佳实践总结">https://uinika.github.io/Web/Angularjs.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/JavaScript/" rel="tag"><i class="fa fa-tag"></i> JavaScript</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Other/2017-Chengdu-Realestate.html" rel="prev" title="2017年，再聊聊成都房价、地价那些事儿">
      <i class="fa fa-chevron-left"></i> 2017年，再聊聊成都房价、地价那些事儿
    </a></div>
      <div class="post-nav-item">
    <a href="/Web/CSS2.html" rel="next" title="CSS 2.1 典型概念与布局详解">
      CSS 2.1 典型概念与布局详解 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#项目结构"><span class="nav-number">1.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#index-索引页"><span class="nav-number">2.</span> <span class="nav-text">Index 索引页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#app-启动点"><span class="nav-number">3.</span> <span class="nav-text">App 启动点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#module-模块"><span class="nav-number">4.</span> <span class="nav-text">Module 模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#controller-控制器"><span class="nav-number">5.</span> <span class="nav-text">Controller 控制器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#service-服务"><span class="nav-number">6.</span> <span class="nav-text">Service 服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#directive-指令"><span class="nav-number">7.</span> <span class="nav-text">Directive 指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#filter-过滤器"><span class="nav-number">8.</span> <span class="nav-text">Filter 过滤器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jwt-权限控制"><span class="nav-number">9.</span> <span class="nav-text">JWT 权限控制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#module-中的-run-和-config"><span class="nav-number">10.</span> <span class="nav-text">Module 中的 Run 和 Config</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#location-的配置"><span class="nav-number">11.</span> <span class="nav-text">$location 的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#跨控制器的事件交互"><span class="nav-number">12.</span> <span class="nav-text">跨控制器的事件交互</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#angular-的-html-模板编译步骤"><span class="nav-number">13.</span> <span class="nav-text">Angular 的 HTML 模板编译步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指令-complie和-link的区别"><span class="nav-number">14.</span> <span class="nav-text">指令 complie()和 link()的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#digest-循环"><span class="nav-number">15.</span> <span class="nav-text">$digest 循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何理解-provider"><span class="nav-number">16.</span> <span class="nav-text">如何理解 Provider</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#angular-当中的q"><span class="nav-number">17.</span> <span class="nav-text">Angular 当中的$q</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不容忽视的sce-服务"><span class="nav-number">18.</span> <span class="nav-text">不容忽视的$sce 服务</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hank"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Hank</p>
  <div class="site-description" itemprop="description">My world of IT, learn it & play it.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/uinika" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;uinika" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/uinika/posts" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;uinika&#x2F;posts" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:uinika@outlook.com" title="Email → mailto:uinika@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>Email</a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:uinika@outlook.com?call|chat" title="Skype → skype:uinika@outlook.com?call|chat" rel="noopener" target="_blank"><i class="fa fa-fw fa-skype"></i>Skype</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/7998979/uinika?tab=profile" title="Stack Overflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;7998979&#x2F;uinika?tab&#x3D;profile" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2010 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"><a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.6m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">24:59</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
