<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#8C634F">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#8C634F">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Monda:300,300italic,400,400italic,700,700italic|Source+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"uinika.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#A38272","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Django是一款基于 Python 编写并且采用 MVC 设计模式的开源的 Web 应用框架，早期是作为劳伦斯出版集团新闻网站的 CMS 内容管理系统而开发，后于 2005 年 7 月 在 BSD 许可协议下开源，并于 2017 年 12 月 2 日 发布 2.0 正式版。虽然近几年 Go 语言在 Web 开发领域异军突起，但是在框架成熟度以及语言生态方面与 Python 还存有一定差距，针对于">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Django2 快速开发 Web 服务">
<meta property="og:url" content="https://uinika.github.io/Web/Django.html">
<meta property="og:site_name" content="Bit by bit">
<meta property="og:description" content="Django是一款基于 Python 编写并且采用 MVC 设计模式的开源的 Web 应用框架，早期是作为劳伦斯出版集团新闻网站的 CMS 内容管理系统而开发，后于 2005 年 7 月 在 BSD 许可协议下开源，并于 2017 年 12 月 2 日 发布 2.0 正式版。虽然近几年 Go 语言在 Web 开发领域异军突起，但是在框架成熟度以及语言生态方面与 Python 还存有一定差距，针对于">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://uinika.github.io/Web/Django/logo.png">
<meta property="og:image" content="https://uinika.github.io/Web/Django/django-helloworld.png">
<meta property="og:image" content="https://uinika.github.io/Web/Django/django-admin.png">
<meta property="og:image" content="https://uinika.github.io/Web/Django/django-admin-update.png">
<meta property="og:image" content="https://uinika.github.io/Web/Django/form.gif">
<meta property="og:image" content="https://uinika.github.io/Web/Django/form-result.gif">
<meta property="og:image" content="https://uinika.github.io/Web/Django/rest-logo.png">
<meta property="og:image" content="https://uinika.github.io/Web/Django/rest-quick-start.png">
<meta property="article:published_time" content="2020-05-21T13:39:03.814Z">
<meta property="article:modified_time" content="2020-05-21T13:39:03.814Z">
<meta property="article:author" content="Hank">
<meta property="article:tag" content="Server">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://uinika.github.io/Web/Django/logo.png">

<link rel="canonical" href="https://uinika.github.io/Web/Django.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>使用 Django2 快速开发 Web 服务 | Bit by bit</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Bit by bit" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bit by bit</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Electronics, Embedded & Web</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-th-large"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">55</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">24</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-briefcase"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-it圈">

    <a href="/industry/" rel="section"><i class="fa fa-fw fa-microchip"></i>IT圈</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/uinika" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://uinika.github.io/Web/Django.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Hank">
      <meta itemprop="description" content="My world of IT, learn it & play it.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bit by bit">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用 Django2 快速开发 Web 服务
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 21:39:03" itemprop="dateCreated datePublished" datetime="2020-05-21T21:39:03+08:00">2020-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>34k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>31 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a href="https://www.djangoproject.com/" target="_blank" rel="noopener">Django</a>是一款基于 Python 编写并且采用 MVC 设计模式的开源的 Web 应用框架，早期是作为劳伦斯出版集团新闻网站的 CMS 内容管理系统而开发，后于 <strong>2005 年 7 月</strong> 在 BSD 许可协议下开源，并于 <strong>2017 年 12 月 2 日</strong> 发布 2.0 正式版。虽然近几年 Go 语言在 Web 开发领域异军突起，但是在框架成熟度以及语言生态方面与 Python 还存有一定差距，针对于需要快速开发的原型类项目以及性能要求不高的 CMS 和 Admin 类型项目，已经发展了 12 年之久的 Django 依然是非常明智的选择。</p>
<p><img src="/Web/Django/logo.png"></p>
<p>本文基于<a href="https://docs.djangoproject.com/en/2.1/intro/" target="_blank" rel="noopener">《Django 官方 Tutorials》</a>以及<a href="https://www.django-rest-framework.org/" target="_blank" rel="noopener">《Django REST framework 官方 Tutorials》</a>编写，发稿时所使用的 Django 版本为<code>2.1.4</code>，Python 版本为<code>3.6.6</code>，文中涉及的代码都已经由笔者验证运行通过，最终形成了一个简单项目并推送至笔者<a href="https://github.com/uinika" target="_blank" rel="noopener">Github</a>上的<a href="https://github.com/uinika/jungle" target="_blank" rel="noopener">jungle</a>项目当中，需要的朋友可以基于此来逐步步完善成为一个产品化的项目。</p>
<a id="more"></a>
<h1 id="新建-django-项目">新建 Django 项目</h1>
<p>下面的命令行展示了在 Windows 操作系统下，基于 venv 虚拟环境搭建一个 Django 项目的步骤：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># 建立虚拟环境</span><br><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">λ <span class="title">python</span> -<span class="title">m</span> <span class="title">venv</span> <span class="title">venv</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 激活虚拟环境</span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">λ .\<span class="title">venv</span>\<span class="title">Scripts</span>\<span class="title">activate.bat</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 安装<span class="title">Django</span></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">pip</span> <span class="title">install</span> <span class="title">Django</span></span></span><br><span class="line"><span class="function"><span class="title">Looking</span> <span class="title">in</span> <span class="title">indexes</span>: <span class="title">https</span>://<span class="title">mirrors.aliyun.com</span>/<span class="title">pypi</span>/<span class="title">simple</span>/</span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">Django</span></span></span><br><span class="line"><span class="function">  <span class="title">Using</span> <span class="title">cached</span> <span class="title">https</span>://<span class="title">mirrors.aliyun.com</span>/<span class="title">pypi</span>/<span class="title">packages</span>/<span class="title">fd</span>/9<span class="title">a</span>/0<span class="title">c028ea0fe4f5803dda1a7afabeed958d0c8b79b0fe762ffbf728db3b90d</span>/<span class="title">Django</span>-2.1.4-<span class="title">py3</span>-<span class="title">none</span>-<span class="title">any.whl</span></span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">pytz</span> (<span class="title">from</span> <span class="title">Django</span>)</span></span><br><span class="line"><span class="function">  <span class="title">Using</span> <span class="title">cached</span> <span class="title">https</span>://<span class="title">mirrors.aliyun.com</span>/<span class="title">pypi</span>/<span class="title">packages</span>/<span class="title">f8</span>/0<span class="title">e</span>/2365<span class="title">ddc010afb3d79147f1dd544e5ee24bf4ece58ab99b16fbb465ce6dc0</span>/<span class="title">pytz</span>-2018.7-<span class="title">py2.py3</span>-<span class="title">none</span>-<span class="title">any.whl</span></span></span><br><span class="line"><span class="function"><span class="title">Installing</span> <span class="title">collected</span> <span class="title">packages</span>: <span class="title">pytz</span>, <span class="title">Django</span></span></span><br><span class="line"><span class="function"><span class="title">Successfully</span> <span class="title">installed</span> <span class="title">Django</span>-2.1.4 <span class="title">pytz</span>-2018.7</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 进入虚拟环境目录，新建一个<span class="title">Django</span>项目</span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">django</span>-<span class="title">admin</span> <span class="title">startproject</span> <span class="title">mysite</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">ls</span></span></span><br><span class="line"><span class="function"><span class="title">mysite</span>/  <span class="title">venv</span>/</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 进入新建的<span class="title">Django</span>项目，建立一个应用</span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">cd</span> <span class="title">mysite</span>\</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">startapp</span> <span class="title">demo</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">ls</span></span></span><br><span class="line"><span class="function"><span class="title">demo</span>/  <span class="title">manage.py</span>*  <span class="title">mysite</span>/</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 同步数据库</span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">migrate</span></span></span><br><span class="line"><span class="function"><span class="title">Operations</span> <span class="title">to</span> <span class="title">perform</span>:</span></span><br><span class="line"><span class="function">  <span class="title">Apply</span> <span class="title">all</span> <span class="title">migrations</span>: <span class="title">admin</span>, <span class="title">auth</span>, <span class="title">contenttypes</span>, <span class="title">sessions</span></span></span><br><span class="line"><span class="function"><span class="title">Running</span> <span class="title">migrations</span>:</span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">contenttypes</span>.0001<span class="title">_initial</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0001<span class="title">_initial</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">admin</span>.0001<span class="title">_initial</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">admin</span>.0002<span class="title">_logentry_remove_auto_add</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">admin</span>.0003<span class="title">_logentry_add_action_flag_choices</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">contenttypes</span>.0002<span class="title">_remove_content_type_name</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0002<span class="title">_alter_permission_name_max_length</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0003<span class="title">_alter_user_email_max_length</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0004<span class="title">_alter_user_username_opts</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0005<span class="title">_alter_user_last_login_null</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0006<span class="title">_require_contenttypes_0002</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0007<span class="title">_alter_validators_add_error_messages</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0008<span class="title">_alter_user_username_max_length</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">auth</span>.0009<span class="title">_alter_user_last_name_max_length</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function">  <span class="title">Applying</span> <span class="title">sessions</span>.0001<span class="title">_initial</span>... <span class="title">OK</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 启动开发服务</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">runserver</span> 8080</span></span><br><span class="line"><span class="function"><span class="title">Performing</span> <span class="title">system</span> <span class="title">checks</span>...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">System</span> <span class="title">check</span> <span class="title">identified</span> <span class="title">no</span> <span class="title">issues</span> (0 <span class="title">silenced</span>).</span></span><br><span class="line"><span class="function"><span class="title">January</span> 03, 2019 - 21:31:48</span></span><br><span class="line"><span class="function"><span class="title">Django</span> <span class="title">version</span> 2.1.4, <span class="title">using</span> <span class="title">settings</span> '<span class="title">mysite.settings</span>'</span></span><br><span class="line"><span class="function"><span class="title">Starting</span> <span class="title">development</span> <span class="title">server</span> <span class="title">at</span> <span class="title">http</span>://127.0.0.1:8080/</span></span><br><span class="line"><span class="function"><span class="title">Quit</span> <span class="title">the</span> <span class="title">server</span> <span class="title">with</span> <span class="title">CTRL</span>-<span class="title">BREAK</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 返回<span class="title">uinika</span>虚拟环境目录，并将当前虚拟环境的依赖导入至<span class="title">requirements.txt</span></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">cd</span> ..</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">pip</span> <span class="title">freeze</span> &gt; <span class="title">requirements.txt</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span></span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">ls</span></span></span><br><span class="line"><span class="function"><span class="title">mysite</span>/  <span class="title">requirements.txt</span>  <span class="title">venv</span>/</span></span><br></pre></td></tr></table></figure>
<p>通过<code>django-admin startproject</code>命令创建的外部<code>mysite/</code>目录是 Web 项目的容器，而<code>manage.py</code>文件是用于与 Django 项目交互的命令行工具，更多的使用方式可以参阅<a href="https://docs.djangoproject.com/en/2.1/ref/django-admin/" target="_blank" rel="noopener">django-admin 文档</a>。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysite&#x2F;</span><br><span class="line">  manage.py</span><br><span class="line">  mysite&#x2F;</span><br><span class="line">    __init__.py</span><br><span class="line">    settings.py</span><br><span class="line">    urls.py</span><br><span class="line">    wsgi.py</span><br></pre></td></tr></table></figure>
<p>内部嵌套的<code>mysite/</code>目录是用于放置项目中具体的 Python 包，它的名称是您需要用来导入其中任何内容的 Python 包名称，例如<code>mysite.urls</code>。</p>
<ul>
<li><code>mysite/__init__.py</code>: 空文件，用于提示系统将当前目录识别为一个 Python 包。</li>
<li><code>mysite/settings.py</code>: Django 项目的配置文件，更多配置请查阅<a href="https://docs.djangoproject.com/en/2.1/topics/settings/" target="_blank" rel="noopener">Django settings</a>。</li>
<li><code>mysite/urls.py</code>: 当前 Django 项目的 URL 声明，更多内容请参阅<a href="https://docs.djangoproject.com/en/2.1/topics/http/urls/" target="_blank" rel="noopener">URL dispatcher</a>。</li>
<li><code>mysite/wsgi.py</code>: 兼容 WSGI 规范的当前项目入口点，更多细节可以阅读<a href="https://docs.djangoproject.com/en/2.1/howto/deployment/wsgi/" target="_blank" rel="noopener">如果使用 WSGI 进行部署</a>。</li>
</ul>
<p>建立<code>mysite</code>项目之后，上面的命令行还通过了<code>py manage.py startapp</code>建立了一个<code>demo/</code>应用目录，Django 当中一个项目(<code>mysite</code>)可以拥有多个应用(<code>demo</code>)，<code>demo/</code>目录下的文件结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">demo&#x2F;</span><br><span class="line">  __init__.py</span><br><span class="line">  admin.py</span><br><span class="line">  apps.py</span><br><span class="line">  migrations&#x2F;</span><br><span class="line">    __init__.py</span><br><span class="line">  models.py</span><br><span class="line">  tests.py</span><br><span class="line">  views.py</span><br></pre></td></tr></table></figure>
<p>使用命令<code>python manage.py runserver</code>启动 Django 服务时，默认会监听<code>localhost</code>地址下的<code>80</code>端口，如果希望网络里的其它主机能够正常访问服务，必须在<code>mysite/settings.py</code>显式的声明当前允许的主机地址：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALLOWED_HOSTS = [<span class="string">'10.102.16.79'</span>]</span><br></pre></td></tr></table></figure>
<p>然后使用<code>manage.py</code>启动服务时，指定好主机名和对应的端口号：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">cloud</span>-<span class="title">key</span>\<span class="title">mysite</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">runserver</span> 10.102.16.79:8000</span></span><br><span class="line"><span class="function"><span class="title">Performing</span> <span class="title">system</span> <span class="title">checks</span>...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">System</span> <span class="title">check</span> <span class="title">identified</span> <span class="title">no</span> <span class="title">issues</span> (0 <span class="title">silenced</span>).</span></span><br><span class="line"><span class="function"><span class="title">January</span> 09, 2019 - 14:09:48</span></span><br><span class="line"><span class="function"><span class="title">Django</span> <span class="title">version</span> 2.1.5, <span class="title">using</span> <span class="title">settings</span> '<span class="title">mysite.settings</span>'</span></span><br><span class="line"><span class="function"><span class="title">Starting</span> <span class="title">development</span> <span class="title">server</span> <span class="title">at</span> <span class="title">http</span>://10.102.16.79:8000/</span></span><br><span class="line"><span class="function"><span class="title">Quit</span> <span class="title">the</span> <span class="title">server</span> <span class="title">with</span> <span class="title">CTRL</span>-<span class="title">BREAK</span>.</span></span><br></pre></td></tr></table></figure>
<h1 id="请求与响应">请求与响应</h1>
<p>首先进入 Python 虚拟环境并进入<code>mysite</code>目录后，执行如下命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">startapp</span> <span class="title">polls</span></span></span><br></pre></td></tr></table></figure>
<h2 id="pollsviews.py">polls/views.py</h2>
<p>新建一个<code>polls</code>应用之后，打开该目录下的<code>polls/views.py</code>源码文件，输入以下代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"你好，这是一个投票应用！"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="pollsurls.py">polls/urls.py</h2>
<p>接下来，我们需要将上面修改的视图文件<code>views.py</code>映射到一个 URL，先在<code>polls/</code>目录下新建一个<code>urls.py</code>文件，然后键入下面这段代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="mysiteurls.py">mysite/urls.py</h2>
<p>最后，将上面定义的应用的 URL 声明文件<code>polls/urls.py</code>模块包含至项目的<code>mysite/urls.py</code>代码当中，</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>上面代码中出现的<code>include()</code>函数主要用于引入其它 URL 配置文件，这样我们就可以通过<code>http://localhost:8080/polls/</code>路径访问到如下信息了：</p>
<p><img src="/Web/Django/django-helloworld.png"></p>
<h1 id="模型和管理页面">模型和管理页面</h1>
<ul>
<li><strong>Model 类</strong>：Django 中每一个 Model 都是<code>django.db.models.Model</code>的子类，每个 Model 类都映射着一个数据库表，Model 的每个属性则相当于一个数据库字段。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Django会在Blog类创建后自动生成`CREATE TABLE`语句。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blog</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    content = models.CharField(max_length=<span class="number">800</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Model 实例</strong>：Model 类的实例用来表示数据库表中的一条特定记录，可以通过向 Model() 类传递关键字参数，然后调用<code>save()</code>方法保存至数据库，从而创建出一个 Model 类实例。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> blog.models <span class="keyword">import</span> Blog</span><br><span class="line"></span><br><span class="line">blog = Blog(title=<span class="string">'Bit by bit'</span>, content=<span class="string">'一些内容。'</span>)</span><br><span class="line">blog.save()  <span class="comment"># 该方法没有返回值，在底层会生成并执行一条insert语句</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>QuerySet</strong>： QuerySet 表示数据库查询的结果集（<em>SELECT 语句</em>），该结果集拥有一个或多个过滤方法（<em>WHERE 或 LIMIT 子句</em>）。获取结果集可通过 Model 的 Manager 管理器（<em>用于向 Django 模型提供数据库查询操作的接口</em>），而<code>Manager</code>则默认由结果集的<code>objects</code>属性获得。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Blog.objects <span class="comment"># &lt;django.db.models.manager.Manager object at ...&gt;</span></span><br><span class="line">Blog.objects.all() <span class="comment"># 包含Blog对象里的所有记录</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Django 当中，<code>QuerySet</code>用来执行<strong>记录级操作</strong>，<code>Model</code>实例则用来进行<strong>表级操作</strong>。</p>
</blockquote>
<h2 id="mysitesettings.py">mysite/settings.py</h2>
<p><code>mysite/settings.py</code>文件包含了项目的基本配置，该文件通过如下声明默认使用 Django 内置的 SQLite 作为项目数据库。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">  <span class="string">'default'</span>: &#123;</span><br><span class="line">    <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.sqlite3'</span>,</span><br><span class="line">    <span class="string">'NAME'</span>: os.path.join(BASE_DIR, <span class="string">'db.sqlite3'</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果使用其它数据库，则可以将配置书写为下面的格式：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">  <span class="string">'default'</span>: &#123;</span><br><span class="line">    <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,     <span class="comment"># 数据库引擎名称</span></span><br><span class="line">    <span class="string">'NAME'</span>: <span class="string">'db'</span>,                             <span class="comment"># 数据库连接名称</span></span><br><span class="line">    <span class="string">'USER'</span>: <span class="string">'uinika'</span>,                         <span class="comment"># 数据库连接用户名</span></span><br><span class="line">    <span class="string">'PASSWORD'</span>: <span class="string">'test'</span>,                       <span class="comment"># 数据库连接密码</span></span><br><span class="line">    <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,                      <span class="comment"># 数据库主机地址</span></span><br><span class="line">    <span class="string">'PORT'</span>: <span class="string">'3306'</span>,                           <span class="comment"># 数据库端口</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>ENGINE</code>属性可以根据项目所使用数据库的不同而选择如下值：</p>
<ul>
<li>SQLite：<code>django.db.backends.sqlite3</code></li>
<li>MySQL：<code>django.db.backends.mysql</code></li>
<li>PostgreSQL：<code>django.db.backends.postgresql</code></li>
<li>Oracle：<code>django.db.backends.oracle</code></li>
</ul>
<p>接下来继续修改<code>mysite/settings.py</code>，设置<code>TIME_ZONE</code>属性为项目使用国家的时区。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">'zh-hans'</span></span><br><span class="line">TIME_ZONE = <span class="string">'Asia/Chongqing'</span></span><br></pre></td></tr></table></figure>
<p><code>mysite/settings.py</code>文件头部的<code>INSTALLED_APPS</code>属性定义了当前项目使用的应用程序。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">  <span class="string">'django.contrib.admin'</span>,          <span class="comment"># 管理员站点</span></span><br><span class="line">  <span class="string">'django.contrib.auth'</span>,           <span class="comment"># 认证授权系统</span></span><br><span class="line">  <span class="string">'django.contrib.contenttypes'</span>,   <span class="comment"># 内容类型框架</span></span><br><span class="line">  <span class="string">'django.contrib.sessions'</span>,       <span class="comment"># 会话框架</span></span><br><span class="line">  <span class="string">'django.contrib.messages'</span>,       <span class="comment"># 消息框架</span></span><br><span class="line">  <span class="string">'django.contrib.staticfiles'</span>,    <span class="comment"># 静态文件管理</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在前面命令行中执行的<code>python manage.py migrate</code>命令会检查<code>INSTALLED_APPS</code>属性的设置，并为其中的每个应用创建所需的数据表，实际上<strong><code>migrate</code>命令只会为对<code>INSTALLED_APPS</code>里声明了的应用进行数据库迁移</strong>。</p>
</blockquote>
<h2 id="pollsmodels.py">polls/models.py</h2>
<p>了解项目配置文件的一些设置之后，现在来编辑<code>polls/models.py</code>文件新建<code>Question(问题)</code>和<code>Choice(选项)</code>两个数据模型：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>每个自定义模型都是<code>django.db.models.Model</code>的子类，模型里的类变量都表示一个数据库字段，每个字段实质都是<code>Field</code>类的实例。注意在<code>Choice</code>使用了<code>ForeignKey</code>属性定义了一个与<code>Question</code>的外键关联关系，Django 支持所有常用的多对一、多对多和一对一数据库关系。</p>
<h2 id="mysitesettings.py-1">mysite/settings.py</h2>
<p>数据库模型建立完成之后，由于<code>PollsConfig</code>类位于<code>polls/apps.py</code>文件当中，所以其对应的点式路径为<code>polls.apps.PollsConfig</code>，现在我们需要将该路径添加至<code>mysite/settings.py</code>文件的<code>INSTALLED_APPS</code>属性：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">  <span class="string">'polls.apps.PollsConfig'</span>, <span class="comment"># 添加PollsConfig</span></span><br><span class="line">  <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">  <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">  <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">  <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">  <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">  <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="将数据模型迁移至数据库">将数据模型迁移至数据库</h2>
<p>通过<code>manage.py</code>提供的<code>makemigrations</code>命令，可以将模型的更新迁移至 SQLite 数据库当中。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">makemigrations</span> <span class="title">polls</span></span></span><br><span class="line"><span class="function"><span class="title">Migrations</span> <span class="title">for</span> '<span class="title">polls</span>':</span></span><br><span class="line"><span class="function">  <span class="title">polls</span>\<span class="title">migrations</span>\0001<span class="title">_initial.py</span></span></span><br><span class="line"><span class="function">    - <span class="title">Create</span> <span class="title">model</span> <span class="title">Choice</span></span></span><br><span class="line"><span class="function">    - <span class="title">Create</span> <span class="title">model</span> <span class="title">Question</span></span></span><br><span class="line"><span class="function">    - <span class="title">Add</span> <span class="title">field</span> <span class="title">question</span> <span class="title">to</span> <span class="title">choice</span></span></span><br></pre></td></tr></table></figure>
<p>我们还可以通过<code>manage.py</code>提供的<code>sqlmigrate</code>命令，查看数据迁移过程中执行了哪些 SQL 语句，该命令并不会实质性执行 Django 模型到数据库的迁移任务。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">sqlmigrate</span> <span class="title">polls</span> 0001</span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span>;</span></span><br><span class="line"><span class="function">--</span></span><br><span class="line"><span class="function">-- <span class="title">Create</span> <span class="title">model</span> <span class="title">Choice</span></span></span><br><span class="line"><span class="function">--</span></span><br><span class="line"><span class="function"><span class="title">CREATE</span> <span class="title">TABLE</span> "<span class="title">polls_choice</span>" ("<span class="title">id</span>" <span class="title">integer</span> <span class="title">NOT</span> <span class="title">NULL</span> <span class="title">PRIMARY</span> <span class="title">KEY</span> <span class="title">AUTOINCREMENT</span>, "<span class="title">choice_text</span>" <span class="title">varchar</span>(200) <span class="title">NOT</span> <span class="title">NULL</span>, "<span class="title">v</span></span></span><br><span class="line"><span class="function"><span class="title">otes</span>" <span class="title">integer</span> <span class="title">NOT</span> <span class="title">NULL</span>);</span></span><br><span class="line"><span class="function">--</span></span><br><span class="line"><span class="function">-- <span class="title">Create</span> <span class="title">model</span> <span class="title">Question</span></span></span><br><span class="line"><span class="function">--</span></span><br><span class="line"><span class="function"><span class="title">CREATE</span> <span class="title">TABLE</span> "<span class="title">polls_question</span>" ("<span class="title">id</span>" <span class="title">integer</span> <span class="title">NOT</span> <span class="title">NULL</span> <span class="title">PRIMARY</span> <span class="title">KEY</span> <span class="title">AUTOINCREMENT</span>, "<span class="title">question_text</span>" <span class="title">varchar</span>(200) <span class="title">NOT</span> <span class="title">NULL</span></span></span><br><span class="line"><span class="function">, "<span class="title">pub_date</span>" <span class="title">datetime</span> <span class="title">NOT</span> <span class="title">NULL</span>);</span></span><br><span class="line"><span class="function">--</span></span><br><span class="line"><span class="function">-- <span class="title">Add</span> <span class="title">field</span> <span class="title">question</span> <span class="title">to</span> <span class="title">choice</span></span></span><br><span class="line"><span class="function">--</span></span><br><span class="line"><span class="function"><span class="title">ALTER</span> <span class="title">TABLE</span> "<span class="title">polls_choice</span>" <span class="title">RENAME</span> <span class="title">TO</span> "<span class="title">polls_choice__old</span>";</span></span><br><span class="line"><span class="function"><span class="title">CREATE</span> <span class="title">TABLE</span> "<span class="title">polls_choice</span>" ("<span class="title">id</span>" <span class="title">integer</span> <span class="title">NOT</span> <span class="title">NULL</span> <span class="title">PRIMARY</span> <span class="title">KEY</span> <span class="title">AUTOINCREMENT</span>, "<span class="title">choice_text</span>" <span class="title">varchar</span>(200) <span class="title">NOT</span> <span class="title">NULL</span>, "<span class="title">v</span></span></span><br><span class="line"><span class="function"><span class="title">otes</span>" <span class="title">integer</span> <span class="title">NOT</span> <span class="title">NULL</span>, "<span class="title">question_id</span>" <span class="title">integer</span> <span class="title">NOT</span> <span class="title">NULL</span> <span class="title">REFERENCES</span> "<span class="title">polls_question</span>" ("<span class="title">id</span>") <span class="title">DEFERRABLE</span> <span class="title">INITIALLY</span> <span class="title">DEFERR</span></span></span><br><span class="line"><span class="function"><span class="title">ED</span>);</span></span><br><span class="line"><span class="function"><span class="title">INSERT</span> <span class="title">INTO</span> "<span class="title">polls_choice</span>" ("<span class="title">id</span>", "<span class="title">choice_text</span>", "<span class="title">votes</span>", "<span class="title">question_id</span>") <span class="title">SELECT</span> "<span class="title">id</span>", "<span class="title">choice_text</span>", "<span class="title">votes</span>", <span class="title">NULL</span> <span class="title">FR</span></span></span><br><span class="line"><span class="function"><span class="title">OM</span> "<span class="title">polls_choice__old</span>";</span></span><br><span class="line"><span class="function"><span class="title">DROP</span> <span class="title">TABLE</span> "<span class="title">polls_choice__old</span>";</span></span><br><span class="line"><span class="function"><span class="title">CREATE</span> <span class="title">INDEX</span> "<span class="title">polls_choice_question_id_c5b4b260</span>" <span class="title">ON</span> "<span class="title">polls_choice</span>" ("<span class="title">question_id</span>");</span></span><br><span class="line"><span class="function"><span class="title">COMMIT</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Django 模型的数据库主键 ID 会被自动创建， 并会在外键字段名称后追加<code>_id</code>字符串作为后缀。</p>
</blockquote>
<p>接下来运行<code>manage.py</code>提供的<code>migrate</code>命令，在根据新定义的模型创建相应的数据库表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Workspace\django\mysite (master -&gt; origin)</span><br><span class="line">(venv) λ python manage.py migrate</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, polls, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying polls.0001_initial... OK</span><br></pre></td></tr></table></figure>
<p>为了便于在版本管理系统提交迁移数据，Django 将模型的修改分别独立为<strong>生成</strong>和<strong>应用</strong>两个命令，因此修改 Django 模型会涉及如下 3 个步骤：</p>
<ol type="1">
<li>编辑<code>models.py</code>文件修改模型。</li>
<li>运行<code>python manage.py makemigrations</code>为模型的改变生成迁移文件。</li>
<li>运行<code>python manage.py migrate</code>来应用数据库迁移。</li>
</ol>
<p>完成上述 Django 模型与数据库的同步之后，接下来可以通过<code>manage.py</code>提供的<code>shell</code>命令，在命令行工具内运行 Django 提供的交互式 API。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">shell</span></span></span><br><span class="line"><span class="function"><span class="title">Python</span> 3.6.6 (<span class="title">v3</span>.6.6:4<span class="title">cf1f54eb7</span>, <span class="title">Jun</span> 27 2018, 03:37:03) [<span class="title">MSC</span> <span class="title">v</span>.1900 64 <span class="title">bit</span> (<span class="title">AMD64</span>)] <span class="title">on</span> <span class="title">win32</span></span></span><br><span class="line"><span class="function"><span class="title">Type</span> "<span class="title">help</span>", "<span class="title">copyright</span>", "<span class="title">credits</span>" <span class="title">or</span> "<span class="title">license</span>" <span class="title">for</span> <span class="title">more</span> <span class="title">information</span>.</span></span><br><span class="line"><span class="function">(<span class="title">InteractiveConsole</span>)</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">from</span> <span class="title">polls.models</span> <span class="title">import</span> <span class="title">Choice</span>, <span class="title">Question</span></span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.all</span>()</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> []&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">from</span> <span class="title">django.utils</span> <span class="title">import</span> <span class="title">timezone</span></span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q</span> = <span class="title">Question</span>(<span class="title">question_text</span>="<span class="title">What</span>'<span class="title">s</span> <span class="title">new</span>?", <span class="title">pub_date</span>=<span class="title">timezone.now</span>())</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.save</span>()</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.id</span></span></span><br><span class="line"><span class="function">1</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.question_text</span></span></span><br><span class="line"><span class="function">"<span class="title">What</span>'<span class="title">s</span> <span class="title">new</span>?"</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.pub_date</span></span></span><br><span class="line"><span class="function"><span class="title">datetime.datetime</span>(2019, 1, 4, 9, 10, 1, 955820, <span class="title">tzinfo</span>=&lt;<span class="title">UTC</span>&gt;)</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.question_text</span> = "<span class="title">What</span>'<span class="title">s</span> <span class="title">up</span>?"</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.save</span>()</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.all</span>()</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> [&lt;<span class="title">Question</span>: <span class="title">Question</span> <span class="title">object</span> (1)&gt;]&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面命令行执行结果中的<code>&lt;Question: Question object (1)&gt;</code>对于实际开发没有意义，因此可以考虑为上面建立的 Django 模型增加<code>__str__()</code>方法直接打印模型对象的属性数据。为了便于进一步测试，这里还为<code>Question</code>类添加一个自定义的<code>was_published_recently()</code>方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line">    <span class="comment"># 自定义was_published_recently()方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.pub_date &gt;= timezone.now() - datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 添加__str__()方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.question_text</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 添加__str__()方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.choice_text</span><br></pre></td></tr></table></figure>
<p>完成修改工作之后，再一次运行<code>python manage.py shell</code>命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">shell</span></span></span><br><span class="line"><span class="function"><span class="title">Python</span> 3.6.6 (<span class="title">v3</span>.6.6:4<span class="title">cf1f54eb7</span>, <span class="title">Jun</span> 27 2018, 03:37:03) [<span class="title">MSC</span> <span class="title">v</span>.1900 64 <span class="title">bit</span> (<span class="title">AMD64</span>)] <span class="title">on</span> <span class="title">win32</span></span></span><br><span class="line"><span class="function"><span class="title">Type</span> "<span class="title">help</span>", "<span class="title">copyright</span>", "<span class="title">credits</span>" <span class="title">or</span> "<span class="title">license</span>" <span class="title">for</span> <span class="title">more</span> <span class="title">information</span>.</span></span><br><span class="line"><span class="function">(<span class="title">InteractiveConsole</span>)</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">from</span> <span class="title">polls.models</span> <span class="title">import</span> <span class="title">Choice</span>, <span class="title">Question</span></span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.all</span>()</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> [&lt;<span class="title">Question</span>: <span class="title">What</span>'<span class="title">s</span> <span class="title">up</span>?&gt;]&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.filter</span>(<span class="title">id</span>=1)</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> [&lt;<span class="title">Question</span>: <span class="title">What</span>'<span class="title">s</span> <span class="title">up</span>?&gt;]&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.filter</span>(<span class="title">question_text__startswith</span>='<span class="title">What</span>')</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> [&lt;<span class="title">Question</span>: <span class="title">What</span>'<span class="title">s</span> <span class="title">up</span>?&gt;]&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">from</span> <span class="title">django.utils</span> <span class="title">import</span> <span class="title">timezone</span></span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">current_year</span> = <span class="title">timezone.now</span>().<span class="title">year</span></span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.get</span>(<span class="title">pub_date__year</span>=<span class="title">current_year</span>)</span></span><br><span class="line"><span class="function">&lt;<span class="title">Question</span>: <span class="title">What</span>'<span class="title">s</span> <span class="title">up</span>?&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.get</span>(<span class="title">id</span>=2)</span></span><br><span class="line"><span class="function"><span class="title">Traceback</span> (<span class="title">most</span> <span class="title">recent</span> <span class="title">call</span> <span class="title">last</span>):</span></span><br><span class="line"><span class="function">  <span class="title">File</span> "&lt;<span class="title">console</span>&gt;", <span class="title">line</span> 1, <span class="title">in</span> &lt;<span class="title">module</span>&gt;</span></span><br><span class="line"><span class="function">  <span class="title">File</span> "<span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">venv</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span>\<span class="title">django</span>\<span class="title">db</span>\<span class="title">models</span>\<span class="title">manager.py</span>", <span class="title">line</span> 82, <span class="title">in</span> <span class="title">manager_method</span></span></span><br><span class="line"><span class="function">    <span class="title">return</span> <span class="title">getattr</span>(<span class="title">self.get_queryset</span>(), <span class="title">name</span>)(*<span class="title">args</span>, **<span class="title">kwargs</span>)</span></span><br><span class="line"><span class="function">  <span class="title">File</span> "<span class="title">C</span>:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">venv</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span>\<span class="title">django</span>\<span class="title">db</span>\<span class="title">models</span>\<span class="title">query.py</span>", <span class="title">line</span> 399, <span class="title">in</span> <span class="title">get</span></span></span><br><span class="line"><span class="function">    <span class="title">self.model._meta.object_name</span></span></span><br><span class="line"><span class="function"><span class="title">polls.models.Question.DoesNotExist</span>: <span class="title">Question</span> <span class="title">matching</span> <span class="title">query</span> <span class="title">does</span> <span class="title">not</span> <span class="title">exist</span>.</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Question.objects.get</span>(<span class="title">pk</span>=1)</span></span><br><span class="line"><span class="function">&lt;<span class="title">Question</span>: <span class="title">What</span>'<span class="title">s</span> <span class="title">up</span>?&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q</span> = <span class="title">Question.objects.get</span>(<span class="title">pk</span>=1)</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.was_published_recently</span>()</span></span><br><span class="line"><span class="function"><span class="title">True</span></span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q</span> = <span class="title">Question.objects.get</span>(<span class="title">pk</span>=1)</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.choice_set.all</span>()</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> []&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.choice_set.create</span>(<span class="title">choice_text</span>='<span class="title">Not</span> <span class="title">much</span>', <span class="title">votes</span>=0)</span></span><br><span class="line"><span class="function">&lt;<span class="title">Choice</span>: <span class="title">Not</span> <span class="title">much</span>&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.choice_set.create</span>(<span class="title">choice_text</span>='<span class="title">The</span> <span class="title">sky</span>', <span class="title">votes</span>=0)</span></span><br><span class="line"><span class="function">&lt;<span class="title">Choice</span>: <span class="title">The</span> <span class="title">sky</span>&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">c</span> = <span class="title">q.choice_set.create</span>(<span class="title">choice_text</span>='<span class="title">Just</span> <span class="title">hacking</span> <span class="title">again</span>', <span class="title">votes</span>=0)</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">c.question</span></span></span><br><span class="line"><span class="function">&lt;<span class="title">Question</span>: <span class="title">What</span>'<span class="title">s</span> <span class="title">up</span>?&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.choice_set.all</span>()</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> [&lt;<span class="title">Choice</span>: <span class="title">Not</span> <span class="title">much</span>&gt;, &lt;<span class="title">Choice</span>: <span class="title">The</span> <span class="title">sky</span>&gt;, &lt;<span class="title">Choice</span>: <span class="title">Just</span> <span class="title">hacking</span> <span class="title">again</span>&gt;]&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">q.choice_set.count</span>()</span></span><br><span class="line"><span class="function">3</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">Choice.objects.filter</span>(<span class="title">question__pub_date__year</span>=<span class="title">current_year</span>)</span></span><br><span class="line"><span class="function">&lt;<span class="title">QuerySet</span> [&lt;<span class="title">Choice</span>: <span class="title">Not</span> <span class="title">much</span>&gt;, &lt;<span class="title">Choice</span>: <span class="title">The</span> <span class="title">sky</span>&gt;, &lt;<span class="title">Choice</span>: <span class="title">Just</span> <span class="title">hacking</span> <span class="title">again</span>&gt;]&gt;</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">c</span> = <span class="title">q.choice_set.filter</span>(<span class="title">choice_text__startswith</span>='<span class="title">Just</span> <span class="title">hacking</span>')</span></span><br><span class="line"><span class="function">&gt;&gt;&gt; <span class="title">c.delete</span>()</span></span><br><span class="line"><span class="function">(1, &#123;'<span class="title">polls.Choice</span>': 1&#125;)</span></span><br></pre></td></tr></table></figure>
<h1 id="管理站点">管理站点</h1>
<p>Django 能够根据模型自动创建后台管理界面， 这里我们执行<code>manage.py</code>提供的<code>createsuperuser</code>命令创建一个管理用户：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">django</span>\<span class="title">mysite</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">createsuperuser</span></span></span><br><span class="line"><span class="function"><span class="title">Username</span> (<span class="title">leave</span> <span class="title">blank</span> <span class="title">to</span> <span class="title">use</span> '<span class="title">zhenghang</span>'): <span class="title">hank</span></span></span><br><span class="line"><span class="function"><span class="title">Email</span> <span class="title">address</span>: <span class="title">uinika</span>@<span class="title">outlook.com</span></span></span><br><span class="line"><span class="function"><span class="title">Password</span>: ********</span></span><br><span class="line"><span class="function"><span class="title">Password</span> (<span class="title">again</span>): ********</span></span><br><span class="line"><span class="function"><span class="title">Superuser</span> <span class="title">created</span> <span class="title">successfully</span>.</span></span><br></pre></td></tr></table></figure>
<p>启动 Django 服务之后，就可以通过 URL 地址<code>http://localhost:8080/admin/login</code>并使用上面新建的用户名和密码进行登陆管理操作：</p>
<p><img src="/Web/Django/django-admin.png"></p>
<p>登陆后默认只能对权限相关的<code>User</code>和<code>Group</code>进行管理，如果我们需要将<code>Question</code>数据模型纳入管理，那么必须要在<code>polls/admin.py</code>文件对其进行注册。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure>
<p>完成注册之后，刷新管理站点页面即可查看到<code>Question</code>管理选项：</p>
<p><img src="/Web/Django/django-admin-update.png"></p>
<h1 id="视图与模板">视图与模板</h1>
<h2 id="pollsviews.py-1">polls/views.py</h2>
<p>Django 使用<code>URLconfs</code>配置将 URL 与视图关联，即将 URL 映射至视图，下面我们将向<code>polls/views.py</code>文件添加一些能够接收参数的视图：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"你好，这是一个投票应用！"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"你正在查看问题 %s 。"</span> % question_id)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    response = <span class="string">"你看到的是问题 %s 的结果。"</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(response % question_id)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"你正在对问题 %s 进行投票。"</span> % question_id)</span><br></pre></td></tr></table></figure>
<h2 id="polls.urls">polls.urls</h2>
<p>然后将这些新的视图添加至<code>polls.urls</code>模块：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 访问 http://localhost:8080/polls/</span></span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">    <span class="comment"># 访问 http://localhost:8080/polls/5/</span></span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/'</span>, views.detail, name=<span class="string">'detail'</span>),</span><br><span class="line">    <span class="comment"># 访问 http://localhost:8080/polls/5/results/</span></span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/results/'</span>, views.results, name=<span class="string">'results'</span>),</span><br><span class="line">    <span class="comment"># 访问 http://localhost:8080/polls/5/vote/</span></span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="修改-pollsviews.py">修改 polls/views.py</h2>
<p>Django 的每个视图只会完成两个任务：返回一个包含被请求页面内容的<code>HttpResponse</code>对象，或是抛出一个<code>Http404</code>这样的异常。这里为了展示数据库里按照发布日期排序的最近五个投票问题，我们再向<code>polls/views.py</code>代码文件的<code>index()</code>函数添加如下内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    output = <span class="string">', '</span>.join([q.question_text <span class="keyword">for</span> q <span class="keyword">in</span> latest_question_list])</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(output)</span><br></pre></td></tr></table></figure>
<h2 id="添加-templates-模板目录">添加 templates 模板目录</h2>
<p>这样直接将数据库查询结果输出到页面的方式并不优雅，实际开发环境当中我们通常会使用模板页面来展示数据，首先在<code>polls</code>应用目录下创建一个用来存放模板文件的<code>templates</code>目录。由于站点配置文件<code>mysite/settings.py</code>里<code>TEMPLATES</code>属性的默认设置，能够让 Django 在每个<code>INSTALLED_APPS</code>文件夹中自动寻找<code>templates</code>子目录，从而正确定位出模板的位置。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</span><br><span class="line">        <span class="string">'DIRS'</span>: [],</span><br><span class="line">        <span class="string">'APP_DIRS'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'context_processors'</span>: [</span><br><span class="line">                <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</span><br><span class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>接下来继续在<code>templates</code>下面新建一个<code>polls</code>目录，然后在里边放置一个<code>index.html</code>文件，此时通过 URL 地址<code>http://localhost:8080/polls/</code>就可以访问到这个模板文件，模板文件会将按照发布日期排序了的<code>Question</code>列表<code>latest_question_list</code>放置到<code>HttpResponse</code>上下文，并在<code>polls/index.html</code>模板当中完成数据绑定。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    template = loader.get_template(<span class="string">'polls/index.html'</span>)</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'latest_question_list'</span>: latest_question_list,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.render(context, request))</span><br></pre></td></tr></table></figure>
<h2 id="render快捷方法">render()快捷方法</h2>
<p>事实上，通过使用<code>render()</code>方法，Django 能够以更加简化的方式完成载入模板、填充上下文、返回 HttpResponse 对象这一系列步骤：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    context = &#123;<span class="string">'latest_question_list'</span>: latest_question_list&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/index.html'</span>, context)</span><br></pre></td></tr></table></figure>
<h2 id="http404-处理">Http404 处理</h2>
<p>接下来处理投票详情页面，这里会有一个新原则，即如果指定<code>ID</code>所对应的<code>Question</code>不存在，那么视图就会抛出一个<code>Http404</code>异常。在<code>polls/views.py</code>添加如下代码，</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        question = Question.objects.get(pk=question_id)</span><br><span class="line">    <span class="keyword">except</span> Question.DoesNotExist:</span><br><span class="line">        <span class="keyword">raise</span> Http404(<span class="string">"问题不存在！"</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: qu</span><br></pre></td></tr></table></figure>
<p>然后暂时向<code>polls/templates/polls/detail.html</code>添加一行简单的<code></code>代码便于测试上面的代码。</p>
<p>Django 提供了诸如<code>get_object_or_404()</code>、<code>get_list_or_404()</code>这样的快捷函数语法糖来解决<code>Http404</code>判断的问题，因而上一步的代码依然可以进一步简化为下面这样：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> get_object_or_404, render</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="templatespollsdetail.html">templates/polls/detail.html</h2>
<p>让我们进一步完善<code>polls/templates/polls/detail.html</code>，填充完整的视图代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过在模板代码中使用<code>.</code>符号来访问变量属性，例如对于上面代码中的<code></code>， Django 首先会尝试对<code>question</code>对象使用<strong>字典查找</strong>（既<code>obj.get(str)</code>），如果失败再尝试<strong>属性查找</strong>（既<code>obj.str</code>），如果依然失败就会尝试<strong>列表查找</strong>（即<code>obj[int]</code>）。另外循环<code>for</code>中的<code>question.choice_set.all</code>语句会被解析为<code>question.choice_set.all()</code>的 Python 的函数调用，完成后将返回一个可迭代的<code>Choice</code>对象，该对象仅限于<code>for</code>循环标签内部使用。</p>
<p>在<code>polls/templates/polls/index.html</code>编写的投票链接里使用了诸如<code>&lt;a href="/polls//"&gt;&lt;/a&gt;</code>这样的硬编码，但是这样容易造成视图与后端业务的耦合，因此 Django 提供了<code>url</code>标签来解决这个问题。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'detail' question.id %&#125;"</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>事实上，在<code>mysite/polls/urls.py</code>里的<code>path('&lt;int:question_id&gt;/', views.detail, name='detail')</code>函数调用当中，<code>path()</code>的<code>name</code>属性就是作用于<code>url</code>标签中的这个特性的。</p>
</blockquote>
<h2 id="url-命名空间">URL 命名空间</h2>
<p>为了避免项目当中各个应用的 URL 重名，导致<code>url</code>标签在使用时产生歧义，需要在<code>polls/urls.py</code>上添加应用的命名空间作为区分。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'polls'</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/'</span>, views.detail, name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/results/'</span>, views.results, name=<span class="string">'results'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>然后编辑<code>polls/templates/polls/index.html</code>文件，为每个<code>url</code>标签添加上面声明的<code>polls:</code>命名空间。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'polls:detail' question.id %&#125;"</span></span></span><br><span class="line"><span class="tag">    &gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="表单和通用视图">表单和通用视图</h1>
<p>首先为投票详细页面<code>polls/detail.html</code>添加一个<code>&lt;form&gt;</code>表单。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% if error_message %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123; error_message &#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"&#123;% url 'polls:vote' question.id %&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  &#123;% csrf_token %&#125; &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">"radio"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">"choice"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">id</span>=<span class="string">"choice&#123;&#123; forloop.counter &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">value</span>=<span class="string">"&#123;&#123; choice.id &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"choice&#123;&#123; forloop.counter &#125;&#125;"</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125;<span class="tag">&lt;/<span class="name">label</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  &#123;% endfor %&#125; <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Vote"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，除了前端模板常用的<code>for</code>循环标签，还使用了<code>csrf_token</code>标签来防止跨站点请求伪造，建议所有针对内部 URL 的 POST 表单都应该使用它。另外，代码中的表达式<code>forloop.counter</code>用来指示<code>for</code>标签的执行次数。</p>
<p>接下来，创建一个 Django 视图来处理上面表单提交的数据，在上一步当中，我们在<code>polls/urls.py</code>里创建的<code>URLconf</code>如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'polls'</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># ... ...</span></span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br><span class="line">    <span class="comment"># ... ...</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>这里我们需要处理对应的<code>vote()</code>的函数，下面代码中通过<code>request.POST['choice']</code>以字符串形式返回选择的<code>Choice</code>的<code>ID</code>（<em><code>request.POST</code>的值永远是字符串</em>）。如果<code>request.POST['choice']</code>中不存在<code>choice</code>，将会引发一个<code>KeyError</code>， 下面代码通过异常检查机制来处理<code>KeyError</code>，如果<code>choice</code>不存在将会重新显示<code>Question</code>表单以及一个错误提示信息。选择并且投票成功之后，<code>Choice</code>的得票数会自增<code>1</code>，同时通过返回<code>HttpResponseRedirect</code>重定向到指定的<code>URL</code>。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> get_object_or_404, render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Choice, Question</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        selected_choice = question.choice_set.get(pk=request.POST[<span class="string">'choice'</span>])</span><br><span class="line">    <span class="keyword">except</span> (KeyError, Choice.DoesNotExist):</span><br><span class="line">        <span class="comment"># 重新显示问题的投票表单。</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;</span><br><span class="line">            <span class="string">'question'</span>: question,</span><br><span class="line">            <span class="string">'error_message'</span>: <span class="string">"你没有进行选择！"</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        selected_choice.votes += <span class="number">1</span></span><br><span class="line">        selected_choice.save()</span><br><span class="line">        <span class="comment"># 请求成功后总是返回一个HttpResponseRedirect，这样可以防止用户点击返回按钮后表单被再次发送。</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">'polls:results'</span>, args=(question.id,)))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<code>HttpResponseRedirect()</code>函数中使用了一个<code>reverse()</code>函数，该函数可以根据<code>URLconf</code>生成相应的<code>URL</code>，从而避免了在视图函数中硬编码，这里<code>reverse()</code>函数的返回结果为<code>'/polls/1/results/'</code>。</p>
</blockquote>
<p><img src="/Web/Django/form.gif"></p>
<p>当完成对<code>Question</code>的投票操作之后，<code>vote()</code>视图会将请求重定向到一个结果视图<code>results()</code>，继续修改<code>polls/views.py</code>中的<code>results()</code>函数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> get_object_or_404, render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/results.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure>
<p>然后添加视图对应的模板页面<code>polls/templates/polls/results.html</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;&#123; choice.choice_text &#125;&#125; -- &#123;&#123; choice.votes &#125;&#125; vote&#123;&#123; choice.votes |</span><br><span class="line">    pluralize &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'polls:detail' question.id %&#125;"</span>&gt;</span>再次投票？<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/Web/Django/form-result.gif"></p>
<h1 id="通用视图">通用视图</h1>
<p>正如前面一系列代码所展示的那样，根据 URL 中的参数从数据库中获取数据、载入模板文件然后返回渲染后的模板，这是 Web 开发当中常见的情况，Django 将这个过程抽象为一套<strong>通用视图</strong>的快捷方法，下面我们将基于<strong>通用视图</strong>来进行修改。</p>
<p>改进前的 URLconf：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'polls'</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/'</span>, views.detail, name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/results/'</span>, views.results, name=<span class="string">'results'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>改进后的 URLconf：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'polls'</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.IndexView.as_view(), name=<span class="string">'index'</span>),</span><br><span class="line">    <span class="comment"># 注意：路径字符串中匹配模式的名称由&lt;question_id&gt;修改为&lt;pk&gt;。</span></span><br><span class="line">    path(<span class="string">'&lt;int:pk&gt;/'</span>, views.DetailView.as_view(), name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:pk&gt;/results/'</span>, views.ResultsView.as_view(), name=<span class="string">'results'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>改进前的<code>polls/views.py</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> get_object_or_404, render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Choice, Question</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    context = &#123;<span class="string">'latest_question_list'</span>: latest_question_list&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/index.html'</span>, context)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/results.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        selected_choice = question.choice_set.get(pk=request.POST[<span class="string">'choice'</span>])</span><br><span class="line">    <span class="keyword">except</span> (KeyError, Choice.DoesNotExist):</span><br><span class="line">        <span class="comment"># 重新显示问题的投票表单。</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;</span><br><span class="line">            <span class="string">'question'</span>: question,</span><br><span class="line">            <span class="string">'error_message'</span>: <span class="string">"你没有进行选择！"</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        selected_choice.votes += <span class="number">1</span></span><br><span class="line">        selected_choice.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">'polls:results'</span>, args=(question.id,)))</span><br></pre></td></tr></table></figure>
<p>改进后的<code>polls/views.py</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> get_object_or_404, render</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> generic</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Choice, Question</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span><span class="params">(generic.ListView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'polls/index.html'</span></span><br><span class="line">    context_object_name = <span class="string">'latest_question_list'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""" 返回最近发布的5个问题。 """</span></span><br><span class="line">        <span class="keyword">return</span> Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailView</span><span class="params">(generic.DetailView)</span>:</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">'polls/detail.html'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultsView</span><span class="params">(generic.DetailView)</span>:</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">'polls/results.html'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="string">''' vote()函数定义同上 '''</span></span><br></pre></td></tr></table></figure>
<p>这份代码中，使用了<code>ListView</code>（<em>显示一个对象的列表</em>）和<code>DetailView</code>（<em>显示一个指定对象的详细信息</em>）两个通用视图。</p>
<p>通用视图<code>DetailView</code>期望从 URL 获取名为<code>pk</code>的主键值，所以上述代码将<code>question_id</code>改为<code>pk</code>。默认情况下<code>DetailView</code>会使用路径为<code>&lt;app name&gt;/&lt;model name&gt;_detail.html</code>的模板，通过<code>template_name</code>属性可以指定自定义的模板来进行渲染。</p>
<p>通用视图<code>ListView</code>同样使用<code>&lt;app name&gt;/&lt;model name&gt;_list.html</code>作为默认模板，因此代码中也通过<code>template_name</code>属性告诉<code>ListView</code>使用已经创建好了的<code>polls/index.html</code>作为模板。在前面章节当中，与视图模板一起使用的，还有一个包含有<code>question</code>和<code>latest_question_list</code>变量的<code>context</code>，而<code>ListView</code>当中，提供了一个<code>context_object_name</code>快捷属性，可以显式指定当前需要使用的 Context 上下文变量是<code>latest_question_list</code>。</p>
<p>好了，到目前为止<strong>问题投票应用 polls</strong>的功能已经大功告成，接下来的章节会讲解一些附加功能以及相关的第三方扩展的使用。</p>
<h1 id="测试">测试</h1>
<h1 id="静态文件">静态文件</h1>
<p>Web 应用中的 CSS、图片、JavaScript 通常需要放置在一个静态目录当中，Django 通过<code>mysite/settings.py</code>中的<code>'django.contrib.staticfiles'</code>应用提供了相关支持，默认情况下，该应用会自动在应用目录（<em>比如<code>polls</code></em>）下的<code>static</code>目录查询静态文件。在进行下一步操作之前，请先按照如下的目录结构来建立文件。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">jungle</span>\<span class="title">mysite</span>\<span class="title">polls</span>\<span class="title">static</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">tree</span> /<span class="title">f</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:.</span></span><br><span class="line"><span class="function">└─<span class="title">polls</span></span></span><br><span class="line"><span class="function">  │ <span class="title">style.css</span></span></span><br><span class="line"><span class="function">  └─<span class="title">images</span></span></span><br><span class="line"><span class="function">    └─<span class="title">background.jpg</span></span></span><br></pre></td></tr></table></figure>
<h2 id="staticpollsstyle.css">static/polls/style.css</h2>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">"images/background.jpg"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="templatepollsindex.html">template/polls/index.html</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text/css"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">"&#123;% static 'polls/style.css' %&#125;"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;% if latest_question_list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      &#123;% for question in latest_question_list %&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'polls:detail' question.id %&#125;"</span></span></span><br><span class="line"><span class="tag">          &gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>No polls are available.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125; &#123;% load static %&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="自定义管理站点">自定义管理站点</h1>
<h1 id="如何编写可复用的-web-应用">如何编写可复用的 Web 应用</h1>
<h1 id="执行原生-sql">执行原生 SQL</h1>
<p>Django 提供了 2 种执行原生查询的方式：一种是使用<code>Manager.raw()</code>执行查询并返回一个<code>Model</code>实例，另一种是完全避开<code>Model</code>层，直接执行自定义的 SQL 语句。</p>
<h2 id="执行原生查询">执行原生查询</h2>
<p>Django 提供了<code>raw()</code>管理器方法来执行一个原生 SQL 语句，并且返回一个<code>django.db.models.query.RawQuerySet</code>实例，该实例可以像普通 QuerySet 一样进行迭代，从而提供<code>Model</code>对象的实例。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Manager.raw(raw_query, params=<span class="literal">None</span>, translations=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<p>首先，编写一名称为<code>Person</code>的 Model：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    first_name = models.CharField()</span><br><span class="line">    last_name = models.CharField()</span><br></pre></td></tr></table></figure>
<p>然后，在该 Model 上调用<code>row()</code>方法执行 SQL 语句：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> person <span class="keyword">in</span> Person.objects.raw(<span class="string">'SELECT * FROM myapp_person'</span>):</span><br><span class="line">    print(person)</span><br></pre></td></tr></table></figure>
<p>也可以在<code>row()</code>方法中指定需要查询的列：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person.objects.raw(<span class="string">'SELECT id, first_name, last_name FROM myapp_person'</span>)</span><br></pre></td></tr></table></figure>
<p>遇到 Model 属性名与列名不匹配的情况，可以使用<code>AS</code>子句手动进行映射：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Person.objects.raw(<span class="string">'''SELECT pk    AS id,</span></span><br><span class="line"><span class="string">                             first AS first_name,</span></span><br><span class="line"><span class="string">                             last  AS last_name,</span></span><br><span class="line"><span class="string">                      FROM myapp_person'''</span>)</span><br></pre></td></tr></table></figure>
<p>也可以使用<code>raw()</code>方法的<code>translations</code>参数来完成映射工作，该参数是一个包含了数据库字段到 Model 属性映射的字典：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name_map = &#123;<span class="string">'pk'</span>: <span class="string">'id'</span>, <span class="string">'first'</span>: <span class="string">'first_name'</span>, <span class="string">'last'</span>: <span class="string">'last_name'</span>&#125;</span><br><span class="line">Person.objects.raw(<span class="string">'SELECT * FROM myapp_person'</span>, translations=name_map)</span><br></pre></td></tr></table></figure>
<p><code>raw()</code>方法支持索引，如果只需要第 1 条结果，可以像下面这样编写代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">first_person = Person.objects.raw(<span class="string">'SELECT * FROM myapp_person'</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>然而，索引和切片并不在数据库级别上执行，如果数据量较大，直接在 SQL 级别上进行限制查询将会获得更佳的性能：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">first_person = Person.objects.raw(<span class="string">'SELECT * FROM myapp_person LIMIT 1'</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p><code>row()</code>方法查询返回的<code>Person</code>对象将是<code>deferred</code>模型实例，这意味着查询中省略的字段将会按需加载，例如:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> person <span class="keyword">in</span> Person.objects.raw(<span class="string">'SELECT id, first_name FROM myapp_person'</span>):</span><br><span class="line">    print(person.first_name,  <span class="comment"># 由原始查询检索</span></span><br><span class="line">          person.last_name)   <span class="comment"># 按需检索</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于 Django 使用主键来标识模型实例，原始查询中必须包含主键字段，忽略主键字段将会引发<code>InvalidQuery</code>异常。</p>
</blockquote>
<p>假如在定义 Model 时添加了一个<code>birth_dat</code>属性来保存生日数据，那么就可以借用 PostgreSQL 提供的<code>age()</code>方法来根据出生日期计算年龄：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">persons = Person.objects.raw(<span class="string">'SELECT *, age(birth_date) AS age FROM myapp_person'</span>)</span><br><span class="line">    <span class="keyword">for</span> person <span class="keyword">in</span> persons:</span><br><span class="line">    print(<span class="string">"%s 已经 %s 岁了！"</span> % (person.first_name, person.age)) <span class="comment"># Hank 已经 18 岁了！</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>实际开发环境下，可以通过<a href="https://docs.djangoproject.com/zh-hans/2.1/ref/models/expressions/#func-expressions" target="_blank" rel="noopener"><code>Func()表达式</code></a>来避免使用原始 SQL 计算注解。</p>
</blockquote>
<p>如果需要使用带参数的查询，那么可以向<code>raw()</code>方法传递<code>params</code>参数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">'Hank'</span></span><br><span class="line">Person.objects.raw(<span class="string">'SELECT * FROM myapp_person WHERE last_name = %s'</span>, [name])</span><br></pre></td></tr></table></figure>
<p><code>params</code>参数可以是一个列表或者字典，相应的查询参数在 SQL 中的占位符可以是<code>%s</code>或者<code>%(key)s</code>。<strong>但是需要注意 SQLite 不支持字典参数，因此须将参数作为列表传递</strong>。</p>
<blockquote>
<p>不要在原始查询或占位符上使用<strong>格式化字符串</strong>，因为这样会引发 SQL 注入漏洞。</p>
</blockquote>
<h2 id="直接运行自定义-sql">直接运行自定义 SQL</h2>
<p>如果认为<code>Manager.raw()</code>还不够灵活，或者不需要将查询结果映射到<code>Model</code>，那么可以通过<code>django.db.connection</code>去使用默认的数据库连接，例如调用<code>connection.cursor()</code>去获取指针对象，调用<code>cursor.execute(sql, [params])</code>去执行 SQL，调用<code>cursor.fetchone()</code>或<code>cursor.fetchall()</code>去返回结果集。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_custom_sql</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">        cursor.execute(<span class="string">"UPDATE bar SET foo = 1 WHERE baz = %s"</span>, [self.baz])</span><br><span class="line">        cursor.execute(<span class="string">"SELECT foo FROM bar WHERE baz = %s"</span>, [self.baz])</span><br><span class="line">        row = cursor.fetchone()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> row</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为了避免数据库注入攻击，必须禁止在<code>%s</code>周围使用引号。</p>
</blockquote>
<p>注意，如果需要在查询中包含文字百分比符号，那么传递参数时必须将重复书写它们为<code>%%</code>:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">"SELECT foo FROM bar WHERE baz = '30%'"</span>)</span><br><span class="line">cursor.execute(<span class="string">"SELECT foo FROM bar WHERE baz = '30%%' AND id = %s"</span>, [self.id])</span><br></pre></td></tr></table></figure>
<p>在使用多个数据库的时候，可以使用<code>django.db.connections</code>去获得数据库的连接和游标，<code>django.db.connections</code>是一个允许使用别名查询指定数据库连接的字典对象。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connections</span><br><span class="line"><span class="keyword">with</span> connections[<span class="string">'my_db_alias'</span>].cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">    <span class="comment"># 自定义代码</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，Python 数据库 API 会返回没有字段名称的列表，而非一个字典。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dictfetchall</span><span class="params">(cursor)</span>:</span></span><br><span class="line">    <span class="string">"以字典方式从一个游标返回所有行"</span></span><br><span class="line">    columns = [col[<span class="number">0</span>] <span class="keyword">for</span> col <span class="keyword">in</span> cursor.description]</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        dict(zip(columns, row))</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall()</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<p>另一个选择是使用 Python 标准库中的<code>collections.namedtuple()</code>，一个<code>namedtuple</code>是一个类似元组的对象，可以通过属性去访问字段，同样支持索引与迭代，其结果是不可变的。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">namedtuplefetchall</span><span class="params">(cursor)</span>:</span></span><br><span class="line">    <span class="string">"以元组方式从一个游标返回所有行"</span></span><br><span class="line">    desc = cursor.description</span><br><span class="line">    nt_result = namedtuple(<span class="string">'Result'</span>, [col[<span class="number">0</span>] <span class="keyword">for</span> col <span class="keyword">in</span> desc])</span><br><span class="line">    <span class="keyword">return</span> [nt_result(*row) <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall()]</span><br></pre></td></tr></table></figure>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; cursor.execute("SELECT id, parent_id FROM test LIMIT <span class="number">2</span>");</span><br><span class="line">&gt;&gt;&gt; cursor.fetchall()</span><br><span class="line">((<span class="number">54360982</span>, None), (<span class="number">54360880</span>, None))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; cursor.execute("SELECT id, parent_id FROM test LIMIT <span class="number">2</span>");</span><br><span class="line">&gt;&gt;&gt; dictfetchall(cursor)</span><br><span class="line">[&#123;'parent_id': None, 'id': <span class="number">54360982</span>&#125;, &#123;'parent_id': None, 'id': <span class="number">54360880</span>&#125;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; cursor.execute("SELECT id, parent_id FROM test LIMIT <span class="number">2</span>");</span><br><span class="line">&gt;&gt;&gt; results = namedtuplefetchall(cursor)</span><br><span class="line">&gt;&gt;&gt; results</span><br><span class="line">[Result(id=<span class="number">54360982</span>, parent_id=None), Result(id=<span class="number">54360880</span>, parent_id=None)]</span><br><span class="line">&gt;&gt;&gt; results[<span class="number">0</span>].id</span><br><span class="line"><span class="number">54360982</span></span><br><span class="line">&gt;&gt;&gt; results[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="number">54360982</span></span><br></pre></td></tr></table></figure>
<h3 id="数据库连接与游标">数据库连接与游标</h3>
<p>Django 的<code>connection</code>和<code>cursor</code>实现了除事务处理外的大部份 Python 数据库 API。如果不熟悉 Python 数据库 API，需要注意<code>cursor.execute()</code>中的 SQL 语句使用了占位符<code>%s</code>，而非直接在 SQL 语句中添加参数，这种技术会在底层按需转译相应参数。</p>
<blockquote>
<p>需要注意 Django 使用的占位符是<code>%s</code>，而非 Python 自带 SQLite 绑定的占位符<code>?</code>。</p>
</blockquote>
<p>使用游标作<code>cursor</code>为上下文管理器：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> c:</span><br><span class="line">    c.execute(...)</span><br></pre></td></tr></table></figure>
<p>等同于：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c = connection.cursor()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    c.execute(...)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    c.close()</span><br></pre></td></tr></table></figure>
<h3 id="存储过程调用">存储过程调用</h3>
<p>可以通过输入<code>params</code>序列或者<code>kparams</code>字典参数去调用具有特定名称的数据库存储过程（<em>仅有 Oracle 支持<code>kparams</code></em>）。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CursorWrapper.callproc(procname, params=<span class="literal">None</span>, kparams=<span class="literal">None</span>)¶</span><br></pre></td></tr></table></figure>
<p>例如对于 Oracle 中给定的存储过程：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">"TEST_PROCEDURE"</span>(v_i <span class="built_in">INTEGER</span>, v_text <span class="keyword">NVARCHAR2</span>(<span class="number">10</span>)) <span class="keyword">AS</span></span><br><span class="line">    p_i <span class="built_in">INTEGER</span>;</span><br><span class="line">    p_text NVARCHAR2(10);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    p_i := v_i;</span><br><span class="line">    p_text := v_text;</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>那么在 Django 中可以这样调用它：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">    cursor.callproc(<span class="string">'test_procedure'</span>, [<span class="number">1</span>, <span class="string">'test'</span>])</span><br></pre></td></tr></table></figure>
<h1 id="django-rest-framework">Django REST framework</h1>
<p>Django REST framework 是一款用来构建强大灵活 API 的工具包，支持 OAuth1a 和 OAuth2 身份验证策略，并且生成可以通过 Web 浏览器进行可视化访问的 API，以及同时支持 ORM 和非 ORM 两种数据源的序列化。</p>
<p><img src="/Web/Django/rest-logo.png"></p>
<p>本文所使用的 Django REST framework 版本为 3.9.0，支持当前最新版的 Python3.7 以及 Django 2.1，并同时兼容 Python2.x 和 Django1.x；除此之外，Django REST framework 还支持如下可选的扩展包：</p>
<ul>
<li>coreapi (1.32.0+) - Schema 生成支持。</li>
<li>Markdown (2.1.0+) - 为浏览器 API 添加 Markdown 支持。</li>
<li>django-filter (1.0.1+) - 过滤器支持。</li>
<li>django-crispy-forms - 针对过滤器的增强 HTML 显示。</li>
<li>django-guardian (1.1.1+) - Object 级别的权限支持。</li>
</ul>
<p>接下下来，可以像下面这样安装可选的支持包以及<code>djangorestframework</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework</span><br><span class="line">pip install markdown       <span class="comment"># 可选</span></span><br><span class="line">pip install django-filter  <span class="comment"># 可选</span></span><br></pre></td></tr></table></figure>
<p>然后在站点设置里添加如下支持：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = (</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'rest_framework'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>如果尝试使用可浏览的 API，开发人员可能也需要添加 REST 框架的登入登出页面，添加如下代码到你的<code>urls.py</code>文件。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(<span class="string">r'^api-auth/'</span>, include(<span class="string">'rest_framework.urls'</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="快速开始">快速开始</h2>
<p>接下来我们建立一个简单的 API，用来查看和编辑 Django 管理站点当中默认的<code>users</code>和<code>groups</code>数据模型。</p>
<h3 id="项目设置">项目设置</h3>
<p>复用前面章节内容中建立的<a href="https://github.com/uinika/jungle" target="_blank" rel="noopener">jungle</a>项目脚手架，激活虚拟环境后，建立名为<code>tutorial</code>的 Django 项目，然后启动一个<code>quickstart</code>应用。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line">&gt; pip install djangorestframework</span><br><span class="line"></span><br><span class="line"># 建立一个Django项目</span><br><span class="line">&gt; django-admin startproject tutorial</span><br><span class="line"></span><br><span class="line"># 建立应用</span><br><span class="line">&gt; <span class="built_in">cd</span> tutorial</span><br><span class="line">&gt; django-admin startapp quickstart</span><br><span class="line"></span><br><span class="line"># 将模型同步至数据库</span><br><span class="line">&gt; python manage.py migrate</span><br><span class="line"></span><br><span class="line"># 建立管理站点用户</span><br><span class="line">&gt; python manage.py createsuperuser --email admin@example.com --username admin</span><br></pre></td></tr></table></figure>
<h3 id="串行器">串行器</h3>
<p>首先定义一个串行器（<em>Serializer, /'siəriəlaiz/</em>），然后建立一个名为<code>tutorial/quickstart/serializers.py</code>的模块用于接下来的数据展示。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User, Group</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = User</span><br><span class="line">        fields = (<span class="string">'url'</span>, <span class="string">'username'</span>, <span class="string">'email'</span>, <span class="string">'groups'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GroupSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Group</span><br><span class="line">        fields = (<span class="string">'url'</span>, <span class="string">'name'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意这段代码中，我们通过<code>HyperlinkedModelSerializer</code>建立了超链接关联，当然也可以选择主键或其它关联方式，但是对于 RESTful 设计而言超链接模式是一种较好的选择。</p>
</blockquote>
<h3 id="视图">视图</h3>
<p>这里我们最好是编写一些视图，打开<code>tutorial/quickstart/views.py</code>文件进行如下编辑：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User, Group</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"><span class="keyword">from</span> quickstart.serializers <span class="keyword">import</span> UserSerializer, GroupSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    允许users被查看和编辑的API终点</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    queryset = User.objects.all().order_by(<span class="string">'-date_joined'</span>)</span><br><span class="line">    serializer_class = UserSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GroupViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    允许groups被查看和编辑的API终点</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    queryset = Group.objects.all()</span><br><span class="line">    serializer_class = GroupSerializer</span><br></pre></td></tr></table></figure>
<blockquote>
<p>与其整合多个视图，不如将它们相似的行为整合到一个<code>ViewSets</code>类，当然如果需要也可以方便的将它们分离为多个单独的视图，但使用<code>ViewSets</code>可以保持视图逻辑更加清晰有条理。</p>
</blockquote>
<h3 id="url">URL</h3>
<p>好了，这里让我们在<code>tutorial/urls.py</code>写下 API 的 URL：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"><span class="keyword">from</span> quickstart <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = routers.DefaultRouter()</span><br><span class="line">router.register(<span class="string">r'users'</span>, views.UserViewSet)</span><br><span class="line">router.register(<span class="string">r'groups'</span>, views.GroupViewSet)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自动URL路由连接我们的API，并将登陆url包含至可浏览的API。</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^'</span>, include(router.urls)),</span><br><span class="line">    url(<span class="string">r'^api-auth/'</span>, include(<span class="string">'rest_framework.urls'</span>, namespace=<span class="string">'rest_framework'</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于在前面代码中，我们使用了<code>ViewSets</code>代替<code>Views</code>，通过简单的将<code>viewSets</code>注册到<code>router</code>类，所以我们能够方便的为 API 生成 URL 配置。当然如果你觉得有必要，也可以继续使用传统的<code>Views</code>类并且显式注册 URL 配置。上面代码里，我们还将默认的登入登出页面整合为可浏览的 API，这是可选的，但是对于需要进行权限校验的场景又是必要的。</p>
</blockquote>
<h3 id="配置-settings.py">配置 settings.py</h3>
<p>向<code>tutorial/settings.py</code>添加分页配置可以控制 API 返回对象的数量：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">'DEFAULT_PAGINATION_CLASS'</span>: <span class="string">'rest_framework.pagination.PageNumberPagination'</span>,</span><br><span class="line">    <span class="string">'PAGE_SIZE'</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后注册<code>'rest_framework'</code>到<code>INSTALLED_APPS</code>属性当中：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'rest_framework'</span>, <span class="comment"># 注册django-rest-framework至Django应用</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="测试-api">测试 API</h3>
<p>激动人心的时刻到来，我们可以通过<code>python manage.py runserver</code>启动服务然后访问<code>http://127.0.0.1:8000/</code>测试 API：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Workspace</span>\<span class="title">jungle</span>\<span class="title">tutorial</span> (<span class="title">master</span> -&gt; <span class="title">origin</span>)</span></span><br><span class="line"><span class="function">(<span class="title">venv</span>) λ <span class="title">python</span> <span class="title">manage.py</span> <span class="title">runserver</span></span></span><br><span class="line"><span class="function"><span class="title">Performing</span> <span class="title">system</span> <span class="title">checks</span>...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">System</span> <span class="title">check</span> <span class="title">identified</span> <span class="title">no</span> <span class="title">issues</span> (0 <span class="title">silenced</span>).</span></span><br><span class="line"><span class="function"><span class="title">January</span> 08, 2019 - 17:34:15</span></span><br><span class="line"><span class="function"><span class="title">Django</span> <span class="title">version</span> 2.1.5, <span class="title">using</span> <span class="title">settings</span> '<span class="title">tutorial.settings</span>'</span></span><br><span class="line"><span class="function"><span class="title">Starting</span> <span class="title">development</span> <span class="title">server</span> <span class="title">at</span> <span class="title">http</span>://127.0.0.1:8000/</span></span><br><span class="line"><span class="function"><span class="title">Quit</span> <span class="title">the</span> <span class="title">server</span> <span class="title">with</span> <span class="title">CTRL</span>-<span class="title">BREAK</span>.</span></span><br></pre></td></tr></table></figure>
<p><img src="/Web/Django/rest-quick-start.png"></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Hank
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://uinika.github.io/Web/Django.html" title="使用 Django2 快速开发 Web 服务">https://uinika.github.io/Web/Django.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Server/" rel="tag"><i class="fa fa-tag"></i> Server</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Web/Async.html" rel="prev" title="异步事件管理：从 Promise 与 async/await 到 RxJS">
      <i class="fa fa-chevron-left"></i> 异步事件管理：从 Promise 与 async/await 到 RxJS
    </a></div>
      <div class="post-nav-item">
    <a href="/Web/Convention.html" rel="next" title="Web 前端开发遵循的一些规范与约定">
      Web 前端开发遵循的一些规范与约定 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#新建-django-项目"><span class="nav-number">1.</span> <span class="nav-text">新建 Django 项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#请求与响应"><span class="nav-number">2.</span> <span class="nav-text">请求与响应</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pollsviews.py"><span class="nav-number">2.1.</span> <span class="nav-text">polls&#x2F;views.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pollsurls.py"><span class="nav-number">2.2.</span> <span class="nav-text">polls&#x2F;urls.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysiteurls.py"><span class="nav-number">2.3.</span> <span class="nav-text">mysite&#x2F;urls.py</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#模型和管理页面"><span class="nav-number">3.</span> <span class="nav-text">模型和管理页面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mysitesettings.py"><span class="nav-number">3.1.</span> <span class="nav-text">mysite&#x2F;settings.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pollsmodels.py"><span class="nav-number">3.2.</span> <span class="nav-text">polls&#x2F;models.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysitesettings.py-1"><span class="nav-number">3.3.</span> <span class="nav-text">mysite&#x2F;settings.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将数据模型迁移至数据库"><span class="nav-number">3.4.</span> <span class="nav-text">将数据模型迁移至数据库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#管理站点"><span class="nav-number">4.</span> <span class="nav-text">管理站点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#视图与模板"><span class="nav-number">5.</span> <span class="nav-text">视图与模板</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pollsviews.py-1"><span class="nav-number">5.1.</span> <span class="nav-text">polls&#x2F;views.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#polls.urls"><span class="nav-number">5.2.</span> <span class="nav-text">polls.urls</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改-pollsviews.py"><span class="nav-number">5.3.</span> <span class="nav-text">修改 polls&#x2F;views.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加-templates-模板目录"><span class="nav-number">5.4.</span> <span class="nav-text">添加 templates 模板目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#render快捷方法"><span class="nav-number">5.5.</span> <span class="nav-text">render()快捷方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#http404-处理"><span class="nav-number">5.6.</span> <span class="nav-text">Http404 处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#templatespollsdetail.html"><span class="nav-number">5.7.</span> <span class="nav-text">templates&#x2F;polls&#x2F;detail.html</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#url-命名空间"><span class="nav-number">5.8.</span> <span class="nav-text">URL 命名空间</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#表单和通用视图"><span class="nav-number">6.</span> <span class="nav-text">表单和通用视图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#通用视图"><span class="nav-number">7.</span> <span class="nav-text">通用视图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#测试"><span class="nav-number">8.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#静态文件"><span class="nav-number">9.</span> <span class="nav-text">静态文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#staticpollsstyle.css"><span class="nav-number">9.1.</span> <span class="nav-text">static&#x2F;polls&#x2F;style.css</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#templatepollsindex.html"><span class="nav-number">9.2.</span> <span class="nav-text">template&#x2F;polls&#x2F;index.html</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#自定义管理站点"><span class="nav-number">10.</span> <span class="nav-text">自定义管理站点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如何编写可复用的-web-应用"><span class="nav-number">11.</span> <span class="nav-text">如何编写可复用的 Web 应用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#执行原生-sql"><span class="nav-number">12.</span> <span class="nav-text">执行原生 SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#执行原生查询"><span class="nav-number">12.1.</span> <span class="nav-text">执行原生查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直接运行自定义-sql"><span class="nav-number">12.2.</span> <span class="nav-text">直接运行自定义 SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库连接与游标"><span class="nav-number">12.2.1.</span> <span class="nav-text">数据库连接与游标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#存储过程调用"><span class="nav-number">12.2.2.</span> <span class="nav-text">存储过程调用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#django-rest-framework"><span class="nav-number">13.</span> <span class="nav-text">Django REST framework</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#快速开始"><span class="nav-number">13.1.</span> <span class="nav-text">快速开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#项目设置"><span class="nav-number">13.1.1.</span> <span class="nav-text">项目设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#串行器"><span class="nav-number">13.1.2.</span> <span class="nav-text">串行器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图"><span class="nav-number">13.1.3.</span> <span class="nav-text">视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#url"><span class="nav-number">13.1.4.</span> <span class="nav-text">URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-settings.py"><span class="nav-number">13.1.5.</span> <span class="nav-text">配置 settings.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-api"><span class="nav-number">13.1.6.</span> <span class="nav-text">测试 API</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hank"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Hank</p>
  <div class="site-description" itemprop="description">My world of IT, learn it & play it.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/uinika" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;uinika" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/uinika/posts" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;uinika&#x2F;posts" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:uinika@outlook.com" title="Email → mailto:uinika@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>Email</a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:uinika@outlook.com?call|chat" title="Skype → skype:uinika@outlook.com?call|chat" rel="noopener" target="_blank"><i class="fa fa-fw fa-skype"></i>Skype</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/7998979/uinika?tab=profile" title="Stack Overflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;7998979&#x2F;uinika?tab&#x3D;profile" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2010 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"><a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">25:02</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
